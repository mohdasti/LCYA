---
title: "LCYA â€” Veridicality and Other Measures"
author: "Mohammad Dastgheib"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    toc: true
    toc_depth: 6
    toc_float: true
    number_sections: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readr)
library(dplyr)
library(plotly)
library(gridExtra)
library(grid)
library(report)
library(ggplot2)
library(viridis)
library(ggridges)
library("googledrive")
library(ggeasy)
library(gt)
library(cowplot)
#remotes::install_github('jorvlan/raincloudplots')
library(raincloudplots)
library(tidyr)

```



```{r, include=FALSE, cache=TRUE}
setwd("~/R/LCYA_trial_level")
#Loading the perceptual data from `csv` format
lcya_behdata_trial_avdt <- read_csv("lcya_behdata_trial_avdt.csv")
LC_YA_AVDT <- lcya_behdata_trial_avdt

#Loading the CDT data from `csv` format
lcya_behdata_trial_cdt <- read_csv("lcya_behdata_trial_cdt.csv")
LC_YA_CDT <- lcya_behdata_trial_cdt

#Loading the MST data from `csv` format
lcya_behdata_trial_mst <- read_csv("lcya_behdata_trial_mst.csv")
LC_YA_MST <- lcya_behdata_trial_mst

```


# Description of current data {.tabset .tabset-fade .tabset-pills}


```{r, include=F, echo=F, cache=TRUE}

unique_values_count_aud <- LC_YA_AVDT %>%
    filter(task=='aud') %>%
  summarise(unique_count = n_distinct(sub))

# Print the result
print(unique_values_count_aud$unique_count)

unique_values_count_vis <- LC_YA_AVDT %>%
    filter(task=='vis') %>%
  summarise(unique_count = n_distinct(sub))

# Print the result
print(unique_values_count_vis$unique_count)

unique_values_count_cdt <- LC_YA_CDT %>%
    filter(task=='cdt') %>%
  summarise(unique_count = n_distinct(sub))

# Print the result
print(unique_values_count_cdt$unique_count)

unique_values_count_mst <- LC_YA_MST %>%
    filter(task=='MSTstudy') %>%
  summarise(unique_count = n_distinct(sub))

# Print the result
print(unique_values_count_mst$unique_count)

```


```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}
ADT <- LC_YA_AVDT %>%
    filter(task == 'aud') %>%
    filter(!is.na(resp1)) %>%
    filter(sub != '44')

VDT <- LC_YA_AVDT %>%
    filter(task == 'vis') %>%
    filter(!is.na(resp1))

CDT <- LC_YA_CDT %>%
    filter(task == 'cdt') %>%
    filter(!is.na(resp1))

MST <- LC_YA_MST %>%
    filter(task == 'MSTtest') %>%
    filter(!is.na(resp1)) %>%
    filter(sub != 21)

# Function to calculate total trials per subject
calculate_total_trials <- function(data) {
    data %>%
        group_by(sub) %>%
        summarise(total_trials = n())
}

# Calculate total trials for ADT and VDT and CDT and MST
total_trials_ADT <- calculate_total_trials(ADT)
total_trials_VDT <- calculate_total_trials(VDT)
total_trials_CDT <- calculate_total_trials(CDT)
total_trials_MST <- calculate_total_trials(MST)


# Combine the data frames
combined_data <- bind_rows(
    mutate(total_trials_ADT, task = "ADT"),
    mutate(total_trials_VDT, task = "VDT"),
    mutate(total_trials_CDT, task = "CDT"),
    mutate(total_trials_MST, task = "MST")
)

# Create a facetted bar plot
facetted_bar_plot <- ggplot(combined_data, aes(x = sub, y = total_trials, fill = task)) +
    geom_bar(stat = "identity", position = "dodge", alpha = 0.7) +
    labs(title = "Total Number of Trials per Subject",
         x = "Subject",
         y = "Total Trials",
         fill = "Task") +
    facet_wrap(~task, scales = "free_y", ncol = 1) +
    theme_minimal()
ggplotly(facetted_bar_plot)
```


```{r, include=F, echo=F, cache=TRUE}
# Additional corrections

## Subject 25 entered same and different in a reverse manner
VDT <- VDT %>%
   mutate(
    resp1 = ifelse(sub == "25" & resp1 == 1, 2, 
                   ifelse(sub == "25" & resp1 == 2, 1, resp1)),  # Switch 1 and 2 in resp1 for 25
    iscorr = ifelse(sub == "25" & isOddball == resp1, 1, 
                    ifelse(sub == "25", 0, iscorr)),  # Update isCorr based on isOddball and resp1 for 25
    hit = ifelse(sub == "25" & isOddball == 1 & resp1 == 2, 1, 
                  ifelse(sub == "25", 0, hit)),  # Update hit based on isOddball and resp1 for 25
    miss = ifelse(sub == "25" & isOddball == 1 & resp1 == 1, 1, 
                   ifelse(sub == "25", 0, miss)),  # Update miss based on isOddball and resp1 for 25
    fa = ifelse(sub == "25" & isOddball == 0 & resp1 == 2, 1, 
                 ifelse(sub == "25", 0, fa)),  # Update fa based on isOddball and resp1 for 25
    cr = ifelse(sub == "25" & isOddball == 0 & resp1 == 1, 1, 
                 ifelse(sub == "25", 0, cr)),  # Update cr based on isOddball and resp1 for 25
    resp1_diff = ifelse(sub == "25", 1 - resp1_diff, resp1_diff)  # Switch 0s and 1s in resp1_diff for 25
  )

## Adjusting the MST to 4 lure bins

# Read the text file with im_num and lure_bin values
SetC_4 <- read.table("SetC_4.txt", header=F)

colnames(SetC_4)[1] <- "im_num"
colnames(SetC_4)[2] <- "new_lure_bin"
MST <- left_join(MST, SetC_4, by="im_num")

MST$lure_bin <- ifelse(!is.na(MST$new_lure_bin), MST$new_lure_bin, MST$lure_bin)

# Drop the new_lure_bin column if you don't need it anymore
MST <- subset(MST, select = -c(new_lure_bin))

MST <- MST %>%
  mutate(lure_bin = ifelse(trial_type != "lure", NA, lure_bin))


# Update stimlev_mst values based on the specified rules
MST <- MST %>%
  mutate(stimlev_mst = case_when(
    trial_type == "foil" ~ "5foil",
    trial_type == "targ" ~ "0targ",
    lure_bin == '1' ~ "1lure",
    lure_bin == '2' ~ "2lure",
    lure_bin == '3' ~ "3lure",
    lure_bin == '4' ~ "4lure",
    TRUE ~ as.character(stimlev_mst)  # Keep the original value if none of the conditions are met
  ))


```


# ADT {.tabset .tabset-fade .tabset-pills}

## Prportion of Responding 'Different'

<!--
### with traditional SEM

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_ADT <- ADT %>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE)) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(diff_sub)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_ADT <- ADT %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE)) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(same_sub)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_ADT <- bind_rows(
  mutate(Diff_prop_ADT, condition = "Different", prop = diff),
  mutate(Same_prop_ADT, condition = "Same", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "4", "8", "32", "128")

# Convert 'stimLev' to factor with the desired order
combined_ADT$stimLev <- factor(combined_ADT$stimLev, levels = desired_order)

# Plotting with the modified 'stimLev'
ggplot(combined_ADT, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point(size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different", diff_se, not_diff_se), 
                                ymax = prop + ifelse(condition == "Different", diff_se, not_diff_se))) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - ADT'") +
  xlab("Oddball Level (Hz)") +
  ylab("Proportion") +
  labs(caption = "Error bars represent standard error of the mean (SEM)") +
  scale_color_manual(values = c("#BC3C29FF", "#0072B5FF")) +
  guides(color = guide_legend(title = "condition"))

```

-->

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
ADT_acc_ws <- ADT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
ADT_acc_ws <- ADT_acc_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_acc_ws <- ADT_acc_ws %>%
  mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_ADT <- ADT_acc_ws %>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_ADT <- ADT_acc_ws %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_ADT <- bind_rows(
  mutate(Diff_prop_ADT, condition = "Different", prop = diff),
  mutate(Same_prop_ADT, condition = "Same", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "4", "8", "32", "128")

# Convert 'stimLev' to factor with the desired order
combined_ADT$stimLev <- factor(combined_ADT$stimLev, levels = desired_order)

# Plotting with the modified 'stimLev'
ggplot(combined_ADT, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point(size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different", diff_se, not_diff_se), 
                                ymax = prop + ifelse(condition == "Different", diff_se, not_diff_se))) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - ADT'") +
  xlab("Oddball Level (Hz)") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#0072B5FF")) +
  guides(color = guide_legend(title = "condition"))

```

### Handgrip manipulation

#### Binary 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
ADT_acc_ws <- ADT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
ADT_acc_ws <- ADT_acc_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_acc_ws <- ADT_acc_ws %>%
  mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_high_grip_ADT <- ADT_acc_ws %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

Diff_prop_low_grip_ADT <- ADT_acc_ws %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_high_grip_ADT <- ADT_acc_ws %>%
    filter(isStrength==1) %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

Same_prop_low_grip_ADT <- ADT_acc_ws %>%
    filter(isStrength==0) %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_grip_ADT <- bind_rows(
  mutate(Diff_prop_high_grip_ADT, condition = "Different - High Grip", prop = diff),
  mutate(Diff_prop_low_grip_ADT, condition = "Different - Low Grip", prop = diff),
  mutate(Same_prop_high_grip_ADT, condition = "Same - High Grip", prop = not_diff),
  mutate(Same_prop_low_grip_ADT, condition = "Same - Low Grip", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "4", "8", "32", "128")

# Convert 'stimLev' to factor with the desired order
combined_grip_ADT$stimLev <- factor(combined_grip_ADT$stimLev, levels = desired_order)

# Plotting
ggplot(combined_grip_ADT, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point( size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different - High Grip" | condition == "Different - Low Grip", diff_se, not_diff_se), 
                               ymax = prop + ifelse(condition == "Different - High Grip" | condition == "Different - Low Grip", diff_se, not_diff_se)), show.legend = FALSE) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - ADT'") +
  xlab("Oddball Level (Hz)") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("Different - High Grip" = "#BC3C29FF", "Different - Low Grip" = "#ea9999", "Same - High Grip" = "#0072B5FF", "Same - Low Grip" = "#CCE6FF")) +
  scale_linetype_manual(values = c("Different - High Grip" = "solid", "Different - Low Grip" = "solid", "Same - High Grip" = "solid", "Same - Low Grip" = "solid")) +
  guides(color = guide_legend(title = "Response Type", ncol = 1), linetype = "none")


```

#### Continuous 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

library(ggplot2)

lower_limit <- 0  # Lower limit
upper_limit <- 0.6  # Upper limit

# Filter the data based on the auc_rel_mvc limits
ADT_acc_ws <- ADT_acc_ws %>%
    filter(auc_rel_mvc <= upper_limit)
ADT_acc_ws <- ADT_acc_ws %>%
    filter(auc_rel_mvc <= upper_limit)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "4", "8", "32", "128")

# Convert 'stimLev' to factor with the desired order
ADT_acc_ws$stimLev <- factor(ADT_acc_ws$stimLev, levels = desired_order)


# Define the plot aesthetics
ggplot(ADT_acc_ws, aes(x = stimLev, y = auc_rel_mvc, color = factor(resp1_diff))) +
  
  # Add points for scatter plot
  #geom_point(alpha = 0.7) +
  
  # Set plot title and axis labels
  ggtitle("Relationship between Stimulus Level, Grip Force, and Same or Different - ADT") +
  xlab("Oddball Level (Hz)") +
  ylab("Relative Grip") +
  geom_jitter(alpha = 0.4, width = 0.2, height = 0.05) +

 # Customize legend
  scale_color_manual(values = c("#0072B5FF", "#BC3C29FF"), labels = c("Same (0)", "Different (1)")) +
  scale_size_manual(values = c(3, 6), labels = c("Same (0)", "Different (1)")) +
  guides(color = guide_legend(title = "Response Type"),
         size = guide_legend(title = "Response Type"))

```


#### Low vs High handgrip for each subject across oddball levels

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}
ADT$gf_trPer <- as.factor(ADT$gf_trPer)
ADT$gf_trPer <- recode_factor(ADT$gf_trPer, '0.05' = "Low", '0.4' = "High")
# Calculate individual subject responses
subject_responses_ADT_2 <- ADT %>%
  group_by(sub, stimLev, gf_trPer) %>%
  summarise(response = mean(resp1_diff, na.rm = TRUE)) %>%
  arrange(gf_trPer) %>%
  ungroup()

# Replace 'sub' with 'gf_trPer' for X-axis labels
subject_responses_ADT_2$gf_trPer <- factor(subject_responses_ADT_2$gf_trPer, levels = c("Low", "High"))

# Plotting
p10_ADT <- ggplot(subject_responses_ADT_2, aes(x = gf_trPer, y = response, color=gf_trPer, group = sub, text =   as.character(sub))) +
  geom_line(color = "gray") +
  geom_point(size = 2) +
  ggtitle("Proportion of Responding 'Different'") +
  scale_color_manual(values = c("#0072B5FF", "#BC3C29FF")) +
  xlab("Grip Level") +
  ylab("P('Different')") +
  facet_wrap(~stimLev, scales = "free_x", ncol = length(unique(subject_responses_ADT_2$stimLev)))+
  guides(color = guide_legend(title = "Grip Level"))

ggplotly(p10_ADT, tooltip = "text")

```


## Reaction time

<!--
### Using mean 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate mean RT for different responses
    Verid_diff_RT_ADT <- ADT %>%
        group_by(stimLev) %>%
        filter(resp1_diff == 1) %>%
        summarise(RT = mean(resp1RT),
                  RT_se = sd(resp1RT) / sqrt(length(resp1RT))) %>%
        distinct()
    
# Calculate mean RT for same responses
    Verid_same_RT_ADT <- ADT %>%
        group_by(stimLev) %>%
        filter(resp1_diff == 0) %>%
        summarise(RT = mean(resp1RT),
                  RT_se = sd(resp1RT) / sqrt(length(resp1RT))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_RT_ADT <- bind_rows(
        mutate(Verid_diff_RT_ADT, condition = "Different"),
        mutate(Verid_same_RT_ADT, condition = "Same")
    )
    
# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "4", "8", "32", "128")
    
 # Convert 'stimLev' to factor with the desired order
combined_RT_ADT$stimLev <- factor(combined_RT_ADT$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
    combined_RT_ADT <- combined_RT_ADT %>%
        arrange(condition, stimLev)
    
# Plotting
    ggplot(combined_RT_ADT, aes(x = stimLev, y = RT, group = condition, color = condition, linetype= condition)) +
        geom_point(size = 2) +
        geom_line(size = 1.2) +
        ylim(min(combined_RT_ADT$RT), max(combined_RT_ADT$RT)) +
        ggtitle("Mean Reaction Time for Same and Different Responses - ADT") +
        geom_linerange(
            mapping = aes(ymin = RT - RT_se, ymax = RT + RT_se, linetype = condition)
        ) +
        labs(caption = "Error bars represent standard error of the mean (SEM)") +
        xlab("Oddball Level (Hz)") +
        ylab("Reaction Time (S)") +
        scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
        scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 
    
```



### Using median within subject and mean between subjects

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate mean RT for different responses
    Verid_diff_RT_ADT <- ADT %>%
        filter(resp1_diff == 1) %>%
        group_by(stimLev,sub) %>%
        summarise(diff_sub= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(RT_diff = mean(diff_sub),
                  RT_diff_se = sd(diff_sub) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean RT for same responses
    Verid_same_RT_ADT <- ADT %>%
       filter(resp1_diff == 0) %>%
        group_by(stimLev,sub) %>%
        summarise(diff_sub= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(RT_same = mean(diff_sub),
                  RT_same_se = sd(diff_sub) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_RT_ADT <- bind_rows(
        mutate(Verid_diff_RT_ADT, condition = "Different"),
        mutate(Verid_same_RT_ADT, condition = "Same")
    )
    
# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "4", "8", "32", "128")
    
 # Convert 'stimLev' to factor with the desired order
combined_RT_ADT$stimLev <- factor(combined_RT_ADT$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
    combined_RT_ADT <- combined_RT_ADT %>%
        arrange(condition, stimLev)
    
# Plotting
ggplot(combined_RT_ADT, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
    geom_point(aes(y = ifelse(condition == "Different", RT_diff, RT_same)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", RT_diff, RT_same)), size = 1.2) +
    ylim(min(c(combined_RT_ADT$RT_diff, combined_RT_ADT$RT_same)), max(c(combined_RT_ADT$RT_diff, combined_RT_ADT$RT_same))) +
    ggtitle("Mean of Median Reaction Time for Same and Different Responses - ADT") +
    geom_linerange(mapping = aes(ymin = RT_diff - RT_diff_se, ymax = RT_diff + RT_diff_se, linetype = condition), data = filter(combined_RT_ADT, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = RT_same - RT_same_se, ymax = RT_same + RT_same_se, linetype = condition), data = filter(combined_RT_ADT, condition == "Same")) +
    labs(caption = "Error bars represent standard error of the mean (SEM)") +
    xlab("Oddball Level (Hz)") +
    ylab("Reaction Time (S)") +
    scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
    scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 
```


### Using median within and between subjects

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate median RT for different responses
    Verid_diff_RT_ADT <- ADT %>%
        filter(resp1_diff == 1) %>%
        group_by(stimLev,sub) %>%
        summarise(diff_sub= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(RT_diff = median(diff_sub),
                  RT_diff_se = sd(diff_sub) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate median RT for same responses
    Verid_same_RT_ADT <- ADT %>%
       filter(resp1_diff == 0) %>%
        group_by(stimLev,sub) %>%
        summarise(diff_sub= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(RT_same = median(diff_sub),
                  RT_same_se = sd(diff_sub) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_RT_ADT <- bind_rows(
        mutate(Verid_diff_RT_ADT, condition = "Different"),
        mutate(Verid_same_RT_ADT, condition = "Same")
    )
    
# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "4", "8", "32", "128")
    
 # Convert 'stimLev' to factor with the desired order
combined_RT_ADT$stimLev <- factor(combined_RT_ADT$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
    combined_RT_ADT <- combined_RT_ADT %>%
        arrange(condition, stimLev)
    
# Plotting
ggplot(combined_RT_ADT, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
    geom_point(aes(y = ifelse(condition == "Different", RT_diff, RT_same)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", RT_diff, RT_same)), size = 1.2) +
    ylim(min(c(combined_RT_ADT$RT_diff, combined_RT_ADT$RT_same)), max(c(combined_RT_ADT$RT_diff, combined_RT_ADT$RT_same))) +
    ggtitle("Median of Reaction Time for Same and Different Responses - ADT") +
    geom_linerange(mapping = aes(ymin = RT_diff - RT_diff_se, ymax = RT_diff + RT_diff_se, linetype = condition), data = filter(combined_RT_ADT, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = RT_same - RT_same_se, ymax = RT_same + RT_same_se, linetype = condition), data = filter(combined_RT_ADT, condition == "Same")) +
    labs(caption = "Error bars represent standard error of the mean (SEM)") +
    xlab("Oddball Level (Hz)") +
    ylab("Reaction Time (S)") +
    scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
    scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 
```

-->

### Using Median with within-subject SEM

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}
# calculate subject mean
ADT_RT_ws <- ADT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calcualte the grand mean
ADT_RT_ws <- ADT_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_RT_ws <- ADT_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 


# Calculate median RT for different responses
ADT_diff_RT_ws <- ADT_RT_ws %>%
  filter(resp1_diff == 1) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_diff = median(diff_sub),
            medRT_diff_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Calculate median RT for same responses
ADT_same_RT_ws <- ADT_RT_ws %>%
  filter(resp1_diff == 0) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_same = median(diff_sub),
            medRT_same_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Combine both datasets for plotting
combined_RT_ADT <- bind_rows(
  mutate(ADT_diff_RT_ws, condition = "Different"),
  mutate(ADT_same_RT_ws, condition = "Same")
)


# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "4", "8", "32", "128")

# Convert 'stimLev' to factor with the desired order
combined_RT_ADT$stimLev <- factor(combined_RT_ADT$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
combined_RT_ADT <- combined_RT_ADT %>%
  arrange(condition, stimLev)

# Plotting
ggplot(combined_RT_ADT, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
  geom_point(aes(y = ifelse(condition == "Different", medRT_diff , medRT_same)), size = 2) +
  geom_line(aes(y = ifelse(condition == "Different", medRT_diff, medRT_same)), size = 1.2) +
  ylim(min(c(combined_RT_ADT$medRT_diff, combined_RT_ADT$medRT_same)), max(c(combined_RT_ADT$medRT_diff, combined_RT_ADT$medRT_same))) +
  ggtitle("Median of Reaction Time for Same and Different Responses - ADT") +
  geom_linerange(mapping = aes(ymin = medRT_diff - medRT_diff_se, ymax = medRT_diff + medRT_diff_se, linetype = condition), data = filter(combined_RT_ADT, condition == "Different")) +
  geom_linerange(mapping = aes(ymin = medRT_same - medRT_same_se, ymax = medRT_same + medRT_same_se, linetype = condition), data = filter(combined_RT_ADT, condition == "Same")) +
  labs(caption = "Error bars represent within-subject SEM") +
  xlab("Oddball Level (Hz)") +
  ylab("Reaction Time (S)") +
  scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
  scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 
```


### Handgrip manipulation

#### Binary 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
ADT_RT_ws <- ADT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calcualte the grand mean
ADT_RT_ws <- ADT_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_RT_ws <- ADT_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 

# Calculate mean RT and standard error for  High 'Different'
RT_diff_high_grip_ADT <- ADT_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_diff=median(diff_sub), medRT_high_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Different'
RT_diff_low_grip_ADT <- ADT_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_diff=median(diff_sub), medRT_low_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Calculate mean RT and standard error for  High 'Same'
RT_same_high_grip_ADT <- ADT_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_same=median(diff_sub), medRT_high_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Same'
RT_same_low_grip_ADT <- ADT_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_same=median(diff_sub), medRT_low_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Combine both datasets for plotting
combined_RT_grip_ADT <- bind_rows(
  mutate(RT_diff_high_grip_ADT, condition = "Different - High Grip"),
  mutate(RT_diff_low_grip_ADT, condition = "Different - Low Grip"),
  mutate(RT_same_high_grip_ADT, condition = "Same - High Grip"),
  mutate(RT_same_low_grip_ADT, condition = "Same - Low Grip")
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "4", "8", "32", "128")

# Convert 'stimLev' to factor with the desired order
combined_RT_grip_ADT$stimLev <- factor(combined_RT_grip_ADT$stimLev, levels = desired_order)


# Plotting
ggplot(data = combined_RT_grip_ADT) +
  geom_point(aes(x = stimLev, y = medRT_high_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_diff - medRT_high_diff_se, 
                     ymax = medRT_high_diff + medRT_high_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_diff - medRT_low_diff_se, 
                     ymax = medRT_low_diff + medRT_low_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_high_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_same - medRT_high_same_se, 
                     ymax = medRT_high_same + medRT_high_same_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_same - medRT_low_same_se, 
                     ymax = medRT_low_same + medRT_low_same_se, color = condition), 
                 linetype = "solid") +
  
  ggtitle("Median of Reaction Time for Same and Different Responses - ADT") +
  xlab("Oddball Level (Hz)") +
  ylab("Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                      name = "Condition") 


```


## Confidence

<!--
### With traditional SEM

```{r message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

diff_average_confidence_ADT <- ADT %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_conf = mean(diff_prop, na.rm = T), 
                  diff_conf_se = sd(diff_prop, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_confidence_ADT <- ADT %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_conf = mean(same_prop), 
                  same_conf_se = sd(same_prop) / sqrt(n_distinct(sub))) %>%
        distinct()

  combined_prop_ADT <- bind_rows(
        mutate(diff_average_confidence_ADT, condition = "Different"),
        mutate(same_average_confidence_ADT, condition = "Same")
    )

#######
  
    # Calculate mean proportion of 'Different' responses for high confidence trials
  #  diff_high_confidence_ADT <- ADT %>%
   #     group_by(stimLev) %>%
    #    filter(resp2_bin_med == 1) %>%
     #   summarise(diff_prop = mean(resp1_diff, na.rm = TRUE),
      #            diff_prop_se = sd(resp1_diff, na.rm = TRUE) / sqrt(length(resp1_diff))) %>%
       # distinct()
    
    # Calculate mean proportion of 'Same' responses for high confidence trials
  #  same_high_confidence_ADT <- diff_high_confidence_ADT %>%
   #     mutate(not_diff = 1 - diff_prop)
    
    # Calculate mean proportion of 'Different' responses for low confidence trials
  #  diff_low_confidence_ADT <- ADT %>%
   #     group_by(stimLev) %>%
    #    filter(resp2_bin_med == 0) %>%
     #   summarise(diff_prop = mean(resp1_diff, na.rm = TRUE),
      #            diff_prop_se = sd(resp1_diff, na.rm = TRUE) / sqrt(length(resp1_diff))) %>%
       # distinct()
    
    # Calculate mean proportion of 'Same' responses for low confidence trials
  #  same_low_confidence_ADT <- diff_low_confidence_ADT %>%
   #     mutate(not_diff = 1 - diff_prop)
    
    # Combine both datasets for plotting
 #   combined_prop_ADT <- bind_rows(
  #      mutate(diff_high_confidence_ADT, condition = "High Confidence - Different", prop = diff_prop),
  #      mutate(same_high_confidence_ADT, condition = "High Confidence - Same", prop = not_diff),
   #     mutate(diff_low_confidence_ADT, condition = "Low Confidence - Different", prop = diff_prop),
  #    mutate(same_low_confidence_ADT, condition = "Low Confidence - Same", prop = not_diff)
   # )
######    
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "4", "8", "32", "128")
    
    # Convert 'stimLev' to factor with the desired order
    combined_prop_ADT$stimLev <- factor(combined_prop_ADT$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_prop_ADT <- combined_prop_ADT %>%
        arrange(condition, stimLev)
    
    # Plotting
    ggplot(combined_prop_ADT, aes(x = stimLev, group = condition, color = condition)) +
        geom_point(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 1.2) +
        ylim(2, 4) +
        ggtitle("Average of Confidence Response - ADT") +
        geom_linerange(mapping = aes(ymin = diff_conf - diff_conf_se, ymax = diff_conf + diff_conf_se, linetype = condition), data = filter(combined_prop_ADT, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = same_conf - same_conf_se, ymax = same_conf + same_conf_se, linetype = condition), data = filter(combined_prop_ADT, condition == "Same")) +
        labs(caption = "Error bars represent standard error of the mean (SEM)") +
        xlab("Oddball Level") +
        ylab("Confidence Rating") +
        scale_color_manual(values = c("Different" = "#BC3C29FF",
                                      "Same" = "#0072B5FF"
                                      ),
                           labels = c("Different",
                                      "Same"
                                      )) +
        scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid"))
    
```

-->

### Within-subject SEM

```{r message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
ADT_conf_ws <- ADT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
ADT_conf_ws <- ADT_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_conf_ws <- ADT_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean) 

diff_average_confidence_ADT <- ADT_conf_ws %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_conf = mean(diff_prop, na.rm = T), 
                  diff_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_confidence_ADT <- ADT_conf_ws %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_conf = mean(same_prop), 
                  same_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

  combined_prop_ADT <- bind_rows(
        mutate(diff_average_confidence_ADT, condition = "Different"),
        mutate(same_average_confidence_ADT, condition = "Same")
    )
  
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "4", "8", "32", "128")
    
    # Convert 'stimLev' to factor with the desired order
    combined_prop_ADT$stimLev <- factor(combined_prop_ADT$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_prop_ADT <- combined_prop_ADT %>%
        arrange(condition, stimLev)
    
    # Plotting
    ggplot(combined_prop_ADT, aes(x = stimLev, group = condition, color = condition)) +
        geom_point(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 1.2) +
        ylim(2, 4) +
        ggtitle("Average of Confidence Response - ADT") +
        geom_linerange(mapping = aes(ymin = diff_conf - diff_conf_se, ymax = diff_conf + diff_conf_se, linetype = condition), data = filter(combined_prop_ADT, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = same_conf - same_conf_se, ymax = same_conf + same_conf_se, linetype = condition), data = filter(combined_prop_ADT, condition == "Same")) +
        labs(caption = "Error bars represent within-subject SEM") +
        xlab("Oddball Level") +
        ylab("Confidence Rating") +
        scale_color_manual(values = c("Different" = "#BC3C29FF",
                                      "Same" = "#0072B5FF"
                                      ),
                           labels = c("Different",
                                      "Same"
                                      )) +
        scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid"))
    

```


### Handgrip manipulation

#### Binary 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
ADT_conf_ws <- ADT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
ADT_conf_ws <- ADT_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_conf_ws <- ADT_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean) 

diff_average_high_confidence_ADT <- ADT_conf_ws %>%
        filter(isStrength == 1) %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_high_conf = mean(diff_prop, na.rm = T), 
                  diff_high_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

diff_average_low_confidence_ADT <- ADT_conf_ws %>%
        filter(isStrength == 0) %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_low_conf = mean(diff_prop, na.rm = T), 
                  diff_low_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()


same_average_high_confidence_ADT <- ADT_conf_ws %>%
        filter(isStrength == 1) %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_high_conf = mean(same_prop, na.rm = T), 
                  same_high_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_low_confidence_ADT <- ADT_conf_ws %>%
        filter(isStrength == 0) %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_low_conf = mean(same_prop, na.rm = T), 
                  same_low_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()


combined_conf_grip_ADT <- bind_rows(
        mutate(diff_average_high_confidence_ADT, condition = "Different - High Grip"),
        mutate(diff_average_low_confidence_ADT, condition = "Different - Low Grip" ),
        mutate(same_average_high_confidence_ADT, condition = "Same - High Grip"),
        mutate(same_average_low_confidence_ADT, condition = "Same - Low Grip")
)
  
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "4", "8", "32", "128")
    
    # Convert 'stimLev' to factor with the desired order
    combined_conf_grip_ADT$stimLev <- factor(combined_conf_grip_ADT$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_conf_grip_ADT <- combined_conf_grip_ADT %>%
        arrange(condition, stimLev)
    


ggplot(combined_conf_grip_ADT, aes(x = stimLev, color = condition)) +
  geom_point(aes(y = diff_high_conf), size = 3) +
  geom_line(aes(y = diff_high_conf, group = condition), size = 1.2) +
  geom_linerange(aes(ymin = diff_high_conf - diff_high_conf_se, 
                     ymax = diff_high_conf + diff_high_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  geom_point(aes(y = diff_low_conf), size = 3) +
  geom_line(aes(y = diff_low_conf, group = condition), size = 1.2, linetype = "solid") +
  geom_linerange(aes(ymin = diff_low_conf - diff_low_conf_se, 
                     ymax = diff_low_conf + diff_low_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  geom_point(aes(y = same_high_conf), size = 3) +
  geom_line(aes(y = same_high_conf, group = condition), size = 1.2) +
  geom_linerange(aes(ymin = same_high_conf - same_high_conf_se, 
                     ymax = same_high_conf + same_high_conf_se, group = condition), 
                  linetype = "solid") +
  geom_point(aes(y = same_low_conf), size = 3) +
  geom_line(aes(y = same_low_conf, group = condition), size = 1.2, linetype = "solid") +
  geom_linerange(aes(ymin = same_low_conf - same_low_conf_se, 
                     ymax = same_low_conf + same_low_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  ggtitle("Average of Confidence Response - ADT") +
  labs(caption = "Error bars represent within-subject SEM", x = "Oddball Level", y = "Confidence Rating") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                     name = "Response Type") +
  ylim(2,4)+
  scale_linetype_manual(values = c("solid", "solid"), name = "Condition",
                        labels = c("High Grip", "Low Grip")) 

```


# VDT {.tabset .tabset-fade .tabset-pills}

## Prportion of Responding 'Different' 

<!--
### with traditional SEM

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_VDT <- VDT %>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE)) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(diff_sub)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_VDT <- VDT %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE)) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(same_sub)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_VDT <- bind_rows(
  mutate(Diff_prop_VDT, condition = "Different", prop = diff),
  mutate(Same_prop_VDT, condition = "Same", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")

# Convert 'stimLev' to factor with the desired order
combined_VDT$stimLev <- factor(combined_VDT$stimLev, levels = desired_order)

# Plotting with the modified 'stimLev'
ggplot(combined_VDT, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point(size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different", diff_se, not_diff_se), 
                                ymax = prop + ifelse(condition == "Different", diff_se, not_diff_se))) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - VDT'") +
  xlab("Contrast Level") +
  ylab("Proportion") +
  labs(caption = "Error bars represent standard error of the mean (SEM)") +
  scale_color_manual(values = c("#BC3C29FF", "#0072B5FF")) +
  guides(color = guide_legend(title = "condition"))

```

-->

### within-subject SEM

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
VDT_acc_ws <- VDT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
VDT_acc_ws <- VDT_acc_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_acc_ws <- VDT_acc_ws %>%
  mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_VDT <- VDT_acc_ws %>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_VDT <- VDT_acc_ws %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_VDT <- bind_rows(
  mutate(Diff_prop_VDT, condition = "Different", prop = diff),
  mutate(Same_prop_VDT, condition = "Same", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")

# Convert 'stimLev' to factor with the desired order
combined_VDT$stimLev <- factor(combined_VDT$stimLev, levels = desired_order)

# Plotting with the modified 'stimLev'
ggplot(combined_VDT, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point(size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different", diff_se, not_diff_se), 
                                ymax = prop + ifelse(condition == "Different", diff_se, not_diff_se))) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - VDT'") +
  xlab("Contrast Level") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#0072B5FF")) +
  guides(color = guide_legend(title = "condition"))

```


### Handgrip manipulation

#### Binary 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
VDT_acc_ws <- VDT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
VDT_acc_ws <- VDT_acc_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_acc_ws <- VDT_acc_ws %>%
  mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_high_grip_VDT <- VDT_acc_ws %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

Diff_prop_low_grip_VDT <- VDT_acc_ws %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_high_grip_VDT <- VDT_acc_ws %>%
    filter(isStrength==1) %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

Same_prop_low_grip_VDT <- VDT_acc_ws %>%
    filter(isStrength==0) %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_grip_VDT <- bind_rows(
  mutate(Diff_prop_high_grip_VDT, condition = "Different - High Grip", prop = diff),
  mutate(Diff_prop_low_grip_VDT, condition = "Different - Low Grip", prop = diff),
  mutate(Same_prop_high_grip_VDT, condition = "Same - High Grip", prop = not_diff),
  mutate(Same_prop_low_grip_VDT, condition = "Same - Low Grip", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")

# Convert 'stimLev' to factor with the desired order
combined_grip_VDT$stimLev <- factor(combined_grip_VDT$stimLev, levels = desired_order)

# Plotting
ggplot(combined_grip_VDT, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point( size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different - High Grip" | condition == "Different - Low Grip", diff_se, not_diff_se), 
                               ymax = prop + ifelse(condition == "Different - High Grip" | condition == "Different - Low Grip", diff_se, not_diff_se)), show.legend = FALSE) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - VDT'") +
  xlab("Contrast Level") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("Different - High Grip" = "#BC3C29FF", "Different - Low Grip" = "#ea9999", "Same - High Grip" = "#0072B5FF", "Same - Low Grip" = "#CCE6FF")) +
  scale_linetype_manual(values = c("Different - High Grip" = "solid", "Different - Low Grip" = "solid", "Same - High Grip" = "solid", "Same - Low Grip" = "solid")) +
  guides(color = guide_legend(title = "Response Type", ncol = 1), linetype = "none")


```

#### Continuous 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

library(ggplot2)

lower_limit <- 0  # Lower limit
upper_limit <- 0.6  # Upper limit

# Filter the data based on the auc_rel_mvc limits
VDT_acc_ws <- VDT_acc_ws %>%
    filter(auc_rel_mvc <= upper_limit)
VDT_acc_ws <- VDT_acc_ws %>%
    filter(auc_rel_mvc <= upper_limit)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")

# Convert 'stimLev' to factor with the desired order
VDT_acc_ws$stimLev <- factor(VDT_acc_ws$stimLev, levels = desired_order)


# Define the plot aesthetics
ggplot(VDT_acc_ws, aes(x = stimLev, y = auc_rel_mvc, color = factor(resp1_diff))) +
  
  # Add points for scatter plot
  #geom_point(alpha = 0.7) +
  
  # Set plot title and axis labels
  ggtitle("Relationship between Stimulus Level, Grip Force, and Same or Different - VDT") +
  xlab("Contrast Level") +
  ylab("Relative Grip") +
  geom_jitter(alpha = 0.4, width = 0.2, height = 0.05) +

 # Customize legend
  scale_color_manual(values = c("#0072B5FF", "#BC3C29FF"), labels = c("Same (0)", "Different (1)")) +
  scale_size_manual(values = c(3, 6), labels = c("Same (0)", "Different (1)")) +
  guides(color = guide_legend(title = "Response Type"),
         size = guide_legend(title = "Response Type"))

```



#### Low vs High handgrip for each subject across oddball levels

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}
VDT$gf_trPer <- as.factor(VDT$gf_trPer)
VDT$gf_trPer <- recode_factor(VDT$gf_trPer, '0.05' = "Low", '0.4' = "High")
# Calculate individual subject responses
subject_responses_VDT_2 <- VDT %>%
  group_by(sub, stimLev, gf_trPer) %>%
  summarise(response = mean(resp1_diff, na.rm = TRUE)) %>%
  arrange(gf_trPer) %>%
  ungroup()

# Replace 'sub' with 'gf_trPer' for X-axis labels
subject_responses_VDT_2$gf_trPer <- factor(subject_responses_VDT_2$gf_trPer, levels = c("Low", "High"))

# Plotting
p10_VDT <- ggplot(subject_responses_VDT_2, aes(x = gf_trPer, y = response, color=gf_trPer, group = sub, text =   as.character(sub))) +
  geom_line(color = "gray") +
  geom_point(size = 2) +
  ggtitle("Proportion of Responding 'Different'") +
  scale_color_manual(values = c("#0072B5FF", "#BC3C29FF")) +
  xlab("Grip Level") +
  ylab("P('Different')") +
  facet_wrap(~stimLev, scales = "free_x", ncol = length(unique(subject_responses_VDT_2$stimLev)))+
  guides(color = guide_legend(title = "Grip Level"))

ggplotly(p10_VDT, tooltip = "text")

```



## Reaction time

<!--
### Using mean

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate mean RT for different responses
    Verid_diff_RT_VDT <- VDT %>%
        group_by(stimLev) %>%
        filter(resp1_diff == 1) %>%
        summarise(RT = mean(resp1RT),
                  RT_se = sd(resp1RT) / sqrt(length(resp1RT))) %>%
        distinct()
    
# Calculate mean RT for same responses
    Verid_same_RT_VDT <- VDT %>%
        group_by(stimLev) %>%
        filter(resp1_diff == 0) %>%
        summarise(RT = mean(resp1RT),
                  RT_se = sd(resp1RT) / sqrt(length(resp1RT))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_RT_VDT <- bind_rows(
        mutate(Verid_diff_RT_VDT, condition = "Different"),
        mutate(Verid_same_RT_VDT, condition = "Same")
    )
    
# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")
    
 # Convert 'stimLev' to factor with the desired order
combined_RT_VDT$stimLev <- factor(combined_RT_VDT$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
    combined_RT_VDT <- combined_RT_VDT %>%
        arrange(condition, stimLev)
    
# Plotting
    ggplot(combined_RT_VDT, aes(x = stimLev, y = RT, group = condition, color = condition, linetype= condition)) +
        geom_point(size = 2) +
        geom_line(size = 1.2) +
        ylim(min(combined_RT_VDT$RT), max(combined_RT_VDT$RT)) +
        ggtitle("Mean Reaction Time for Same and Different Responses - VDT") +
        geom_linerange(
            mapping = aes(ymin = RT - RT_se, ymax = RT + RT_se, linetype = condition)
        ) +
        labs(caption = "Error bars represent standard error of the mean (SEM)") +
        xlab("Contrast Level") +
        ylab("Reaction Time (S)") +
        scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
        scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 
    
```


### Using median for within subject and mean for between subjects

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate mean RT for different responses
    Verid_diff_RT_VDT <- VDT %>%
        filter(resp1_diff == 1) %>%
        group_by(stimLev,sub) %>%
        summarise(diff_sub= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(RT_diff = mean(diff_sub),
                  RT_diff_se = sd(diff_sub) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean RT for same responses
    Verid_same_RT_VDT <- VDT %>%
       filter(resp1_diff == 0) %>%
        group_by(stimLev,sub) %>%
        summarise(diff_sub= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(RT_same = mean(diff_sub),
                  RT_same_se = sd(diff_sub) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_RT_VDT <- bind_rows(
        mutate(Verid_diff_RT_VDT, condition = "Different"),
        mutate(Verid_same_RT_VDT, condition = "Same")
    )
    
    
# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")
    
 # Convert 'stimLev' to factor with the desired order
combined_RT_VDT$stimLev <- factor(combined_RT_VDT$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
    combined_RT_VDT <- combined_RT_VDT %>%
        arrange(condition, stimLev)
    
# Plotting
ggplot(combined_RT_VDT, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
    geom_point(aes(y = ifelse(condition == "Different", RT_diff, RT_same)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", RT_diff, RT_same)), size = 1.2) +
    ylim(min(c(combined_RT_VDT$RT_diff, combined_RT_VDT$RT_same)), max(c(combined_RT_VDT$RT_diff, combined_RT_VDT$RT_same))) +
    ggtitle("Mean of Median Reaction Time for Same and Different Responses - VDT") +
    geom_linerange(mapping = aes(ymin = RT_diff - RT_diff_se, ymax = RT_diff + RT_diff_se, linetype = condition), data = filter(combined_RT_VDT, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = RT_same - RT_same_se, ymax = RT_same + RT_same_se, linetype = condition), data = filter(combined_RT_VDT, condition == "Same")) +
    labs(caption = "Error bars represent standard error of the mean (SEM)") +
    xlab("Contrast Level") +
    ylab("Reaction Time (S)") +
    scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
    scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid"))
    
```



### Using median within and between subjects

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate mean RT for different responses
    Verid_diff_RT_VDT <- VDT %>%
        filter(resp1_diff == 1) %>%
        group_by(stimLev,sub) %>%
        summarise(diff_sub= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(RT_diff = median(diff_sub),
                  RT_diff_se = sd(diff_sub) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate median RT for same responses
    Verid_same_RT_VDT <- VDT %>%
       filter(resp1_diff == 0) %>%
        group_by(stimLev,sub) %>%
        summarise(diff_sub= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(RT_same = median(diff_sub),
                  RT_same_se = sd(diff_sub) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_RT_VDT <- bind_rows(
        mutate(Verid_diff_RT_VDT, condition = "Different"),
        mutate(Verid_same_RT_VDT, condition = "Same")
    )
    
    
# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")
    
 # Convert 'stimLev' to factor with the desired order
combined_RT_VDT$stimLev <- factor(combined_RT_VDT$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
    combined_RT_VDT <- combined_RT_VDT %>%
        arrange(condition, stimLev)
    
# Plotting
ggplot(combined_RT_VDT, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
    geom_point(aes(y = ifelse(condition == "Different", RT_diff, RT_same)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", RT_diff, RT_same)), size = 1.2) +
    ylim(min(c(combined_RT_VDT$RT_diff, combined_RT_VDT$RT_same)), max(c(combined_RT_VDT$RT_diff, combined_RT_VDT$RT_same))) +
    ggtitle("Median of Reaction Time for Same and Different Responses - VDT") +
    geom_linerange(mapping = aes(ymin = RT_diff - RT_diff_se, ymax = RT_diff + RT_diff_se, linetype = condition), data = filter(combined_RT_VDT, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = RT_same - RT_same_se, ymax = RT_same + RT_same_se, linetype = condition), data = filter(combined_RT_VDT, condition == "Same")) +
    labs(caption = "Error bars represent standard error of the mean (SEM)") +
    xlab("Contrast Level") +
    ylab("Reaction Time (S)") +
    scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
    scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid"))
    
```
-->

### Using Median with within-subject SEM

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}
# calculate subject mean
VDT_RT_ws <- VDT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
VDT_RT_ws <- VDT_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_RT_ws <- VDT_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 


# Calculate median RT for different responses
VDT_diff_RT_ws <- VDT_RT_ws %>%
  filter(resp1_diff == 1) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_diff = median(diff_sub),
            medRT_diff_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Calculate median RT for same responses
VDT_same_RT_ws <- VDT_RT_ws %>%
  filter(resp1_diff == 0) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_same = median(diff_sub),
            medRT_same_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Combine both datasets for plotting
combined_RT_VDT <- bind_rows(
  mutate(VDT_diff_RT_ws, condition = "Different"),
  mutate(VDT_same_RT_ws, condition = "Same")
)


# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")

# Convert 'stimLev' to factor with the desired order
combined_RT_VDT$stimLev <- factor(combined_RT_VDT$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
combined_RT_VDT <- combined_RT_VDT %>%
  arrange(condition, stimLev)

# Plotting
ggplot(combined_RT_VDT, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
  geom_point(aes(y = ifelse(condition == "Different", medRT_diff , medRT_same)), size = 2) +
  geom_line(aes(y = ifelse(condition == "Different", medRT_diff, medRT_same)), size = 1.2) +
  ylim(min(c(combined_RT_VDT$medRT_diff, combined_RT_VDT$medRT_same)), max(c(combined_RT_VDT$medRT_diff, combined_RT_VDT$medRT_same))) +
  ggtitle("Median of Reaction Time for Same and Different Responses - VDT") +
  geom_linerange(mapping = aes(ymin = medRT_diff - medRT_diff_se, ymax = medRT_diff + medRT_diff_se, linetype = condition), data = filter(combined_RT_VDT, condition == "Different")) +
  geom_linerange(mapping = aes(ymin = medRT_same - medRT_same_se, ymax = medRT_same + medRT_same_se, linetype = condition), data = filter(combined_RT_VDT, condition == "Same")) +
  labs(caption = "Error bars represent within-subject SEM") +
  xlab("Contrast Level") +
  ylab("Reaction Time (S)") +
  scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
  scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 
```


### Handgrip manipulation

#### Binary 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
VDT_RT_ws <- VDT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calcualte the grand mean
VDT_RT_ws <- VDT_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_RT_ws <- VDT_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 

# Calculate mean RT and standard error for  High 'Different'
RT_diff_high_grip_VDT <- VDT_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_diff=median(diff_sub), medRT_high_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Different'
RT_diff_low_grip_VDT <- VDT_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_diff=median(diff_sub), medRT_low_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Calculate mean RT and standard error for  High 'Same'
RT_same_high_grip_VDT <- VDT_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_same=median(diff_sub), medRT_high_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Same'
RT_same_low_grip_VDT <- VDT_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_same=median(diff_sub), medRT_low_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Combine both datasets for plotting
combined_RT_grip_VDT <- bind_rows(
  mutate(RT_diff_high_grip_VDT, condition = "Different - High Grip"),
  mutate(RT_diff_low_grip_VDT, condition = "Different - Low Grip"),
  mutate(RT_same_high_grip_VDT, condition = "Same - High Grip"),
  mutate(RT_same_low_grip_VDT, condition = "Same - Low Grip")
)

# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")

# Convert 'stimLev' to factor with the desired order
combined_RT_grip_VDT$stimLev <- factor(combined_RT_grip_VDT$stimLev, levels = desired_order)


# Plotting without jitter
ggplot(data = combined_RT_grip_VDT) +
  geom_point(aes(x = stimLev, y = medRT_high_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_diff - medRT_high_diff_se, 
                     ymax = medRT_high_diff + medRT_high_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_diff - medRT_low_diff_se, 
                     ymax = medRT_low_diff + medRT_low_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_high_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_same - medRT_high_same_se, 
                     ymax = medRT_high_same + medRT_high_same_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_same - medRT_low_same_se, 
                     ymax = medRT_low_same + medRT_low_same_se, color = condition), 
                 linetype = "solid") +
  
  ggtitle("Median of Reaction Time for Same and Different Responses - VDT") +
  xlab("Contrast Level") +
  ylab("Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                      name = "Condition") 


```

## Confidence

<!--
### With traditional SEM

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

diff_average_confidence_VDT <- VDT %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_conf = mean(diff_prop, na.rm = T), 
                  diff_conf_se = sd(diff_prop, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_confidence_VDT <- VDT %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_conf = mean(same_prop), 
                  same_conf_se = sd(same_prop) / sqrt(n_distinct(sub))) %>%
        distinct()

  combined_prop_VDT <- bind_rows(
        mutate(diff_average_confidence_VDT, condition = "Different"),
        mutate(same_average_confidence_VDT, condition = "Same")
    )

#    # Calculate mean proportion of 'Different' responses for high confidence trials
#    diff_high_confidence_VDT <- VDT %>%
#        group_by(stimLev) %>%
#        filter(resp2_bin_med == 1) %>%
#        summarise(diff_prop = mean(resp1_diff, na.rm = TRUE),
#                  diff_prop_se = sd(resp1_diff, na.rm = TRUE) / sqrt(length(resp1_diff))) %>%
#        distinct()
#    
#    # Calculate mean proportion of 'Same' responses for high confidence trials
#    same_high_confidence_VDT <- diff_high_confidence_VDT %>%
#        mutate(not_diff = 1 - diff_prop)
#    
#    # Calculate mean proportion of 'Different' responses for low confidence trials
#    diff_low_confidence_VDT <- VDT %>%
#        group_by(stimLev) %>%
#        filter(resp2_bin_med == 0) %>%
#        summarise(diff_prop = mean(resp1_diff, na.rm = TRUE),
#                  diff_prop_se = sd(resp1_diff, na.rm = TRUE) / sqrt(length(resp1_diff))) %>%
#        distinct()
#    
#    # Calculate mean proportion of 'Same' responses for low confidence trials
#    same_low_confidence_VDT <- diff_low_confidence_VDT %>%
#        mutate(not_diff = 1 - diff_prop)
#    
#    # Combine both datasets for plotting
#    combined_prop_VDT <- bind_rows(
#        mutate(diff_high_confidence_VDT, condition = "High Confidence - Different", prop = diff_prop),
#        mutate(same_high_confidence_VDT, condition = "High Confidence - Same", prop = not_diff),
#        mutate(diff_low_confidence_VDT, condition = "Low Confidence - Different", prop = diff_prop),
#        mutate(same_low_confidence_VDT, condition = "Low Confidence - Same", prop = not_diff)
#    )
    
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")
    
    # Convert 'stimLev' to factor with the desired order
    combined_prop_VDT$stimLev <- factor(combined_prop_VDT$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_prop_VDT <- combined_prop_VDT %>%
        arrange(condition, stimLev)
    
     # Plotting
    ggplot(combined_prop_VDT, aes(x = stimLev, group = condition, color = condition)) +
        geom_point(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 1.2) +
        ylim(2, 4) +
        ggtitle("Average of Confidence Response - VDT") +
        geom_linerange(mapping = aes(ymin = diff_conf - diff_conf_se, ymax = diff_conf + diff_conf_se, linetype = condition), data = filter(combined_prop_VDT, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = same_conf - same_conf_se, ymax = same_conf + same_conf_se, linetype = condition), data = filter(combined_prop_VDT, condition == "Same")) +
        labs(caption = "Error bars represent standard error of the mean (SEM)") +
        xlab("Contrast Level") +
        ylab("Confidence Rating") +
        scale_color_manual(values = c("Different" = "#BC3C29FF",
                                      "Same" = "#0072B5FF"
                                      ),
                           labels = c("Different",
                                      "Same"
                                      )) +
        scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid"))
    
```
-->

### Within-subject SEM

```{r message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
VDT_conf_ws <- VDT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
VDT_conf_ws <- VDT_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_conf_ws <- VDT_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean) 

diff_average_confidence_VDT <- VDT_conf_ws %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_conf = mean(diff_prop, na.rm = T), 
                  diff_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_confidence_VDT <- VDT_conf_ws %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_conf = mean(same_prop), 
                  same_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

  combined_prop_VDT <- bind_rows(
        mutate(diff_average_confidence_VDT, condition = "Different"),
        mutate(same_average_confidence_VDT, condition = "Same")
    )
  
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")
    
    # Convert 'stimLev' to factor with the desired order
    combined_prop_VDT$stimLev <- factor(combined_prop_VDT$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_prop_VDT <- combined_prop_VDT %>%
        arrange(condition, stimLev)
    
    # Plotting
    ggplot(combined_prop_VDT, aes(x = stimLev, group = condition, color = condition)) +
        geom_point(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 1.2) +
        ylim(2, 4) +
        ggtitle("Average of Confidence Response - VDT") +
        geom_linerange(mapping = aes(ymin = diff_conf - diff_conf_se, ymax = diff_conf + diff_conf_se, linetype = condition), data = filter(combined_prop_VDT, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = same_conf - same_conf_se, ymax = same_conf + same_conf_se, linetype = condition), data = filter(combined_prop_VDT, condition == "Same")) +
        labs(caption = "Error bars represent within-subject SEM") +
        xlab("Contrast Level") +
        ylab("Confidence Rating") +
        scale_color_manual(values = c("Different" = "#BC3C29FF",
                                      "Same" = "#0072B5FF"
                                      ),
                           labels = c("Different",
                                      "Same"
                                      )) +
        scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid"))
    

```


### Handgrip manipulation

#### Binary 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
VDT_conf_ws <- VDT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
VDT_conf_ws <- VDT_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_conf_ws <- VDT_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean) 

diff_average_high_confidence_VDT <- VDT_conf_ws %>%
        filter(isStrength == 1) %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_high_conf = mean(diff_prop, na.rm = T), 
                  diff_high_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

diff_average_low_confidence_VDT <- VDT_conf_ws %>%
        filter(isStrength == 0) %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_low_conf = mean(diff_prop, na.rm = T), 
                  diff_low_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()


same_average_high_confidence_VDT <- VDT_conf_ws %>%
        filter(isStrength == 1) %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_high_conf = mean(same_prop, na.rm = T), 
                  same_high_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_low_confidence_VDT <- VDT_conf_ws %>%
        filter(isStrength == 0) %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_low_conf = mean(same_prop, na.rm = T), 
                  same_low_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()


combined_conf_grip_VDT <- bind_rows(
        mutate(diff_average_high_confidence_VDT, condition = "Different - High Grip"),
        mutate(diff_average_low_confidence_VDT, condition = "Different - Low Grip" ),
        mutate(same_average_high_confidence_VDT, condition = "Same - High Grip"),
        mutate(same_average_low_confidence_VDT, condition = "Same - Low Grip")
)
  
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")
    
    # Convert 'stimLev' to factor with the desired order
    combined_conf_grip_VDT$stimLev <- factor(combined_conf_grip_VDT$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_conf_grip_VDT <- combined_conf_grip_VDT %>%
        arrange(condition, stimLev)
    


ggplot(combined_conf_grip_VDT, aes(x = stimLev, color = condition)) +
  geom_point(aes(y = diff_high_conf), size = 3) +
  geom_line(aes(y = diff_high_conf, group = condition), size = 1.2) +
  geom_linerange(aes(ymin = diff_high_conf - diff_high_conf_se, 
                     ymax = diff_high_conf + diff_high_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  geom_point(aes(y = diff_low_conf), size = 3) +
  geom_line(aes(y = diff_low_conf, group = condition), size = 1.2, linetype = "solid") +
  geom_linerange(aes(ymin = diff_low_conf - diff_low_conf_se, 
                     ymax = diff_low_conf + diff_low_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  geom_point(aes(y = same_high_conf), size = 3) +
  geom_line(aes(y = same_high_conf, group = condition), size = 1.2) +
  geom_linerange(aes(ymin = same_high_conf - same_high_conf_se, 
                     ymax = same_high_conf + same_high_conf_se, group = condition), 
                  linetype = "solid") +
  geom_point(aes(y = same_low_conf), size = 3) +
  geom_line(aes(y = same_low_conf, group = condition), size = 1.2, linetype = "solid") +
  geom_linerange(aes(ymin = same_low_conf - same_low_conf_se, 
                     ymax = same_low_conf + same_low_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  ggtitle("Average of Confidence Response - VDT") +
  ylim(2,4)+
  labs(caption = "Error bars represent within-subject SEM", x = "Oddball Level", y = "Confidence Rating") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                     name = "Response Type") +
  scale_linetype_manual(values = c("solid", "solid"), name = "Condition",
                        labels = c("High Grip", "Low Grip")) 



```


# CDT {.tabset .tabset-fade .tabset-pills}

## Prportion of Responding 'Different' 

<!--
### with traditional SEM

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_CDT <- CDT %>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE)) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(diff_sub)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_CDT <- CDT %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE)) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(same_sub)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_CDT <- bind_rows(
  mutate(Diff_prop_CDT, condition = "Different", prop = diff),
  mutate(Same_prop_CDT, condition = "Same", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "5", "20", "45", "90")

# Convert 'stimLev' to factor with the desired order
combined_CDT$stimLev <- factor(combined_CDT$stimLev, levels = desired_order)

# Plotting with the modified 'stimLev'
ggplot(combined_CDT, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point(size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different", diff_se, not_diff_se), 
                                ymax = prop + ifelse(condition == "Different", diff_se, not_diff_se))) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - CDT'") +
  xlab("Degree") +
  ylab("Proportion") +
  labs(caption = "Error bars represent standard error of the mean (SEM)") +
  scale_color_manual(values = c("#BC3C29FF", "#0072B5FF")) +
  guides(color = guide_legend(title = "condition"))

```

-->


### within-subject SEM

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
CDT_acc_ws <- CDT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
CDT_acc_ws <- CDT_acc_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_acc_ws <- CDT_acc_ws %>%
  mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_CDT <- CDT_acc_ws %>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_CDT <- CDT_acc_ws %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_CDT <- bind_rows(
  mutate(Diff_prop_CDT, condition = "Different", prop = diff),
  mutate(Same_prop_CDT, condition = "Same", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "5", "20", "45", "90")

# Convert 'stimLev' to factor with the desired order
combined_CDT$stimLev <- factor(combined_CDT$stimLev, levels = desired_order)

# Plotting with the modified 'stimLev'
ggplot(combined_CDT, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point(size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different", diff_se, not_diff_se), 
                                ymax = prop + ifelse(condition == "Different", diff_se, not_diff_se))) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - CDT'") +
  xlab("Degree") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#0072B5FF")) +
  guides(color = guide_legend(title = "condition"))

```


### Handgrip manipulation

#### Binary 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
CDT_acc_ws <- CDT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
CDT_acc_ws <- CDT_acc_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_acc_ws <- CDT_acc_ws %>%
  mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_high_grip_CDT <- CDT_acc_ws %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

Diff_prop_low_grip_CDT <- CDT_acc_ws %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_high_grip_CDT <- CDT_acc_ws %>%
    filter(isStrength==1) %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

Same_prop_low_grip_CDT <- CDT_acc_ws %>%
    filter(isStrength==0) %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_grip_CDT <- bind_rows(
  mutate(Diff_prop_high_grip_CDT, condition = "Different - High Grip", prop = diff),
  mutate(Diff_prop_low_grip_CDT, condition = "Different - Low Grip", prop = diff),
  mutate(Same_prop_high_grip_CDT, condition = "Same - High Grip", prop = not_diff),
  mutate(Same_prop_low_grip_CDT, condition = "Same - Low Grip", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "5", "20", "45", "90")

# Convert 'stimLev' to factor with the desired order
combined_grip_CDT$stimLev <- factor(combined_grip_CDT$stimLev, levels = desired_order)

# Plotting
ggplot(combined_grip_CDT, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point( size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different - High Grip" | condition == "Different - Low Grip", diff_se, not_diff_se), 
                               ymax = prop + ifelse(condition == "Different - High Grip" | condition == "Different - Low Grip", diff_se, not_diff_se)), show.legend = FALSE) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - CDT'") +
  xlab("Degree") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("Different - High Grip" = "#BC3C29FF", "Different - Low Grip" = "#ea9999", "Same - High Grip" = "#0072B5FF", "Same - Low Grip" = "#CCE6FF")) +
  scale_linetype_manual(values = c("Different - High Grip" = "solid", "Different - Low Grip" = "solid", "Same - High Grip" = "solid", "Same - Low Grip" = "solid")) +
  guides(color = guide_legend(title = "Response Type", ncol = 1), linetype = "none")


```

#### Continuous 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}


lower_limit <- 0  # Lower limit
upper_limit <- 0.6  # Upper limit

# Filter the data based on the auc_rel_mvc limits
CDT_acc_ws <- CDT_acc_ws %>%
    filter(auc_rel_mvc <= upper_limit)
CDT_acc_ws <- CDT_acc_ws %>%
    filter(auc_rel_mvc <= upper_limit)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "5", "20", "45", "90")

# Convert 'stimLev' to factor with the desired order
CDT_acc_ws$stimLev <- factor(CDT_acc_ws$stimLev, levels = desired_order)


# Define the plot aesthetics
ggplot(CDT_acc_ws, aes(x = stimLev, y = auc_rel_mvc, color = factor(resp1_diff))) +
  
  # Add points for scatter plot
  #geom_point(alpha = 0.7) +
  
  # Set plot title and axis labels
  ggtitle("Relationship between Stimulus Level, Grip Force, and Same or Different - CDT") +
  xlab("Degree") +
  ylab("Relative Grip") +
  geom_jitter(alpha = 0.4, width = 0.2, height = 0.05) +

 # Customize legend
  scale_color_manual(values = c("#0072B5FF", "#BC3C29FF"), labels = c("Same (0)", "Different (1)")) +
  scale_size_manual(values = c(3, 6), labels = c("Same (0)", "Different (1)")) +
  guides(color = guide_legend(title = "Response Type"),
         size = guide_legend(title = "Response Type"))

```


#### Low vs High handgrip for each subject across oddball levels

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}
CDT$gf_trPer <- as.factor(CDT$gf_trPer)
CDT$gf_trPer <- recode_factor(CDT$gf_trPer, '0.05' = "Low", '0.4' = "High")
# Calculate individual subject responses
subject_responses_CDT_2 <- CDT %>%
  group_by(sub, stimLev, gf_trPer) %>%
  summarise(response = mean(resp1_diff, na.rm = TRUE)) %>%
  arrange(gf_trPer) %>%
  ungroup()

# Replace 'sub' with 'gf_trPer' for X-axis labels
subject_responses_CDT_2$gf_trPer <- factor(subject_responses_CDT_2$gf_trPer, levels = c("Low", "High"))

# Plotting
p10_CDT <- ggplot(subject_responses_CDT_2, aes(x = gf_trPer, y = response, color=gf_trPer, group = sub, text =   as.character(sub))) +
  geom_line(color = "gray") +
  geom_point(size = 2) +
  ggtitle("Proportion of Responding 'Different'") +
  scale_color_manual(values = c("#0072B5FF", "#BC3C29FF")) +
  xlab("Grip Level") +
  ylab("P('Different')") +
  facet_wrap(~stimLev, scales = "free_x", ncol = length(unique(subject_responses_CDT_2$stimLev)))+
  guides(color = guide_legend(title = "Grip Level"))

ggplotly(p10_CDT, tooltip = "text")

```



## Reaction time

<!--
### Using mean

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate mean RT for different responses
    Verid_diff_RT_CDT <- CDT %>%
        group_by(stimLev) %>%
        filter(resp1_diff == 1) %>%
        summarise(RT = mean(resp1RT),
                  RT_se = sd(resp1RT) / sqrt(length(resp1RT))) %>%
        distinct()
    
# Calculate mean RT for same responses
    Verid_same_RT_CDT <- CDT %>%
        group_by(stimLev) %>%
        filter(resp1_diff == 0) %>%
        summarise(RT = mean(resp1RT),
                  RT_se = sd(resp1RT) / sqrt(length(resp1RT))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_RT_CDT <- bind_rows(
        mutate(Verid_diff_RT_CDT, condition = "Different"),
        mutate(Verid_same_RT_CDT, condition = "Same")
    )
    
# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")
    
 # Convert 'stimLev' to factor with the desired order
combined_RT_CDT$stimLev <- factor(combined_RT_CDT$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
    combined_RT_CDT <- combined_RT_CDT %>%
        arrange(condition, stimLev)
    
# Plotting
    ggplot(combined_RT_CDT, aes(x = stimLev, y = RT, group = condition, color = condition, linetype= condition)) +
        geom_point(size = 2) +
        geom_line(size = 1.2) +
        ylim(min(combined_RT_CDT$RT), max(combined_RT_CDT$RT)) +
        ggtitle("Mean Reaction Time for Same and Different Responses - CDT") +
        geom_linerange(
            mapping = aes(ymin = RT - RT_se, ymax = RT + RT_se, linetype = condition)
        ) +
        labs(caption = "Error bars represent standard error of the mean (SEM)") +
        xlab("Degree") +
        ylab("Reaction Time (S)") +
        scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
        scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 
    
```

### Using median for within and mean for between subjects

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate mean RT for different responses
    Verid_diff_RT_CDT <- CDT %>%
        filter(resp1_diff == 1) %>%
        group_by(stimLev,sub) %>%
        summarise(diff_sub= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(RT_diff = mean(diff_sub),
                  RT_diff_se = sd(diff_sub) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean RT for same responses
    Verid_same_RT_CDT <- CDT %>%
       filter(resp1_diff == 0) %>%
        group_by(stimLev,sub) %>%
        summarise(diff_sub= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(RT_same = mean(diff_sub),
                  RT_same_se = sd(diff_sub) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_RT_CDT <- bind_rows(
        mutate(Verid_diff_RT_CDT, condition = "Different"),
        mutate(Verid_same_RT_CDT, condition = "Same")
    )
    
# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")
    
 # Convert 'stimLev' to factor with the desired order
combined_RT_CDT$stimLev <- factor(combined_RT_CDT$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
    combined_RT_CDT <- combined_RT_CDT %>%
        arrange(condition, stimLev)
    
# Plotting
ggplot(combined_RT_CDT, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
    geom_point(aes(y = ifelse(condition == "Different", RT_diff, RT_same)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", RT_diff, RT_same)), size = 1.2) +
    ylim(min(c(combined_RT_CDT$RT_diff, combined_RT_CDT$RT_same)), max(c(combined_RT_CDT$RT_diff, combined_RT_CDT$RT_same))) +
    ggtitle("Mean of Median Reaction Time for Same and Different Responses - CDT") +
    geom_linerange(mapping = aes(ymin = RT_diff - RT_diff_se, ymax = RT_diff + RT_diff_se, linetype = condition), data = filter(combined_RT_CDT, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = RT_same - RT_same_se, ymax = RT_same + RT_same_se, linetype = condition), data = filter(combined_RT_CDT, condition == "Same")) +
    labs(caption = "Error bars represent standard error of the mean (SEM)") +
    xlab("Degree") +
    ylab("Reaction Time (S)") +
    scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
    scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid"))
```



### Using median within and between subjects

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate median RT for different responses
    Verid_diff_RT_CDT <- CDT %>%
        filter(resp1_diff == 1) %>%
        group_by(stimLev,sub) %>%
        summarise(diff_sub= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(RT_diff = median(diff_sub),
                  RT_diff_se = sd(diff_sub) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate median RT for same responses
    Verid_same_RT_CDT <- CDT %>%
       filter(resp1_diff == 0) %>%
        group_by(stimLev,sub) %>%
        summarise(diff_sub= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(RT_same = median(diff_sub),
                  RT_same_se = sd(diff_sub) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_RT_CDT <- bind_rows(
        mutate(Verid_diff_RT_CDT, condition = "Different"),
        mutate(Verid_same_RT_CDT, condition = "Same")
    )
    
# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")
    
 # Convert 'stimLev' to factor with the desired order
combined_RT_CDT$stimLev <- factor(combined_RT_CDT$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
    combined_RT_CDT <- combined_RT_CDT %>%
        arrange(condition, stimLev)
    
# Plotting
ggplot(combined_RT_CDT, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
    geom_point(aes(y = ifelse(condition == "Different", RT_diff, RT_same)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", RT_diff, RT_same)), size = 1.2) +
    ylim(min(c(combined_RT_CDT$RT_diff, combined_RT_CDT$RT_same)), max(c(combined_RT_CDT$RT_diff, combined_RT_CDT$RT_same))) +
    ggtitle("Median of Reaction Time for Same and Different Responses - CDT") +
    geom_linerange(mapping = aes(ymin = RT_diff - RT_diff_se, ymax = RT_diff + RT_diff_se, linetype = condition), data = filter(combined_RT_CDT, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = RT_same - RT_same_se, ymax = RT_same + RT_same_se, linetype = condition), data = filter(combined_RT_CDT, condition == "Same")) +
    labs(caption = "Error bars represent standard error of the mean (SEM)") +
    xlab("Degree") +
    ylab("Reaction Time (S)") +
    scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
    scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid"))
```

-->

### Using Median with within-subject SEM

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}
# calculate subject mean
CDT_RT_ws <- CDT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
CDT_RT_ws <- CDT_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_RT_ws <- CDT_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 


# Calculate median RT for different responses
CDT_diff_RT_ws <- CDT_RT_ws %>%
  filter(resp1_diff == 1) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_diff = median(diff_sub),
            medRT_diff_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Calculate median RT for same responses
CDT_same_RT_ws <- CDT_RT_ws %>%
  filter(resp1_diff == 0) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_same = median(diff_sub),
            medRT_same_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Combine both datasets for plotting
combined_RT_CDT <- bind_rows(
  mutate(CDT_diff_RT_ws, condition = "Different"),
  mutate(CDT_same_RT_ws, condition = "Same")
)


# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")

# Convert 'stimLev' to factor with the desired order
combined_RT_CDT$stimLev <- factor(combined_RT_CDT$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
combined_RT_CDT <- combined_RT_CDT %>%
  arrange(condition, stimLev)

# Plotting
ggplot(combined_RT_CDT, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
  geom_point(aes(y = ifelse(condition == "Different", medRT_diff , medRT_same)), size = 2) +
  geom_line(aes(y = ifelse(condition == "Different", medRT_diff, medRT_same)), size = 1.2) +
  ylim(min(c(combined_RT_CDT$medRT_diff, combined_RT_CDT$medRT_same)), max(c(combined_RT_CDT$medRT_diff, combined_RT_CDT$medRT_same))) +
  ggtitle("Median of Reaction Time for Same and Different Responses - CDT") +
  geom_linerange(mapping = aes(ymin = medRT_diff - medRT_diff_se, ymax = medRT_diff + medRT_diff_se, linetype = condition), data = filter(combined_RT_CDT, condition == "Different")) +
  geom_linerange(mapping = aes(ymin = medRT_same - medRT_same_se, ymax = medRT_same + medRT_same_se, linetype = condition), data = filter(combined_RT_CDT, condition == "Same")) +
  labs(caption = "Error bars represent within-subject SEM") +
  xlab("Degree") +
  ylab("Reaction Time (S)") +
  scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
  scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 
```


### Handgrip manipulation

#### Binary 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
CDT_RT_ws <- CDT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calcualte the grand mean
CDT_RT_ws <- CDT_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_RT_ws <- CDT_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 

# Calculate mean RT and standard error for  High 'Different'
RT_diff_high_grip_CDT <- CDT_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_diff=median(diff_sub), medRT_high_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Different'
RT_diff_low_grip_CDT <- CDT_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_diff=median(diff_sub), medRT_low_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Calculate mean RT and standard error for  High 'Same'
RT_same_high_grip_CDT <- CDT_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_same=median(diff_sub), medRT_high_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Same'
RT_same_low_grip_CDT <- CDT_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_same=median(diff_sub), medRT_low_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Combine both datasets for plotting
combined_RT_grip_CDT <- bind_rows(
  mutate(RT_diff_high_grip_CDT, condition = "Different - High Grip"),
  mutate(RT_diff_low_grip_CDT, condition = "Different - Low Grip"),
  mutate(RT_same_high_grip_CDT, condition = "Same - High Grip"),
  mutate(RT_same_low_grip_CDT, condition = "Same - Low Grip")
)

# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")

# Convert 'stimLev' to factor with the desired order
combined_RT_grip_CDT$stimLev <- factor(combined_RT_grip_CDT$stimLev, levels = desired_order)


# Plotting without jitter
ggplot(data = combined_RT_grip_CDT) +
  geom_point(aes(x = stimLev, y = medRT_high_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_diff - medRT_high_diff_se, 
                     ymax = medRT_high_diff + medRT_high_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_diff - medRT_low_diff_se, 
                     ymax = medRT_low_diff + medRT_low_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_high_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_same - medRT_high_same_se, 
                     ymax = medRT_high_same + medRT_high_same_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_same - medRT_low_same_se, 
                     ymax = medRT_low_same + medRT_low_same_se, color = condition), 
                 linetype = "solid") +
  
  ggtitle("Median of Reaction Time for Same and Different Responses - CDT") +
  xlab("Degree") +
  ylab("Median Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                      name = "Condition") 


```


## Confidence

<!--
### With traditional SEM

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

diff_average_confidence_CDT <- CDT %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_conf = mean(diff_prop, na.rm = T), 
                  diff_conf_se = sd(diff_prop, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_confidence_CDT <- CDT %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE)) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_conf = mean(same_prop), 
                  same_conf_se = sd(same_prop) / sqrt(n_distinct(sub))) %>%
        distinct()

  combined_prop_CDT <- bind_rows(
        mutate(diff_average_confidence_CDT, condition = "Different"),
        mutate(same_average_confidence_CDT, condition = "Same")
    )

#####
#    # Calculate mean proportion of 'Different' responses for high confidence trials
#    diff_high_confidence_CDT <- CDT %>%
#        group_by(stimLev) %>%
#        filter(resp2_bin_med == 1) %>%
#        summarise(diff_prop = mean(resp1_diff, na.rm = TRUE),
#                  diff_prop_se = sd(resp1_diff, na.rm = TRUE) / sqrt(length(resp1_diff))) %>%
#        distinct()
    
#    # Calculate mean proportion of 'Same' responses for high confidence trials
#    same_high_confidence_CDT <- diff_high_confidence_CDT %>%
#        mutate(not_diff = 1 - diff_prop)
    
#    # Calculate mean proportion of 'Different' responses for low confidence trials
#    diff_low_confidence_CDT <- CDT %>%
#        group_by(stimLev) %>%
#        filter(resp2_bin_med == 0) %>%
#        summarise(diff_prop = mean(resp1_diff, na.rm = TRUE),
#                  diff_prop_se = sd(resp1_diff, na.rm = TRUE) / sqrt(length(resp1_diff))) %>%
#        distinct()
    
    # Calculate mean proportion of 'Same' responses for low confidence trials
#    same_low_confidence_CDT <- diff_low_confidence_CDT %>%
#        mutate(not_diff = 1 - diff_prop)
    
    # Combine both datasets for plotting
#    combined_prop_CDT <- bind_rows(
#        mutate(diff_high_confidence_CDT, condition = "High Confidence - Different", prop = diff_prop),
#        mutate(same_high_confidence_CDT, condition = "High Confidence - Same", prop = not_diff),
#        mutate(diff_low_confidence_CDT, condition = "Low Confidence - Different", prop = diff_prop),
#        mutate(same_low_confidence_CDT, condition = "Low Confidence - Same", prop = not_diff)
#    )
#####    
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")
    
    # Convert 'stimLev' to factor with the desired order
    combined_prop_CDT$stimLev <- factor(combined_prop_CDT$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_prop_CDT <- combined_prop_CDT %>%
        arrange(condition, stimLev)
    
  # Plotting
    ggplot(combined_prop_CDT, aes(x = stimLev, group = condition, color = condition)) +
        geom_point(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 1.2) +
        ylim(2, 4) +
        ggtitle("Average of Confidence Response - CDT") +
        geom_linerange(mapping = aes(ymin = diff_conf - diff_conf_se, ymax = diff_conf + diff_conf_se, linetype = condition), data = filter(combined_prop_CDT, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = same_conf - same_conf_se, ymax = same_conf + same_conf_se, linetype = condition), data = filter(combined_prop_CDT, condition == "Same")) +
        labs(caption = "Error bars represent standard error of the mean (SEM)") +
        xlab("Degree") +
        ylab("Confidence Rating") +
        scale_color_manual(values = c("Different" = "#BC3C29FF",
                                      "Same" = "#0072B5FF"
                                      ),
                           labels = c("Different",
                                      "Same"
                                      )) +
        scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid"))
    
```
-->

### Within-subject SEM

```{r message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
CDT_conf_ws <- CDT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
CDT_conf_ws <- CDT_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_conf_ws <- CDT_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean) 

diff_average_confidence_CDT <- CDT_conf_ws %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_conf = mean(diff_prop, na.rm = T), 
                  diff_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_confidence_CDT <- CDT_conf_ws %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_conf = mean(same_prop), 
                  same_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

  combined_prop_CDT <- bind_rows(
        mutate(diff_average_confidence_CDT, condition = "Different"),
        mutate(same_average_confidence_CDT, condition = "Same")
    )
  
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")
    
    # Convert 'stimLev' to factor with the desired order
    combined_prop_CDT$stimLev <- factor(combined_prop_CDT$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_prop_CDT <- combined_prop_CDT %>%
        arrange(condition, stimLev)
    
    # Plotting
    ggplot(combined_prop_CDT, aes(x = stimLev, group = condition, color = condition)) +
        geom_point(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 1.2) +
        ylim(2, 4) +
        ggtitle("Average of Confidence Response - CDT") +
        geom_linerange(mapping = aes(ymin = diff_conf - diff_conf_se, ymax = diff_conf + diff_conf_se, linetype = condition), data = filter(combined_prop_CDT, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = same_conf - same_conf_se, ymax = same_conf + same_conf_se, linetype = condition), data = filter(combined_prop_CDT, condition == "Same")) +
        labs(caption = "Error bars represent within-subject SEM") +
        xlab("Degree") +
        ylab("Confidence Rating") +
        scale_color_manual(values = c("Different" = "#BC3C29FF",
                                      "Same" = "#0072B5FF"
                                      ),
                           labels = c("Different",
                                      "Same"
                                      )) +
        scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid"))
    

```


### Handgrip manipulation

#### Binary 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
CDT_conf_ws <- CDT %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
CDT_conf_ws <- CDT_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_conf_ws <- CDT_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean) 

diff_average_high_confidence_CDT <- CDT_conf_ws %>%
        filter(isStrength == 1) %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_high_conf = mean(diff_prop, na.rm = T), 
                  diff_high_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

diff_average_low_confidence_CDT <- CDT_conf_ws %>%
        filter(isStrength == 0) %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_low_conf = mean(diff_prop, na.rm = T), 
                  diff_low_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()


same_average_high_confidence_CDT <- CDT_conf_ws %>%
        filter(isStrength == 1) %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_high_conf = mean(same_prop, na.rm = T), 
                  same_high_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_low_confidence_CDT <- CDT_conf_ws %>%
        filter(isStrength == 0) %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_low_conf = mean(same_prop, na.rm = T), 
                  same_low_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()


combined_conf_grip_CDT <- bind_rows(
        mutate(diff_average_high_confidence_CDT, condition = "Different - High Grip"),
        mutate(diff_average_low_confidence_CDT, condition = "Different - Low Grip" ),
        mutate(same_average_high_confidence_CDT, condition = "Same - High Grip"),
        mutate(same_average_low_confidence_CDT, condition = "Same - Low Grip")
)
  
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")
    
    # Convert 'stimLev' to factor with the desired order
    combined_conf_grip_CDT$stimLev <- factor(combined_conf_grip_CDT$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_conf_grip_CDT <- combined_conf_grip_CDT %>%
        arrange(condition, stimLev)
    


ggplot(combined_conf_grip_CDT, aes(x = stimLev, color = condition)) +
  geom_point(aes(y = diff_high_conf), size = 3) +
  geom_line(aes(y = diff_high_conf, group = condition), size = 1.2) +
  geom_linerange(aes(ymin = diff_high_conf - diff_high_conf_se, 
                     ymax = diff_high_conf + diff_high_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  geom_point(aes(y = diff_low_conf), size = 3) +
  geom_line(aes(y = diff_low_conf, group = condition), size = 1.2, linetype = "solid") +
  geom_linerange(aes(ymin = diff_low_conf - diff_low_conf_se, 
                     ymax = diff_low_conf + diff_low_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  geom_point(aes(y = same_high_conf), size = 3) +
  geom_line(aes(y = same_high_conf, group = condition), size = 1.2) +
  geom_linerange(aes(ymin = same_high_conf - same_high_conf_se, 
                     ymax = same_high_conf + same_high_conf_se, group = condition), 
                  linetype = "solid") +
  geom_point(aes(y = same_low_conf), size = 3) +
  geom_line(aes(y = same_low_conf, group = condition), size = 1.2, linetype = "solid") +
  geom_linerange(aes(ymin = same_low_conf - same_low_conf_se, 
                     ymax = same_low_conf + same_low_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  ggtitle("Average of Confidence Response - CDT") +
  labs(caption = "Error bars represent within-subject SEM", x = "Degree", y = "Confidence Rating") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                     name = "Response Type") +
  ylim(2,4)+
  scale_linetype_manual(values = c("solid", "solid"), name = "Condition",
                        labels = c("High Grip", "Low Grip")) 




```

# MST {.tabset .tabset-fade .tabset-pills}

## Prportion of Responding 'Old', 'Similar', and 'New' 

<!--
### With traditional SEM

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate mean proportion for old responses
    Old_prop_MST <- MST %>%
        filter(resp1 == 'old') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(resp1_prop = sum(resp1 == 'old') / 64) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(prop_old = mean(resp1_prop, na.rm = T),
                  prop_old_se = sd(resp1_prop, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
# Calculate mean proportion for sim responses
    Sim_prop_MST <- MST %>%
        filter(resp1 == 'sim') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(resp1_prop = sum(resp1 == 'sim') / 64) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(prop_sim = mean(resp1_prop, na.rm = T),
                  prop_sim_se = sd(resp1_prop, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
# Calculate mean proportion for new responses
    New_prop_MST <- MST %>%
        filter(resp1 == 'new') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(resp1_prop = sum(resp1 == 'new') / 64) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(prop_new = mean(resp1_prop, na.rm = T),
                  prop_new_se = sd(resp1_prop, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_prop_MST <- bind_rows(
        mutate(Old_prop_MST, condition = "Old"),
        mutate(Sim_prop_MST, condition = "Similar"),
        mutate(New_prop_MST, condition = "New")
    )

# Specify the desired order of levels for 'stimlev_mst'
desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")

# Convert 'stimlev_mst' to factor with the desired order
combined_prop_MST$stimlev_mst <- factor(combined_prop_MST$stimlev_mst, levels = desired_order)


# Plotting
ggplot(combined_prop_MST, aes(x = stimlev_mst)) +
  geom_line(aes(y = prop_old, group = condition, color = "Old"), size = 1.2) +
  geom_line(aes(y = prop_sim, group = condition, color = "Similar"), size = 1.2) +
  geom_line(aes(y = prop_new, group = condition, color = "New"), size = 1.2) +
  geom_point(aes(y = prop_old, color = "Old"), size = 2) +
  geom_point(aes(y = prop_sim, color = "Similar"), size = 2) +
  geom_point(aes(y = prop_new, color = "New"), size = 2) +
  geom_linerange(aes(ymin = prop_old - prop_old_se, ymax = prop_old + prop_old_se), color = "#0072B5FF", size = 0.5) +
  geom_linerange(aes(ymin = prop_sim - prop_sim_se, ymax = prop_sim + prop_sim_se), color = "#20854EFF", size = 0.5) +
  geom_linerange(aes(ymin = prop_new - prop_new_se, ymax = prop_new + prop_new_se), color = "#BC3C29FF", size = 0.5) +
  ggtitle("Proportions of Old, Similar, and New Responses - MST") +
  xlab("Stimulus Level") +
  ylab("Proportion") +
  labs(caption = "Error bars represent standard error of the mean (SEM)") +
  scale_color_manual(values=c("Old"="#0072B5FF", "New"="#BC3C29FF", "Similar"="#20854EFF")) +
  guides(color = guide_legend(title = "Response Type"))

```

-->


### Within-subject SEM


```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
    MST_acc_ws <- MST %>%
      group_by(sub, stimlev_mst, resp1_diff) %>%
      mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
      distinct() %>%
      ungroup()

# calculate the grand mean
    MST_acc_ws <- MST_acc_ws %>%
      group_by(sub) %>%
      mutate(grand_mean = mean(sub_mean)) %>%
      ungroup()

# subtract the subject mean and add grand mean for each cell

    MST_acc_ws <- MST_acc_ws %>%
      mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean proportion for old responses
    Old_prop_MST <- MST_acc_ws %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_old = case_when(resp1 == 'old' ~ 1, TRUE ~ 0)) %>%  # Corrected the syntax for case_when
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_old = mean(resp1_old, na.rm = T),
                prop_old_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
        
# Calculate mean proportion for sim responses
    Sim_prop_MST <- MST_acc_ws %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_sim = case_when(resp1 == 'sim' ~ 1, TRUE ~ 0)) %>%  # Corrected the syntax for case_when
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_sim = mean(resp1_sim, na.rm = T),
                prop_sim_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
# Calculate mean proportion for new responses
    New_prop_MST <- MST_acc_ws %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_new = case_when(resp1 == 'new' ~ 1, TRUE ~ 0)) %>%  # Corrected the syntax for case_when
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_new = mean(resp1_new, na.rm = T),
                prop_new_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
# Combine both datasets for plotting
     combined_prop_MST <- bind_rows(
        mutate(Old_prop_MST, condition = "Old"),
        mutate(Sim_prop_MST, condition = "Similar"),
        mutate(New_prop_MST, condition = "New")
    )
    combined_prop_MST$stimlev_mst <- factor(combined_prop_MST$stimlev_mst, levels = desired_order)

# Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")

# Convert 'stimlev_mst' to factor with the desired order
  combined_prop_MST$stimlev_mst <- factor(combined_prop_MST$stimlev_mst, levels = desired_order)



# Plotting
ggplot(combined_prop_MST, aes(x = stimlev_mst)) +
  geom_line(aes(y = prop_old, group = condition, color = "Old"), size = 1.2) +
  geom_line(aes(y = prop_sim, group = condition, color = "Similar"), size = 1.2) +
  geom_line(aes(y = prop_new, group = condition, color = "New"), size = 1.2) +
  geom_point(aes(y = prop_old, color = "Old"), size = 2) +
  geom_point(aes(y = prop_sim, color = "Similar"), size = 2) +
  geom_point(aes(y = prop_new, color = "New"), size = 2) +
  geom_linerange(aes(ymin = prop_old - prop_old_se, ymax = prop_old + prop_old_se), color = "#0072B5FF", size = 0.5) +
  geom_linerange(aes(ymin = prop_sim - prop_sim_se, ymax = prop_sim + prop_sim_se), color = "#20854EFF", size = 0.5) +
  geom_linerange(aes(ymin = prop_new - prop_new_se, ymax = prop_new + prop_new_se), color = "#BC3C29FF", size = 0.5) +
  ggtitle("Proportions of Old, Similar, and New Responses - MST") +
  xlab("Stimulus Level") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values=c("Old"="#0072B5FF", "New"="#BC3C29FF", "Similar"="#20854EFF")) +
  guides(color = guide_legend(title = "Response Type"))

      

```


### Handgrip manipulation

#### Binary

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
    MST_acc_ws <- MST %>%
      group_by(sub, stimlev_mst, resp1_diff) %>%
      mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
      distinct() %>%
      ungroup()

# calculate the grand mean
    MST_acc_ws <- MST_acc_ws %>%
      group_by(sub) %>%
      mutate(grand_mean = mean(sub_mean)) %>%
      ungroup()

# subtract the subject mean and add grand mean for each cell

    MST_acc_ws <- MST_acc_ws %>%
      mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean proportion for high - old responses
    Old_prop_high_grip_MST <- MST_acc_ws %>%
      filter(isStrength==1) %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_old = case_when(resp1 == 'old' ~ 1, TRUE ~ 0)) %>% 
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_old_high = mean(resp1_old, na.rm = T),
                prop_old_high_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()

# Calculate mean proportion for low - old responses
    Old_prop_low_grip_MST <- MST_acc_ws %>%
      filter(isStrength==0) %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_old = case_when(resp1 == 'old' ~ 1, TRUE ~ 0)) %>% 
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_old_low = mean(resp1_old, na.rm = T),
                prop_old_low_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()    
    
# Calculate mean proportion for high-sim responses
    Sim_prop_high_grip_MST <- MST_acc_ws %>%
      filter(isStrength==1) %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_sim = case_when(resp1 == 'sim' ~ 1, TRUE ~ 0)) %>%  
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_sim_high = mean(resp1_sim, na.rm = T),
                prop_sim_high_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
# Calculate mean proportion for low-sim responses
    Sim_prop_low_grip_MST <- MST_acc_ws %>%
      filter(isStrength==0) %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_sim = case_when(resp1 == 'sim' ~ 1, TRUE ~ 0)) %>%  
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_sim_low = mean(resp1_sim, na.rm = T),
                prop_sim_low_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
        
# Calculate mean proportion for high-new responses
    New_prop_high_grip_MST <- MST_acc_ws %>%
      filter(isStrength==1) %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_new = case_when(resp1 == 'new' ~ 1, TRUE ~ 0)) %>%  
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_new_high = mean(resp1_new, na.rm = T),
                prop_new_high_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
   
# Calculate mean proportion for low-new responses
    New_prop_low_grip_MST <- MST_acc_ws %>%
      filter(isStrength==0) %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_new = case_when(resp1 == 'new' ~ 1, TRUE ~ 0)) %>%  
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_new_low = mean(resp1_new, na.rm = T),
                prop_new_low_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
    
# Combine both datasets for plotting
combined_grip_MST <- bind_rows(
  mutate(Old_prop_high_grip_MST, condition = "Old - High Grip", prop = prop_old_high),
  mutate(Old_prop_low_grip_MST, condition = "Old - Low Grip", prop = prop_old_low),
  mutate(Sim_prop_high_grip_MST, condition = "Similar - High Grip", prop = prop_sim_high),
  mutate(Sim_prop_low_grip_MST, condition = "Similar - Low Grip", prop = prop_sim_low),
  mutate(New_prop_high_grip_MST, condition = "New - High Grip", prop = prop_new_high),
  mutate(New_prop_low_grip_MST, condition = "New - Low Grip", prop = prop_new_low)
)

  combined_prop_MST$stimlev_mst <- factor(combined_prop_MST$stimlev_mst, levels = desired_order)

# Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")

# Convert 'stimlev_mst' to factor with the desired order
  combined_prop_MST$stimlev_mst <- factor(combined_prop_MST$stimlev_mst, levels = desired_order)



# Plotting
ggplot(combined_grip_MST, aes(x = stimlev_mst, y = prop, group = condition, color = condition)) +
  geom_point(size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(grepl("Old", condition), prop_old_high_se, ifelse(grepl("Similar", condition), prop_sim_high_se, prop_new_high_se)),
                                  ymax = prop + ifelse(grepl("Old", condition), prop_old_high_se, ifelse(grepl("Similar", condition), prop_sim_high_se, prop_new_high_se)),
                                  color = condition),
                    show.legend = FALSE) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(grepl("Old", condition), prop_old_low_se, ifelse(grepl("Similar", condition), prop_sim_low_se, prop_new_low_se)),
                                  ymax = prop + ifelse(grepl("Old", condition), prop_old_low_se, ifelse(grepl("Similar", condition), prop_sim_low_se, prop_new_low_se)),
                                  color = condition),
                    show.legend = FALSE) +
  ylim(0, 1) +
  ggtitle("Proportions of Old, Similar, and New Responses - MST") +
  xlab("Similarity level") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("New - High Grip" = "#BC3C29FF", "New - Low Grip" = "#ea9999", "Old - High Grip" = "#0072B5FF", "Old - Low Grip" = "#CCE6FF", "Similar - High Grip" = "#20854EFF", "Similar - Low Grip" = "#a7eac6")) +
  scale_linetype_manual(values = c("New - High Grip" = "solid", "New - Low Grip" = "solid", "Old - High Grip" = "solid", "Old - Low Grip" = "solid", "Similar - High Grip" = "solid", "Similar - Low Grip" = "solid")) +
  guides(color = guide_legend(title = "Response Type", ncol = 1), linetype = "none")



```


#### Continuous 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

lower_limit <- 0  # Lower limit
upper_limit <- 0.6  # Upper limit

# Filter the data based on the auc_rel_mvc limits
MST_acc_ws <- MST_acc_ws %>%
    filter(auc_rel_mvc <= upper_limit)
MST_acc_ws <- MST_acc_ws %>%
    filter(auc_rel_mvc <= upper_limit)

# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")

# Convert 'stimLev' to factor with the desired order
MST_acc_ws$stimlev_mst <- factor(MST_acc_ws$stimlev_mst, levels = desired_order)


# Define the plot aesthetics
ggplot(MST_acc_ws, aes(x = stimlev_mst, y = auc_rel_mvc, color = factor(resp1_diff))) +
  
  # Add points for scatter plot
  #geom_point(alpha = 0.7) +
  
  # Set plot title and axis labels
  ggtitle("Relationship between Stimulus Level, Grip Force, and Old/Similar - MST") +
  xlab("Similarity level") +
  ylab("Relative Grip") +
  geom_jitter(alpha = 0.4, width = 0.2, height = 0.05) +

 # Customize legend
  scale_color_manual(values = c("#0072B5FF", "#BC3C29FF"), labels = c("Same (0)", "Different (1)")) +
  scale_size_manual(values = c(3, 6), labels = c("Same (0)", "Different (1)")) +
  guides(color = guide_legend(title = "Response Type"),
         size = guide_legend(title = "Response Type"))

```


#### Low vs High handgrip for each subject across oddball levels

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}
MST$gf_trPer <- as.factor(MST$gf_trPer)
MST$gf_trPer <- recode_factor(MST$gf_trPer, '0.05' = "Low", '0.4' = "High")
# Calculate individual subject responses
subject_responses_MST_2 <- MST %>%
  group_by(sub, stimlev_mst, gf_trPer) %>%
  summarise(response = mean(resp1_diff, na.rm = TRUE)) %>%
  arrange(gf_trPer) %>%
  ungroup()

# Replace 'sub' with 'gf_trPer' for X-axis labels
subject_responses_MST_2$gf_trPer <- factor(subject_responses_MST_2$gf_trPer, levels = c("Low", "High"))

# Plotting
p10_MST <- ggplot(subject_responses_MST_2, aes(x = gf_trPer, y = response, color=gf_trPer, group = sub, text =   as.character(sub))) +
  geom_line(color = "gray") +
  geom_point(size = 2) +
  ggtitle("Proportion of Responding 'Different' - MST") +
  scale_color_manual(values = c("#0072B5FF", "#BC3C29FF")) +
  xlab("Grip Level") +
  ylab("P('Different')") +
  facet_wrap(~stimlev_mst, scales = "free_x", ncol = length(unique(subject_responses_MST_2$stimlev_mst)))+
  guides(color = guide_legend(title = "Grip Level"))

ggplotly(p10_MST, tooltip = "text")

```

## Reaction time

<!--
### Using mean

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}
# Calculate mean RT for old responses
    Old_meanRT_MST <- MST %>%
        filter(resp1 == 'old') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= mean(resp1RT, na.rm = T)) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_old = mean(RT),
                  RT_old_se = sd(RT) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean RT for sim responses
    Sim_meanRT_MST <- MST %>%
        filter(resp1 == 'sim') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= mean(resp1RT, na.rm = T)) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_sim = mean(RT),
                  RT_sim_se = sd(RT) /sqrt(n_distinct(sub))) %>%
        distinct()
 
# Calculate mean RT for new responses
    New_meanRT_MST <- MST %>%
        filter(resp1 == 'new') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= mean(resp1RT, na.rm = T)) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_new = mean(RT),
                  RT_new_se = sd(RT) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_meanRT_MST <- bind_rows(
        mutate(Old_meanRT_MST, condition = "Old"),
        mutate(Sim_meanRT_MST, condition = "Similar"),
        mutate(New_meanRT_MST, condition = "New")
    )
    
# Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")
    
 # Convert 'stimlev_mst' to factor with the desired order
combined_meanRT_MST$stimlev_mst <- factor(combined_meanRT_MST$stimlev_mst, levels = desired_order)

#Sort the combined dataset by stimlev_mst within each condition
    combined_meanRT_MST <- combined_meanRT_MST %>%
        arrange(condition, stimlev_mst)
    
# Plotting
ggplot(combined_meanRT_MST, aes(x = stimlev_mst)) +
  geom_line(aes(y = RT_old, group = condition, color = "Old"), size = 1.2) +
  geom_line(aes(y = RT_sim, group = condition, color = "Similar"), size = 1.2) +
  geom_line(aes(y = RT_new, group = condition, color = "New"), size = 1.2) +
  geom_point(aes(y = RT_old, color = "Old"), size = 2) +
  geom_point(aes(y = RT_sim, color = "Similar"), size = 2) +
  geom_point(aes(y = RT_new, color = "New"), size = 2) +
  geom_linerange(aes(ymin = RT_old - RT_old_se, ymax = RT_old + RT_old_se), color = "#0072B5FF", size = 0.5) +
  geom_linerange(aes(ymin = RT_sim - RT_sim_se, ymax = RT_sim + RT_sim_se), color = "#20854EFF", size = 0.5) +
  geom_linerange(aes(ymin = RT_new - RT_new_se, ymax = RT_new + RT_new_se), color = "#BC3C29FF", size = 0.5) +
  ggtitle("Mean of Mean Reaction Time for Old, Similar, and New Responses") +
  xlab("Stimulus Level") +
  ylab("Mean Reaction Time") +
  scale_color_manual(values=c("Old"="#0072B5FF", "New"="#BC3C29FF", "Similar"="#20854EFF")) +
  guides(color = guide_legend(title = "Response Type"))

    
```


### Using median for within and mean for between subjects

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate mean RT for old responses
    Old_RT_MST <- MST %>%
        filter(resp1 == 'old') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_old = mean(RT),
                  RT_old_se = sd(RT) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean RT for sim responses
    Sim_RT_MST <- MST %>%
        filter(resp1 == 'sim') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_sim = mean(RT),
                  RT_sim_se = sd(RT) /sqrt(n_distinct(sub))) %>%
        distinct()
 
# Calculate mean RT for old responses
    New_RT_MST <- MST %>%
        filter(resp1 == 'new') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= median(resp1RT)) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_new = mean(RT),
                  RT_new_se = sd(RT) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_RT_MST <- bind_rows(
        mutate(Old_RT_MST, condition = "Old"),
        mutate(Sim_RT_MST, condition = "Similar"),
        mutate(New_RT_MST, condition = "New")
    )
    
# Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")
    
 # Convert 'stimlev_mst' to factor with the desired order
combined_RT_MST$stimlev_mst <- factor(combined_RT_MST$stimlev_mst, levels = desired_order)

#Sort the combined dataset by stimlev_mst within each condition
    combined_RT_MST <- combined_RT_MST %>%
        arrange(condition, stimlev_mst)
    
# Plotting
ggplot(combined_RT_MST, aes(x = stimlev_mst)) +
  geom_line(aes(y = RT_old, group = condition, color = "Old"), size = 1.2) +
  geom_line(aes(y = RT_sim, group = condition, color = "Similar"), size = 1.2) +
  geom_line(aes(y = RT_new, group = condition, color = "New"), size = 1.2) +
  geom_point(aes(y = RT_old, color = "Old"), size = 2) +
  geom_point(aes(y = RT_sim, color = "Similar"), size = 2) +
  geom_point(aes(y = RT_new, color = "New"), size = 2) +
  geom_linerange(aes(ymin = RT_old - RT_old_se, ymax = RT_old + RT_old_se), color = "#0072B5FF", size = 0.5) +
  geom_linerange(aes(ymin = RT_sim - RT_sim_se, ymax = RT_sim + RT_sim_se), color = "#20854EFF", size = 0.5) +
  geom_linerange(aes(ymin = RT_new - RT_new_se, ymax = RT_new + RT_new_se), color = "#BC3C29FF", size = 0.5) +
  ggtitle("Mean of Median Reaction Time for Old, Similar, and New Responses") +
  xlab("Stimulus Level") +
  ylab("Mean Reaction Time") +
  scale_color_manual(values=c("Old"="#0072B5FF", "New"="#BC3C29FF", "Similar"="#20854EFF")) +
  guides(color = guide_legend(title = "Response Type"))


```
-->


### Using median within and between subjects

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
MST_RT_ws <- MST %>%
  group_by(sub, stimlev_mst, resp1) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
MST_RT_ws <- MST_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

MST_RT_ws <- MST_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 


# Calculate mean RT for old responses
    Old_medRT_MST <- MST_RT_ws %>%
        filter(resp1 == 'old') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= median(resp1RT),RT_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_old = median(RT),
                  RT_old_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean RT for sim responses
    Sim_medRT_MST <- MST_RT_ws %>%
        filter(resp1 == 'sim') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= median(resp1RT),RT_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_sim = median(RT),
                  RT_sim_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
        distinct()
 
# Calculate mean RT for old responses
    New_medRT_MST <- MST_RT_ws %>%
        filter(resp1 == 'new') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= median(resp1RT), RT_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_new = median(RT),
                  RT_new_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_medRT_MST <- bind_rows(
        mutate(Old_medRT_MST, condition = "Old"),
        mutate(Sim_medRT_MST, condition = "Similar"),
        mutate(New_medRT_MST, condition = "New")
    )
    
# Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")
    
 # Convert 'stimlev_mst' to factor with the desired order
combined_medRT_MST$stimlev_mst <- factor(combined_medRT_MST$stimlev_mst, levels = desired_order)

#Sort the combined dataset by stimlev_mst within each condition
    combined_medRT_MST <- combined_medRT_MST %>%
        arrange(condition, stimlev_mst)
    
# Plotting
ggplot(combined_medRT_MST, aes(x = stimlev_mst)) +
  geom_line(aes(y = RT_old, group = condition, color = "Old"), size = 1.2) +
  geom_line(aes(y = RT_sim, group = condition, color = "Similar"), size = 1.2) +
  geom_line(aes(y = RT_new, group = condition, color = "New"), size = 1.2) +
  geom_point(aes(y = RT_old, color = "Old"), size = 2) +
  geom_point(aes(y = RT_sim, color = "Similar"), size = 2) +
  geom_point(aes(y = RT_new, color = "New"), size = 2) +
  geom_linerange(aes(ymin = RT_old - RT_old_se, ymax = RT_old + RT_old_se), color = "#0072B5FF", size = 0.5) +
  geom_linerange(aes(ymin = RT_sim - RT_sim_se, ymax = RT_sim + RT_sim_se), color = "#20854EFF", size = 0.5) +
  geom_linerange(aes(ymin = RT_new - RT_new_se, ymax = RT_new + RT_new_se), color = "#BC3C29FF", size = 0.5) +
  ggtitle("Median of Median Reaction Time for Old, Similar, and New Responses - MST") +
  xlab("Stimulus Level") +
  ylab("Median Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values=c("Old"="#0072B5FF", "New"="#BC3C29FF", "Similar"="#20854EFF")) +
  guides(color = guide_legend(title = "Response Type"))

```



### Handgrip manipulation

#### Binary 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
MST_RT_ws <- MST %>%
  group_by(sub, stimlev_mst, resp1) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
MST_RT_ws <- MST_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

MST_RT_ws <- MST_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 

# Calculate median RT for high - old responses
    Old_RT_high_grip_MST <- MST_RT_ws %>%
      filter(isStrength==1) %>%
      filter(resp1=='old') %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_old_high = median(RT),
                RT_old_high_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()

# Calculate median RT for low - old responses
    Old_RT_low_grip_MST <- MST_RT_ws %>%
      filter(isStrength==0) %>%
      filter(resp1=='old') %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_old_low = median(RT),
                RT_old_low_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()    
    
# Calculate median RT for high-sim responses
    Sim_RT_high_grip_MST <- MST_RT_ws %>%
      filter(isStrength==1) %>%
      filter(resp1=='sim') %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_sim_high = median(RT),
                RT_sim_high_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
# Calculate median RT  for low-sim responses
    Sim_RT_low_grip_MST <- MST_RT_ws %>%
      filter(isStrength==0) %>%
      filter(resp1=='sim') %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_sim_low = median(RT),
                RT_sim_low_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
        
# Calculate median RT  for high-new responses
    New_RT_high_grip_MST <- MST_RT_ws %>%
      filter(resp1=='new') %>%
      filter(isStrength==1) %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_new_high = median(RT),
                RT_new_high_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
   
# Calculate median RT for low-new responses
    New_RT_low_grip_MST <- MST_RT_ws %>%
      filter(resp1=='new') %>%
      filter(isStrength==0) %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_new_low = median(RT),
                RT_new_low_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
    
# Combine both datasets for plotting
combined_RT_grip_MST <- bind_rows(
  mutate(Old_RT_high_grip_MST, condition = "Old - High Grip", RT = RT_old_high),
  mutate(Old_RT_low_grip_MST, condition = "Old - Low Grip", RT = RT_old_low),
  mutate(Sim_RT_high_grip_MST, condition = "Similar - High Grip", RT = RT_sim_high),
  mutate(Sim_RT_low_grip_MST, condition = "Similar - Low Grip", RT = RT_sim_low),
  mutate(New_RT_high_grip_MST, condition = "New - High Grip", RT = RT_new_high),
  mutate(New_RT_low_grip_MST, condition = "New - Low Grip", RT = RT_new_low)
)

  combined_RT_grip_MST$stimlev_mst <- factor(combined_RT_grip_MST$stimlev_mst, levels = desired_order)

# Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")

# Convert 'stimlev_mst' to factor with the desired order
  combined_RT_grip_MST$stimlev_mst <- factor(combined_RT_grip_MST$stimlev_mst, levels = desired_order)

# Plotting without jitter
ggplot(data = combined_RT_grip_MST) +
  geom_point(aes(x = stimlev_mst, y = RT_old_high, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_old_high, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_old_high - RT_old_high_se, 
                     ymax = RT_old_high + RT_old_high_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_old_low, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_old_low, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_old_low - RT_old_low_se, 
                     ymax = RT_old_low + RT_old_low_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_sim_high, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_sim_high, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_sim_high - RT_sim_high_se, 
                     ymax = RT_sim_high + RT_sim_high_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_sim_low, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_sim_low, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_sim_low - RT_sim_low_se, 
                     ymax = RT_sim_low + RT_sim_low_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_new_high, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_new_high, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_new_high - RT_new_high_se, 
                     ymax = RT_new_high + RT_new_high_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_new_low, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_new_low, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_new_low - RT_new_low_se, 
                     ymax = RT_new_low + RT_new_low_se, color = condition), 
                 linetype = "solid") +
  
  
  ggtitle("Median of Reaction Time for Same and Different Responses - MST") +
  xlab("Similarity level") +
  ylab("Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("New - High Grip" = "#BC3C29FF", "New - Low Grip" = "#ea9999", "Old - High Grip" = "#0072B5FF", "Old - Low Grip" = "#CCE6FF", "Similar - High Grip" = "#20854EFF", "Similar - Low Grip" = "#a7eac6")) +
  scale_linetype_manual(values = c("New - High Grip" = "solid", "New - Low Grip" = "solid", "Old - High Grip" = "solid", "Old - Low Grip" = "solid", "Similar - High Grip" = "solid", "Similar - Low Grip" = "solid")) +
  guides(color = guide_legend(title = "Response Type", ncol = 1), linetype = "none")


```


## Confidence

<!--
### With traditional SEM

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate mean confidence for old responses
    Old_conf_MST <- MST %>%
        filter(resp1 == 'old') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T)) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_old = mean(conf_prop, na.rm = T),
                  conf_old_se = sd(conf_prop, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
# Calculate mean confidence for sim responses
    Sim_conf_MST <- MST %>%
        filter(resp1 == 'sim') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T)) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_sim = mean(conf_prop, na.rm = T),
                  conf_sim_se = sd(conf_prop, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
# Calculate mean confidence for new responses
    New_conf_MST <- MST %>%
        filter(resp1 == 'new') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T)) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_new = mean(conf_prop, na.rm = T),
                  conf_new_se = sd(conf_prop, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_conf_MST <- bind_rows(
        mutate(Old_conf_MST, condition = "Old"),
        mutate(Sim_conf_MST, condition = "Similar"),
        mutate(New_conf_MST, condition = "New")
    )

#####
#diff_average_confidence_MST <- MST %>%
#        filter(resp1_diff== 1) %>%
#        group_by(stimlev_mst, sub) %>%
#        summarise(diff_prop = mean(resp2, na.rm = TRUE)) %>%
#        ungroup() %>%
#        group_by(stimlev_mst) %>%
#        summarise(diff_conf = mean(diff_prop, na.rm = T), 
#                  diff_conf_se = sd(diff_prop, na.rm=T) / sqrt(n_distinct(sub))) %>%
#        distinct()

#  same_average_confidence_MST <- MST %>%
#        filter(resp1_diff== 0) %>%
#        group_by(stimlev_mst, sub) %>%
#        summarise(same_prop = mean(resp2, na.rm = TRUE)) %>%
#        ungroup() %>%
#        group_by(stimlev_mst) %>%
#        summarise(same_conf = mean(same_prop), 
#                  same_conf_se = sd(same_prop) / sqrt(n_distinct(sub))) %>%
#        distinct()

#  combined_prop_MST <- bind_rows(
#        mutate(diff_average_confidence_MST, condition = "Different"),
#        mutate(same_average_confidence_MST, condition = "Same")
#    )

#    # Calculate mean proportion of 'Different' responses for high confidence trials
#    diff_high_confidence_MST <- MST %>%
#        group_by(stimlev_mst) %>%
#        filter(resp2_bin_med == 1) %>%
#        summarise(diff_prop = mean(resp1_diff, na.rm = TRUE),
#                  diff_prop_se = sd(resp1_diff, na.rm = TRUE) / sqrt(length(resp1_diff))) %>%
#        distinct()
#    
#    # Calculate mean proportion of 'Same' responses for high confidence trials
#    same_high_confidence_MST <- diff_high_confidence_MST %>%
#        mutate(not_diff = 1 - diff_prop)
#    
#    # Calculate mean proportion of 'Different' responses for low confidence trials
#    diff_low_confidence_MST <- MST %>%
#        group_by(stimlev_mst) %>%
#        filter(resp2_bin_med == 0) %>%
#        summarise(diff_prop = mean(resp1_diff, na.rm = TRUE),
#                  diff_prop_se = sd(resp1_diff, na.rm = TRUE) / sqrt(length(resp1_diff))) %>%
#        distinct()
    
#    # Calculate mean proportion of 'Same' responses for low confidence trials
#    same_low_confidence_MST <- diff_low_confidence_MST %>%
#        mutate(not_diff = 1 - diff_prop)
    
#    # Combine both datasets for plotting
#    combined_prop_MST <- bind_rows(
#        mutate(diff_high_confidence_MST, condition = "High Confidence - Different", prop = diff_prop),
#        mutate(same_high_confidence_MST, condition = "High Confidence - Same", prop = not_diff),
#        mutate(diff_low_confidence_MST, condition = "Low Confidence - Different", prop = diff_prop),
#        mutate(same_low_confidence_MST, condition = "Low Confidence - Same", prop = not_diff)
#    )
#####    
    
    # Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")
    
    # Convert 'stimlev_mst' to factor with the desired order
    combined_conf_MST$stimlev_mst <- factor(combined_conf_MST$stimlev_mst, levels = desired_order)
    
    # Sort the combined dataset by stimlev_mst within each condition
    combined_conf_MST <- combined_conf_MST %>%
        arrange(condition, stimlev_mst)
    
    # Plotting
    ggplot(combined_conf_MST, aes(x = stimlev_mst)) +
  geom_line(aes(y = conf_old, group = condition, color = "Old"), size = 1.2) +
  geom_line(aes(y = conf_sim, group = condition, color = "Similar"), size = 1.2) +
  geom_line(aes(y = conf_new, group = condition, color = "New"), size = 1.2) +
  geom_point(aes(y = conf_old, color = "Old"), size = 2) +
  geom_point(aes(y = conf_sim, color = "Similar"), size = 2) +
  geom_point(aes(y = conf_new, color = "New"), size = 2) +
  geom_linerange(aes(ymin = conf_old - conf_old_se, ymax = conf_old + conf_old_se), color = "#0072B5FF", size = 0.5) +
  geom_linerange(aes(ymin = conf_sim - conf_sim_se, ymax = conf_sim + conf_sim_se), color = "#20854EFF", size = 0.5) +
  geom_linerange(aes(ymin = conf_new - conf_new_se, ymax = conf_new + conf_new_se), color = "#BC3C29FF", size = 0.5) +
  ggtitle("Average of Confidence for Old, Similar, and New Responses - MST") +
  xlab("Stimulus Level") +
  ylab("Confidence Rating") +
  ylim(2,4)+
  labs(caption = "Error bars represent standard error of the mean (SEM)") +
  scale_color_manual(values=c("Old"="#0072B5FF", "New"="#BC3C29FF", "Similar"="#20854EFF")) +
  guides(color = guide_legend(title = "Response Type"))

    
```
-->

### Within-subject SEM

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# calculate subject mean
MST_conf_ws <- MST %>%
  group_by(sub, stimlev_mst, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
MST_conf_ws <- MST_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

MST_conf_ws <- MST_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean)

# Calculate mean confidence for old responses
    Old_conf_MST <- MST_conf_ws %>%
        filter(resp1 == 'old') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_old = mean(conf_prop, na.rm = T),
                  conf_old_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
# Calculate mean confidence for sim responses
    Sim_conf_MST <- MST_conf_ws %>%
        filter(resp1 == 'sim') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_sim = mean(conf_prop, na.rm = T),
                  conf_sim_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
# Calculate mean confidence for new responses
    New_conf_MST <- MST_conf_ws %>%
        filter(resp1 == 'new') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_new = mean(conf_prop, na.rm = T),
                  conf_new_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_conf_MST <- bind_rows(
        mutate(Old_conf_MST, condition = "Old"),
        mutate(Sim_conf_MST, condition = "Similar"),
        mutate(New_conf_MST, condition = "New")
    )

#####
#diff_average_confidence_MST <- MST %>%
#        filter(resp1_diff== 1) %>%
#        group_by(stimlev_mst, sub) %>%
#        summarise(diff_prop = mean(resp2, na.rm = TRUE)) %>%
#        ungroup() %>%
#        group_by(stimlev_mst) %>%
#        summarise(diff_conf = mean(diff_prop, na.rm = T), 
#                  diff_conf_se = sd(diff_prop, na.rm=T) / sqrt(n_distinct(sub))) %>%
#        distinct()

#  same_average_confidence_MST <- MST %>%
#        filter(resp1_diff== 0) %>%
#        group_by(stimlev_mst, sub) %>%
#        summarise(same_prop = mean(resp2, na.rm = TRUE)) %>%
#        ungroup() %>%
#        group_by(stimlev_mst) %>%
#        summarise(same_conf = mean(same_prop), 
#                  same_conf_se = sd(same_prop) / sqrt(n_distinct(sub))) %>%
#        distinct()

#  combined_prop_MST <- bind_rows(
#        mutate(diff_average_confidence_MST, condition = "Different"),
#        mutate(same_average_confidence_MST, condition = "Same")
#    )

#    # Calculate mean proportion of 'Different' responses for high confidence trials
#    diff_high_confidence_MST <- MST %>%
#        group_by(stimlev_mst) %>%
#        filter(resp2_bin_med == 1) %>%
#        summarise(diff_prop = mean(resp1_diff, na.rm = TRUE),
#                  diff_prop_se = sd(resp1_diff, na.rm = TRUE) / sqrt(length(resp1_diff))) %>%
#        distinct()
#    
#    # Calculate mean proportion of 'Same' responses for high confidence trials
#    same_high_confidence_MST <- diff_high_confidence_MST %>%
#        mutate(not_diff = 1 - diff_prop)
#    
#    # Calculate mean proportion of 'Different' responses for low confidence trials
#    diff_low_confidence_MST <- MST %>%
#        group_by(stimlev_mst) %>%
#        filter(resp2_bin_med == 0) %>%
#        summarise(diff_prop = mean(resp1_diff, na.rm = TRUE),
#                  diff_prop_se = sd(resp1_diff, na.rm = TRUE) / sqrt(length(resp1_diff))) %>%
#        distinct()
    
#    # Calculate mean proportion of 'Same' responses for low confidence trials
#    same_low_confidence_MST <- diff_low_confidence_MST %>%
#        mutate(not_diff = 1 - diff_prop)
    
#    # Combine both datasets for plotting
#    combined_prop_MST <- bind_rows(
#        mutate(diff_high_confidence_MST, condition = "High Confidence - Different", prop = diff_prop),
#        mutate(same_high_confidence_MST, condition = "High Confidence - Same", prop = not_diff),
#        mutate(diff_low_confidence_MST, condition = "Low Confidence - Different", prop = diff_prop),
#        mutate(same_low_confidence_MST, condition = "Low Confidence - Same", prop = not_diff)
#    )
#####    
    
    # Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")
    
    # Convert 'stimlev_mst' to factor with the desired order
    combined_conf_MST$stimlev_mst <- factor(combined_conf_MST$stimlev_mst, levels = desired_order)
    
    # Sort the combined dataset by stimlev_mst within each condition
    combined_conf_MST <- combined_conf_MST %>%
        arrange(condition, stimlev_mst)
    
    # Plotting
    ggplot(combined_conf_MST, aes(x = stimlev_mst)) +
  geom_line(aes(y = conf_old, group = condition, color = "Old"), size = 1.2) +
  geom_line(aes(y = conf_sim, group = condition, color = "Similar"), size = 1.2) +
  geom_line(aes(y = conf_new, group = condition, color = "New"), size = 1.2) +
  geom_point(aes(y = conf_old, color = "Old"), size = 2) +
  geom_point(aes(y = conf_sim, color = "Similar"), size = 2) +
  geom_point(aes(y = conf_new, color = "New"), size = 2) +
  geom_linerange(aes(ymin = conf_old - conf_old_se, ymax = conf_old + conf_old_se), color = "#0072B5FF", size = 0.5) +
  geom_linerange(aes(ymin = conf_sim - conf_sim_se, ymax = conf_sim + conf_sim_se), color = "#20854EFF", size = 0.5) +
  geom_linerange(aes(ymin = conf_new - conf_new_se, ymax = conf_new + conf_new_se), color = "#BC3C29FF", size = 0.5) +
  ggtitle("Average of Confidence for Old, Similar, and New Responses - MST") +
  xlab("Stimulus Level") +
  ylab("Confidence Rating") +
  ylim(2,4)+
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values=c("Old"="#0072B5FF", "New"="#BC3C29FF", "Similar"="#20854EFF")) +
  guides(color = guide_legend(title = "Response Type"))

    
```


### Handgrip manipulation

#### Binary 

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}


# calculate subject mean
MST_conf_ws <- MST %>%
  group_by(sub, stimlev_mst, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
MST_conf_ws <- MST_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

MST_conf_ws <- MST_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean)

# Calculate mean confidence for High old responses
    Old_conf_high_grip_MST <- MST_conf_ws %>%
        filter(isStrength==1) %>%
        filter(resp1 == 'old') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_high_old = mean(conf_prop, na.rm = T),
                  conf_high_old_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean confidence for low old responses
    Old_conf_low_grip_MST <- MST_conf_ws %>%
        filter(isStrength==0) %>%
        filter(resp1 == 'old') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_low_old = mean(conf_prop, na.rm = T),
                  conf_low_old_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean confidence for High sim responses
    Sim_conf_high_grip_MST <- MST_conf_ws %>%
        filter(isStrength==1) %>%
        filter(resp1 == 'sim') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_high_sim = mean(conf_prop, na.rm = T),
                  conf_high_sim_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean confidence for Low sim responses
    Sim_conf_low_grip_MST <- MST_conf_ws %>%
        filter(isStrength==0) %>%
        filter(resp1 == 'sim') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_low_sim = mean(conf_prop, na.rm = T),
                  conf_low_sim_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean confidence for High new responses
    New_conf_high_grip_MST <- MST_conf_ws %>%
        filter(isStrength ==1) %>%
        filter(resp1 == 'new') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_high_new = mean(conf_prop, na.rm = T),
                  conf_high_new_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
# Calculate mean confidence for Low new responses
    New_conf_low_grip_MST <- MST_conf_ws %>%
        filter(isStrength ==0) %>%
        filter(resp1 == 'new') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_low_new = mean(conf_prop, na.rm = T),
                  conf_low_new_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()    
    
# Combine both datasets for plotting
    combined_conf_grip_MST <- bind_rows(
        mutate(Old_conf_high_grip_MST, condition = "Old - High Grip"),
        mutate(Sim_conf_high_grip_MST, condition = "Similar - High Grip"),
        mutate(New_conf_high_grip_MST, condition = "New - High Grip"),
        mutate(Old_conf_low_grip_MST, condition = "Old - Low Grip"),
        mutate(Sim_conf_low_grip_MST, condition = "Similar - Low Grip"),
        mutate(New_conf_low_grip_MST, condition = "New - Low Grip")
    )

    
    # Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")
    
    # Convert 'stimlev_mst' to factor with the desired order
    combined_conf_grip_MST$stimlev_mst <- factor(combined_conf_grip_MST$stimlev_mst, levels = desired_order)
    
    # Sort the combined dataset by stimlev_mst within each condition
    combined_conf_grip_MST <- combined_conf_grip_MST %>%
        arrange(condition, stimlev_mst)
    
ggplot(combined_conf_grip_MST, aes(x = stimlev_mst)) +
  geom_line(aes(y = conf_high_old, group = condition, color = condition), size = 1.2) +
  geom_point(aes(y = conf_high_old, color = condition), size = 2) +
  geom_linerange(aes(ymin = conf_high_old - conf_high_old_se, ymax = conf_high_old + conf_high_old_se, color = condition), size = 0.5) +
  geom_line(aes(y = conf_high_sim, group = condition, color = condition), size = 1.2, linetype = "solid") +
  geom_point(aes(y = conf_high_sim, color = condition), size = 2) +
  geom_linerange(aes(ymin = conf_high_sim - conf_high_sim_se, ymax = conf_high_sim + conf_high_sim_se, color = condition), size = 0.5) +
  geom_line(aes(y = conf_high_new, group = condition, color = condition), size = 1.2, linetype = "solid") +
  geom_point(aes(y = conf_high_new, color = condition), size = 2) +
  geom_linerange(aes(ymin = conf_high_new - conf_high_new_se, ymax = conf_high_new + conf_high_new_se, color = condition), size = 0.5) +
  geom_line(aes(y = conf_low_old, group = condition, color = condition), size = 1.2) +
  geom_point(aes(y = conf_low_old, color = condition), size = 2) +
  geom_linerange(aes(ymin = conf_low_old - conf_low_old_se, ymax = conf_low_old + conf_low_old_se, color = condition), size = 0.5) +
  geom_line(aes(y = conf_low_sim, group = condition, color = condition), size = 1.2, linetype = "solid") +
  geom_point(aes(y = conf_low_sim, color = condition), size = 2) +
  geom_linerange(aes(ymin = conf_low_sim - conf_low_sim_se, ymax = conf_low_sim + conf_low_sim_se, color = condition), size = 0.5) +
  geom_line(aes(y = conf_low_new, group = condition, color = condition), size = 1.2, linetype = "solid") +
  geom_point(aes(y = conf_low_new, color = condition), size = 2) +
  geom_linerange(aes(ymin = conf_low_new - conf_low_new_se, ymax = conf_low_new + conf_low_new_se, color = condition), size = 0.5) +
  ggtitle("Average of Confidence for Old, Similar, and New Responses - MST") +
  xlab("Stimulus Level") +
  ylab("Confidence Rating") +
  ylim(2, 4) +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#0072B5FF", "#CCE6FF", "#20854EFF", "#a7eac6", "#BC3C29FF", "#ea9999"),
                     name = "Condition",
                     labels = c("Old - High Grip", "Old - Low Grip", "Similar - High Grip", "Similar - Low Grip", "New - High Grip", "New - Low Grip")) +
  scale_linetype_manual(values = c("solid", "solid", "solid", "solid", "solid", "solid"), 
                        name = "Condition",
                        labels = c("Old - High Grip", "Old - Low Grip", "Similar - High Grip", "Similar - Low Grip", "New - High Grip", "New - Low Grip")) +
  guides(color = guide_legend(title = "Response Type"))

```


## other MST metrics

### REC 

Corrected Recognition Memory
$$
REC=P(Old|Target) - P(Old|Foil)
$$

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate the probability of responding "old" given the trial type is "target"
prob_old_target <- MST %>%
  group_by(sub) %>%
  filter(trial_type == 'targ') %>%
  summarise(prob_old_given_target = sum(resp1 == 'old') / n()) %>%
  ungroup()

# Calculate the probability of responding "old" given the trial type is "foil"
prob_old_foil <- MST %>%
    group_by(sub) %>%
  filter(trial_type == 'foil') %>%
  summarise(prob_old_given_foil = sum(resp1 == 'old') / n()) %>%
  ungroup()


# Merge prob_old_target and prob_old_foil data frames
MST_REC <- merge(prob_old_target, prob_old_foil, by = "sub", suffixes = c("_target", "_foil"))

# Calculate REC (Remembered Old - Forgotten Old)
MST_REC$REC <- MST_REC$prob_old_given_target - MST_REC$prob_old_given_foil

```



### LDI

Lure Discrimination Index
$$
LDI=P(Similar|Lure) - P(Similar|Foil)
$$


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Calculate the probability of responding "sim" given the trial type is "lure"
prob_sim_lure <- MST %>%
  group_by(sub) %>%
  filter(trial_type == 'lure') %>%
  summarise(prob_sim_given_lure = sum(resp1 == 'sim') / n()) %>%
  ungroup()

# Calculate the probability of responding "sim" given the trial type is "foil"
prob_sim_foil <- MST %>%
  group_by(sub) %>%
  filter(trial_type == 'foil') %>%
  summarise(prob_sim_given_foil = sum(resp1 == 'sim') / n()) %>%
  ungroup()

# Merge prob_sim_lure and prob_sim_foil data frames
MST_LDI <- merge(prob_sim_lure, prob_sim_foil, by = "sub", suffixes = c("_lure", "_foil"))

# Calculate LDI (List Discrimination Index)
MST_LDI$LDI <- MST_LDI$prob_sim_given_lure - MST_LDI$prob_sim_given_foil


# Merge MST_REC and MST_LDI data frames
MST_combined <- merge(MST_REC, MST_LDI, by = "sub")

# Plotting
ggplot(MST_combined, aes(x = REC, y = LDI)) +
  geom_point() +
  ggtitle("LDI vs REC for Each Subject") +
  xlab("Correct Recognition Memory") +
  ylab("Lure Discrimination Index")

```


# Analysis of subjects completed 4 tasks {.tabset .tabset-fade .tabset-pills}

## List of their subject ID

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

sub_with_all_tasks <- combined_data %>%
  group_by(sub) %>%
  filter(all(c("ADT", "VDT", "CDT", "MST") %in% task)) %>%
  pull(sub) %>%
  unique()

print(sub_with_all_tasks)
```

## ADT

### Specific Dataframes

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}
ADT_4T <- lcya_behdata_trial_avdt %>%
  filter(task=='aud') %>%
  filter(!is.na(resp1)) %>%
  filter(sub %in% c('13','16','17','18','19','23','24','25','26','27','29','31','33','34','35','36','37','42','43','46','48','54','56','58','61','64','65','68','69','71','72','74','82','83','85','87','88'))

```


#### Proportion of Responding 'Different'

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
ADT_4T_acc_ws <- ADT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
ADT_4T_acc_ws <- ADT_4T_acc_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_4T_acc_ws <- ADT_4T_acc_ws %>%
  mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_ADT_4T <- ADT_4T_acc_ws %>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_ADT_4T <- ADT_4T_acc_ws %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_ADT_4T <- bind_rows(
  mutate(Diff_prop_ADT_4T, condition = "Different", prop = diff),
  mutate(Same_prop_ADT_4T, condition = "Same", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "4", "8", "32", "128")

# Convert 'stimLev' to factor with the desired order
combined_ADT_4T$stimLev <- factor(combined_ADT_4T$stimLev, levels = desired_order)

# Plotting with the modified 'stimLev'
ggplot(combined_ADT_4T, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point(size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different", diff_se, not_diff_se), 
                                ymax = prop + ifelse(condition == "Different", diff_se, not_diff_se))) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - ADT'") +
  xlab("Oddball Level (Hz)") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#0072B5FF")) +
  guides(color = guide_legend(title = "condition"))

```


#### Handgrip manipulation

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
ADT_4T_acc_ws <- ADT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
ADT_4T_acc_ws <- ADT_4T_acc_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_4T_acc_ws <- ADT_4T_acc_ws %>%
  mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_high_grip_ADT_4T <- ADT_4T_acc_ws %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

Diff_prop_low_grip_ADT_4T <- ADT_4T_acc_ws %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_high_grip_ADT_4T <- ADT_4T_acc_ws %>%
    filter(isStrength==1) %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

Same_prop_low_grip_ADT_4T <- ADT_4T_acc_ws %>%
    filter(isStrength==0) %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_grip_ADT_4T <- bind_rows(
  mutate(Diff_prop_high_grip_ADT_4T, condition = "Different - High Grip", prop = diff),
  mutate(Diff_prop_low_grip_ADT_4T, condition = "Different - Low Grip", prop = diff),
  mutate(Same_prop_high_grip_ADT_4T, condition = "Same - High Grip", prop = not_diff),
  mutate(Same_prop_low_grip_ADT_4T, condition = "Same - Low Grip", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "4", "8", "32", "128")

# Convert 'stimLev' to factor with the desired order
combined_grip_ADT_4T$stimLev <- factor(combined_grip_ADT_4T$stimLev, levels = desired_order)

# Plotting
ggplot(combined_grip_ADT_4T, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point( size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different - High Grip" | condition == "Different - Low Grip", diff_se, not_diff_se), 
                               ymax = prop + ifelse(condition == "Different - High Grip" | condition == "Different - Low Grip", diff_se, not_diff_se)), show.legend = FALSE) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - ADT'") +
  xlab("Oddball Level (Hz)") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("Different - High Grip" = "#BC3C29FF", "Different - Low Grip" = "#ea9999", "Same - High Grip" = "#0072B5FF", "Same - Low Grip" = "#CCE6FF")) +
  scale_linetype_manual(values = c("Different - High Grip" = "solid", "Different - Low Grip" = "solid", "Same - High Grip" = "solid", "Same - Low Grip" = "solid")) +
  guides(color = guide_legend(title = "Response Type", ncol = 1), linetype = "none")


```


### Reaction Time

#### Using Median with within-subject SEM

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
ADT_4T_RT_ws <- ADT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calcualte the grand mean
ADT_4T_RT_ws <- ADT_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_4T_RT_ws <- ADT_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 


# Calculate median RT for different responses
ADT_4T_diff_RT_ws <- ADT_4T_RT_ws %>%
  filter(resp1_diff == 1) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_diff = median(diff_sub),
            medRT_diff_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Calculate median RT for same responses
ADT_4T_same_RT_ws <- ADT_4T_RT_ws %>%
  filter(resp1_diff == 0) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_same = median(diff_sub),
            medRT_same_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Combine both datasets for plotting
combined_medRT_ADT_4T <- bind_rows(
  mutate(ADT_4T_diff_RT_ws, condition = "Different"),
  mutate(ADT_4T_same_RT_ws, condition = "Same")
)


# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "4", "8", "32", "128")

# Convert 'stimLev' to factor with the desired order
combined_medRT_ADT_4T$stimLev <- factor(combined_medRT_ADT_4T$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
combined_medRT_ADT_4T <- combined_medRT_ADT_4T %>%
  arrange(condition, stimLev)

# Plotting
ggplot(combined_medRT_ADT_4T, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
  geom_point(aes(y = ifelse(condition == "Different", medRT_diff , medRT_same)), size = 2) +
  geom_line(aes(y = ifelse(condition == "Different", medRT_diff, medRT_same)), size = 1.2) +
  ylim(min(c(combined_medRT_ADT_4T$medRT_diff, combined_medRT_ADT_4T$medRT_same)), max(c(combined_medRT_ADT_4T$medRT_diff, combined_medRT_ADT_4T$medRT_same))) +
  ggtitle("Median of Reaction Time for Same and Different Responses - ADT") +
  geom_linerange(mapping = aes(ymin = medRT_diff - medRT_diff_se, ymax = medRT_diff + medRT_diff_se, linetype = condition), data = filter(combined_medRT_ADT_4T, condition == "Different")) +
  geom_linerange(mapping = aes(ymin = medRT_same - medRT_same_se, ymax = medRT_same + medRT_same_se, linetype = condition), data = filter(combined_medRT_ADT_4T, condition == "Same")) +
  labs(caption = "Error bars represent within-subject SEM") +
  xlab("Oddball Level (Hz)") +
  ylab("Reaction Time (S)") +
  scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
  scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 

```

#### Using Median within and Mean between subjects with WSSEM

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
ADT_4T_RT_ws <- ADT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calcualte the grand mean
ADT_4T_RT_ws <- ADT_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_4T_RT_ws <- ADT_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 


# Calculate median RT for different responses
ADT_4T_diff_RT_ws <- ADT_4T_RT_ws %>%
  filter(resp1_diff == 1) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_diff = mean(diff_sub, na.rm = T),
            medRT_diff_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Calculate median RT for same responses
ADT_4T_same_RT_ws <- ADT_4T_RT_ws %>%
  filter(resp1_diff == 0) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_same = mean(diff_sub, na.rm = T),
            medRT_same_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Combine both datasets for plotting
combined_RT_ADT_4T <- bind_rows(
  mutate(ADT_4T_diff_RT_ws, condition = "Different"),
  mutate(ADT_4T_same_RT_ws, condition = "Same")
)


# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "4", "8", "32", "128")

# Convert 'stimLev' to factor with the desired order
combined_RT_ADT_4T$stimLev <- factor(combined_RT_ADT_4T$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
combined_RT_ADT_4T <- combined_RT_ADT_4T %>%
  arrange(condition, stimLev)

# Plotting
ggplot(combined_RT_ADT_4T, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
  geom_point(aes(y = ifelse(condition == "Different", medRT_diff , medRT_same)), size = 2) +
  geom_line(aes(y = ifelse(condition == "Different", medRT_diff, medRT_same)), size = 1.2) +
  ylim(min(c(combined_RT_ADT_4T$medRT_diff, combined_RT_ADT_4T$medRT_same)), max(c(combined_RT_ADT_4T$medRT_diff, combined_RT_ADT_4T$medRT_same))) +
  ggtitle("Median of Reaction Time within and Mean between - ADT") +
  geom_linerange(mapping = aes(ymin = medRT_diff - medRT_diff_se, ymax = medRT_diff + medRT_diff_se, linetype = condition), data = filter(combined_RT_ADT_4T, condition == "Different")) +
  geom_linerange(mapping = aes(ymin = medRT_same - medRT_same_se, ymax = medRT_same + medRT_same_se, linetype = condition), data = filter(combined_RT_ADT_4T, condition == "Same")) +
  labs(caption = "Error bars represent within-subject SEM") +
  xlab("Oddball Level (Hz)") +
  ylab("Reaction Time (S)") +
  scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
  scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 

```


#### Handgrip manipulation with Median

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
ADT_4T_RT_ws <- ADT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calcualte the grand mean
ADT_4T_RT_ws <- ADT_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_4T_RT_ws <- ADT_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 

# Calculate mean RT and standard error for  High 'Different'
RT_diff_high_grip_ADT_4T <- ADT_4T_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_diff=median(diff_sub), medRT_high_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Different'
RT_diff_low_grip_ADT_4T <- ADT_4T_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_diff=median(diff_sub), medRT_low_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Calculate mean RT and standard error for  High 'Same'
RT_same_high_grip_ADT_4T <- ADT_4T_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_same=median(diff_sub), medRT_high_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Same'
RT_same_low_grip_ADT_4T <- ADT_4T_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_same=median(diff_sub), medRT_low_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Combine both datasets for plotting
combined_medRT_grip_ADT_4T <- bind_rows(
  mutate(RT_diff_high_grip_ADT_4T, condition = "Different - High Grip"),
  mutate(RT_diff_low_grip_ADT_4T, condition = "Different - Low Grip"),
  mutate(RT_same_high_grip_ADT_4T, condition = "Same - High Grip"),
  mutate(RT_same_low_grip_ADT_4T, condition = "Same - Low Grip")
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "4", "8", "32", "128")

# Convert 'stimLev' to factor with the desired order
combined_medRT_grip_ADT_4T$stimLev <- factor(combined_medRT_grip_ADT_4T$stimLev, levels = desired_order)


# Plotting
ggplot(data = combined_medRT_grip_ADT_4T) +
  geom_point(aes(x = stimLev, y = medRT_high_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_diff - medRT_high_diff_se, 
                     ymax = medRT_high_diff + medRT_high_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_diff - medRT_low_diff_se, 
                     ymax = medRT_low_diff + medRT_low_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_high_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_same - medRT_high_same_se, 
                     ymax = medRT_high_same + medRT_high_same_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_same - medRT_low_same_se, 
                     ymax = medRT_low_same + medRT_low_same_se, color = condition), 
                 linetype = "solid") +
  
  ggtitle("Median of Reaction Time for Same and Different Responses - ADT") +
  xlab("Oddball Level (Hz)") +
  ylab("Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                      name = "Condition") 


```

#### Handgrip manipulation with Median within and Mean between with WSSEM

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}


# calculate subject mean
ADT_4T_RT_ws <- ADT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calcualte the grand mean
ADT_4T_RT_ws <- ADT_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_4T_RT_ws <- ADT_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 

# Calculate mean RT and standard error for  High 'Different'
RT_diff_high_grip_ADT_4T <- ADT_4T_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_diff=mean(diff_sub, na.rm = T), medRT_high_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Different'
RT_diff_low_grip_ADT_4T <- ADT_4T_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_diff=mean(diff_sub, na.rm = T), medRT_low_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Calculate mean RT and standard error for  High 'Same'
RT_same_high_grip_ADT_4T <- ADT_4T_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_same=mean(diff_sub, na.rm = T), medRT_high_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Same'
RT_same_low_grip_ADT_4T <- ADT_4T_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_same=mean(diff_sub, na.rm = T), medRT_low_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Combine both datasets for plotting
combined_RT_grip_ADT_4T <- bind_rows(
  mutate(RT_diff_high_grip_ADT_4T, condition = "Different - High Grip"),
  mutate(RT_diff_low_grip_ADT_4T, condition = "Different - Low Grip"),
  mutate(RT_same_high_grip_ADT_4T, condition = "Same - High Grip"),
  mutate(RT_same_low_grip_ADT_4T, condition = "Same - Low Grip")
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "4", "8", "32", "128")

# Convert 'stimLev' to factor with the desired order
combined_RT_grip_ADT_4T$stimLev <- factor(combined_RT_grip_ADT_4T$stimLev, levels = desired_order)


# Plotting
ggplot(data = combined_RT_grip_ADT_4T) +
  geom_point(aes(x = stimLev, y = medRT_high_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_diff - medRT_high_diff_se, 
                     ymax = medRT_high_diff + medRT_high_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_diff - medRT_low_diff_se, 
                     ymax = medRT_low_diff + medRT_low_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_high_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_same - medRT_high_same_se, 
                     ymax = medRT_high_same + medRT_high_same_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_same - medRT_low_same_se, 
                     ymax = medRT_low_same + medRT_low_same_se, color = condition), 
                 linetype = "solid") +
  
  ggtitle("Median of Reaction Time Within and Mean Between - ADT") +
  xlab("Oddball Level (Hz)") +
  ylab("Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                      name = "Condition") 



```


### Confidence

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
ADT_4T_conf_ws <- ADT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
ADT_4T_conf_ws <- ADT_4T_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_4T_conf_ws <- ADT_4T_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean) 

diff_average_confidence_ADT_4T <- ADT_4T_conf_ws %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_conf = mean(diff_prop, na.rm = T), 
                  diff_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_confidence_ADT_4T <- ADT_4T_conf_ws %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_conf = mean(same_prop), 
                  same_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

  combined_prop_ADT_4T <- bind_rows(
        mutate(diff_average_confidence_ADT_4T, condition = "Different"),
        mutate(same_average_confidence_ADT_4T, condition = "Same")
    )
  
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "4", "8", "32", "128")
    
    # Convert 'stimLev' to factor with the desired order
    combined_prop_ADT_4T$stimLev <- factor(combined_prop_ADT_4T$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_prop_ADT_4T <- combined_prop_ADT_4T %>%
        arrange(condition, stimLev)
    
    # Plotting
    ggplot(combined_prop_ADT_4T, aes(x = stimLev, group = condition, color = condition)) +
        geom_point(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 1.2) +
        ylim(2, 4) +
        ggtitle("Average of Confidence Response - ADT") +
        geom_linerange(mapping = aes(ymin = diff_conf - diff_conf_se, ymax = diff_conf + diff_conf_se, linetype = condition), data = filter(combined_prop_ADT_4T, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = same_conf - same_conf_se, ymax = same_conf + same_conf_se, linetype = condition), data = filter(combined_prop_ADT_4T, condition == "Same")) +
        labs(caption = "Error bars represent within-subject SEM") +
        xlab("Oddball Level") +
        ylab("Confidence Rating") +
        scale_color_manual(values = c("Different" = "#BC3C29FF",
                                      "Same" = "#0072B5FF"
                                      ),
                           labels = c("Different",
                                      "Same"
                                      )) +
        scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid"))
    


```

#### Handgrip manipulation

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
ADT_4T_conf_ws <- ADT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
ADT_4T_conf_ws <- ADT_4T_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

ADT_4T_conf_ws <- ADT_4T_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean) 

diff_average_high_confidence_ADT_4T <- ADT_4T_conf_ws %>%
        filter(isStrength == 1) %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_high_conf = mean(diff_prop, na.rm = T), 
                  diff_high_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

diff_average_low_confidence_ADT_4T <- ADT_4T_conf_ws %>%
        filter(isStrength == 0) %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_low_conf = mean(diff_prop, na.rm = T), 
                  diff_low_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()


same_average_high_confidence_ADT_4T <- ADT_4T_conf_ws %>%
        filter(isStrength == 1) %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_high_conf = mean(same_prop, na.rm = T), 
                  same_high_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_low_confidence_ADT_4T <- ADT_4T_conf_ws %>%
        filter(isStrength == 0) %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_low_conf = mean(same_prop, na.rm = T), 
                  same_low_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()


combined_conf_grip_ADT_4T <- bind_rows(
        mutate(diff_average_high_confidence_ADT_4T, condition = "Different - High Grip"),
        mutate(diff_average_low_confidence_ADT_4T, condition = "Different - Low Grip" ),
        mutate(same_average_high_confidence_ADT_4T, condition = "Same - High Grip"),
        mutate(same_average_low_confidence_ADT_4T, condition = "Same - Low Grip")
)
  
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "4", "8", "32", "128")
    
    # Convert 'stimLev' to factor with the desired order
    combined_conf_grip_ADT_4T$stimLev <- factor(combined_conf_grip_ADT_4T$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_conf_grip_ADT_4T <- combined_conf_grip_ADT_4T %>%
        arrange(condition, stimLev)
    


ggplot(combined_conf_grip_ADT_4T, aes(x = stimLev, color = condition)) +
  geom_point(aes(y = diff_high_conf), size = 3) +
  geom_line(aes(y = diff_high_conf, group = condition), size = 1.2) +
  geom_linerange(aes(ymin = diff_high_conf - diff_high_conf_se, 
                     ymax = diff_high_conf + diff_high_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  geom_point(aes(y = diff_low_conf), size = 3) +
  geom_line(aes(y = diff_low_conf, group = condition), size = 1.2, linetype = "solid") +
  geom_linerange(aes(ymin = diff_low_conf - diff_low_conf_se, 
                     ymax = diff_low_conf + diff_low_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  geom_point(aes(y = same_high_conf), size = 3) +
  geom_line(aes(y = same_high_conf, group = condition), size = 1.2) +
  geom_linerange(aes(ymin = same_high_conf - same_high_conf_se, 
                     ymax = same_high_conf + same_high_conf_se, group = condition), 
                  linetype = "solid") +
  geom_point(aes(y = same_low_conf), size = 3) +
  geom_line(aes(y = same_low_conf, group = condition), size = 1.2, linetype = "solid") +
  geom_linerange(aes(ymin = same_low_conf - same_low_conf_se, 
                     ymax = same_low_conf + same_low_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  ggtitle("Average of Confidence Response - ADT") +
  labs(caption = "Error bars represent within-subject SEM", x = "Oddball Level", y = "Confidence Rating") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                     name = "Response Type") +
  ylim(2,4)+
  scale_linetype_manual(values = c("solid", "solid"), name = "Condition",
                        labels = c("High Grip", "Low Grip")) 


```


## Statistical Analysis

### Effect of Grip on responses

#### The Effect of Grip on 'Different' Responses across Stimulus Levels

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

ADT_anova_grip_diff <- ADT_4T %>%
  filter(stimLev!= 0) %>% group_by(stimLev, isStrength, sub) %>% mutate(diff_sub = mean(resp1_diff, na.rm = TRUE)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(diff = mean(diff_sub), stimLev, isStrength) %>%
  distinct()
  
head(ADT_anova_grip_diff)
aov(diff ~ (stimLev * isStrength), ADT_anova_grip_diff) %>% report()
```

#### The Effect of Grip on 'Same' Responses across Stimulus Levels

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

ADT_anova_grip_same <- ADT_4T %>%
  filter(stimLev!= 0) %>% group_by(stimLev, isStrength, sub) %>% mutate(diff_sub = 1-mean(resp1_diff, na.rm = TRUE)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(diff = mean(diff_sub, na.rm = T), stimLev, isStrength) %>%
  distinct()
  
head(ADT_anova_grip_same)
aov(diff ~ (stimLev * isStrength), ADT_anova_grip_same) %>% report()
```

### Effect of Grip on Reaction Time


#### The Effect of Grip on Median Reaction Time for 'Different' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

ADT_anova_grip_RT_diff <- ADT_4T %>%
  filter(stimLev!= 0) %>% filter(resp1_diff ==1) %>% group_by(stimLev, isStrength, sub) %>% mutate(RT_sub = median(resp1RT)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(RT = median(RT_sub), stimLev, isStrength) %>%
  distinct()
  
head(ADT_anova_grip_RT_diff)
aov(RT ~ (stimLev * isStrength), ADT_anova_grip_RT_diff) %>% report()
```

#### The Effect of Grip on Median Reaction Time for 'Same' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

ADT_anova_grip_RT_same <- ADT_4T %>%
  filter(stimLev!= 0) %>% filter(resp1_diff ==0) %>% group_by(stimLev, isStrength, sub) %>% mutate(RT_sub = median(resp1RT)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(RT = median(RT_sub), stimLev, isStrength) %>%
  distinct()
  
head(ADT_anova_grip_RT_same)
aov(RT ~ (stimLev * isStrength), ADT_anova_grip_RT_same) %>% report()
```

### Effect of Grip on Confidence


#### The Effect of Grip on Confidence Reports for 'Different' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

ADT_anova_grip_conf_diff <- ADT_4T %>%
  filter(stimLev!= 0) %>% filter(resp1_diff ==1) %>% group_by(stimLev, isStrength, sub) %>% mutate(conf_sub = mean(resp2, na.rm = T)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(conf = mean(conf_sub, na.rm = T), stimLev, isStrength) %>%
  distinct()
  
head(ADT_anova_grip_conf_diff)
aov(conf ~ (stimLev * isStrength), ADT_anova_grip_conf_diff) %>% report()
```

#### The Effect of Grip on Confidence Reports for 'Same' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

ADT_anova_grip_conf_same <- ADT_4T %>%
  filter(stimLev!= 0) %>% filter(resp1_diff ==0) %>% group_by(stimLev, isStrength, sub) %>% mutate(conf_sub = mean(resp2, na.rm = T)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(conf = median(conf_sub, na.rm=T), stimLev, isStrength) %>%
  distinct()
  
head(ADT_anova_grip_conf_same)
aov(conf ~ (stimLev * isStrength), ADT_anova_grip_conf_same) %>% report()
```



## VDT

### Specific dataframe

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

VDT_4T <- lcya_behdata_trial_avdt %>%
  filter(task=='vis') %>%
  filter(!is.na(resp1)) %>%
  filter(sub %in% c('13','16','17','18','19','23','24','25','26','27','29','31','33','34','35','36','37','42','43','46','48','54','56','58','61','64','65','68','69','71','72','74','82','83','85','87','88'))


## Subject 25 entered same and different in a reverse manner
VDT_4T <- VDT_4T %>%
   mutate(
    resp1 = ifelse(sub == "25" & resp1 == 1, 2, 
                   ifelse(sub == "25" & resp1 == 2, 1, resp1)),  # Switch 1 and 2 in resp1 for 25
    iscorr = ifelse(sub == "25" & isOddball == resp1, 1, 
                    ifelse(sub == "25", 0, iscorr)),  # Update isCorr based on isOddball and resp1 for 25
    hit = ifelse(sub == "25" & isOddball == 1 & resp1 == 2, 1, 
                  ifelse(sub == "25", 0, hit)),  # Update hit based on isOddball and resp1 for 25
    miss = ifelse(sub == "25" & isOddball == 1 & resp1 == 1, 1, 
                   ifelse(sub == "25", 0, miss)),  # Update miss based on isOddball and resp1 for 25
    fa = ifelse(sub == "25" & isOddball == 0 & resp1 == 2, 1, 
                 ifelse(sub == "25", 0, fa)),  # Update fa based on isOddball and resp1 for 25
    cr = ifelse(sub == "25" & isOddball == 0 & resp1 == 1, 1, 
                 ifelse(sub == "25", 0, cr)),  # Update cr based on isOddball and resp1 for 25
    resp1_diff = ifelse(sub == "25", 1 - resp1_diff, resp1_diff)  # Switch 0s and 1s in resp1_diff for 25
  )

```

### Proportion of Responding 'Different'

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
VDT_4T_acc_ws <- VDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
VDT_4T_acc_ws <- VDT_4T_acc_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_4T_acc_ws <- VDT_4T_acc_ws %>%
  mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_VDT_4T <- VDT_4T_acc_ws %>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_VDT_4T <- VDT_4T_acc_ws %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_VDT_4T <- bind_rows(
  mutate(Diff_prop_VDT_4T, condition = "Different", prop = diff),
  mutate(Same_prop_VDT_4T, condition = "Same", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")

# Convert 'stimLev' to factor with the desired order
combined_VDT_4T$stimLev <- factor(combined_VDT_4T$stimLev, levels = desired_order)

# Plotting with the modified 'stimLev'
ggplot(combined_VDT_4T, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point(size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different", diff_se, not_diff_se), 
                                ymax = prop + ifelse(condition == "Different", diff_se, not_diff_se))) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - VDT") +
  xlab("Contrast Level") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#0072B5FF")) +
  guides(color = guide_legend(title = "condition"))


```


#### Handgrip manipulation

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}


# calculate subject mean
VDT_4T_acc_ws <- VDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
VDT_4T_acc_ws <- VDT_4T_acc_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_4T_acc_ws <- VDT_4T_acc_ws %>%
  mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_high_grip_VDT_4T <- VDT_4T_acc_ws %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

Diff_prop_low_grip_VDT_4T <- VDT_4T_acc_ws %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_high_grip_VDT_4T <- VDT_4T_acc_ws %>%
    filter(isStrength==1) %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

Same_prop_low_grip_VDT_4T <- VDT_4T_acc_ws %>%
    filter(isStrength==0) %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_grip_VDT_4T <- bind_rows(
  mutate(Diff_prop_high_grip_VDT_4T, condition = "Different - High Grip", prop = diff),
  mutate(Diff_prop_low_grip_VDT_4T, condition = "Different - Low Grip", prop = diff),
  mutate(Same_prop_high_grip_VDT_4T, condition = "Same - High Grip", prop = not_diff),
  mutate(Same_prop_low_grip_VDT_4T, condition = "Same - Low Grip", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")

# Convert 'stimLev' to factor with the desired order
combined_grip_VDT_4T$stimLev <- factor(combined_grip_VDT_4T$stimLev, levels = desired_order)

# Plotting
ggplot(combined_grip_VDT_4T, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point( size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different - High Grip" | condition == "Different - Low Grip", diff_se, not_diff_se), 
                               ymax = prop + ifelse(condition == "Different - High Grip" | condition == "Different - Low Grip", diff_se, not_diff_se)), show.legend = FALSE) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - VDT") +
  xlab("Contrast Level") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("Different - High Grip" = "#BC3C29FF", "Different - Low Grip" = "#ea9999", "Same - High Grip" = "#0072B5FF", "Same - Low Grip" = "#CCE6FF")) +
  scale_linetype_manual(values = c("Different - High Grip" = "solid", "Different - Low Grip" = "solid", "Same - High Grip" = "solid", "Same - Low Grip" = "solid")) +
  guides(color = guide_legend(title = "Response Type", ncol = 1), linetype = "none")


```


### Reaction Time

#### Using Median with within-subject SEM

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
VDT_4T_RT_ws <- VDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
VDT_4T_RT_ws <- VDT_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_4T_RT_ws <- VDT_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 


# Calculate median RT for different responses
VDT_4T_diff_RT_ws <- VDT_4T_RT_ws %>%
  filter(resp1_diff == 1) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_diff = median(diff_sub),
            medRT_diff_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Calculate median RT for same responses
VDT_4T_same_RT_ws <- VDT_4T_RT_ws %>%
  filter(resp1_diff == 0) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_same = median(diff_sub),
            medRT_same_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Combine both datasets for plotting
combined_medRT_VDT_4T <- bind_rows(
  mutate(VDT_4T_diff_RT_ws, condition = "Different"),
  mutate(VDT_4T_same_RT_ws, condition = "Same")
)


# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")

# Convert 'stimLev' to factor with the desired order
combined_medRT_VDT_4T$stimLev <- factor(combined_medRT_VDT_4T$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
combined_medRT_VDT_4T <- combined_medRT_VDT_4T %>%
  arrange(condition, stimLev)

# Plotting
ggplot(combined_medRT_VDT_4T, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
  geom_point(aes(y = ifelse(condition == "Different", medRT_diff , medRT_same)), size = 2) +
  geom_line(aes(y = ifelse(condition == "Different", medRT_diff, medRT_same)), size = 1.2) +
  ylim(min(c(combined_medRT_VDT_4T$medRT_diff, combined_medRT_VDT_4T$medRT_same)), max(c(combined_medRT_VDT_4T$medRT_diff, combined_medRT_VDT_4T$medRT_same))) +
  ggtitle("Median of Reaction Time for Same and Different Responses - VDT") +
  geom_linerange(mapping = aes(ymin = medRT_diff - medRT_diff_se, ymax = medRT_diff + medRT_diff_se, linetype = condition), data = filter(combined_medRT_VDT_4T, condition == "Different")) +
  geom_linerange(mapping = aes(ymin = medRT_same - medRT_same_se, ymax = medRT_same + medRT_same_se, linetype = condition), data = filter(combined_medRT_VDT_4T, condition == "Same")) +
  labs(caption = "Error bars represent within-subject SEM") +
  xlab("Contrast Level") +
  ylab("Reaction Time (S)") +
  scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
  scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 

```

#### Using Median within and Mean between subjects with WSSEM

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}


# calculate subject mean
VDT_4T_RT_ws <- VDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
VDT_4T_RT_ws <- VDT_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_4T_RT_ws <- VDT_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 


# Calculate median RT for different responses
VDT_4T_diff_RT_ws <- VDT_4T_RT_ws %>%
  filter(resp1_diff == 1) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_diff = mean(diff_sub, na.rm = T),
            medRT_diff_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Calculate median RT for same responses
VDT_4T_same_RT_ws <- VDT_4T_RT_ws %>%
  filter(resp1_diff == 0) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_same = mean(diff_sub, na.rm = T),
            medRT_same_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Combine both datasets for plotting
combined_RT_VDT_4T <- bind_rows(
  mutate(VDT_4T_diff_RT_ws, condition = "Different"),
  mutate(VDT_4T_same_RT_ws, condition = "Same")
)


# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")

# Convert 'stimLev' to factor with the desired order
combined_RT_VDT_4T$stimLev <- factor(combined_RT_VDT_4T$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
combined_RT_VDT_4T <- combined_RT_VDT_4T %>%
  arrange(condition, stimLev)

# Plotting
ggplot(combined_RT_VDT_4T, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
  geom_point(aes(y = ifelse(condition == "Different", medRT_diff , medRT_same)), size = 2) +
  geom_line(aes(y = ifelse(condition == "Different", medRT_diff, medRT_same)), size = 1.2) +
  ylim(min(c(combined_RT_VDT_4T$medRT_diff, combined_RT_VDT_4T$medRT_same)), max(c(combined_RT_VDT_4T$medRT_diff, combined_RT_VDT_4T$medRT_same))) +
  ggtitle("Median of Within and Mean Between Reaction Time  - VDT") +
  geom_linerange(mapping = aes(ymin = medRT_diff - medRT_diff_se, ymax = medRT_diff + medRT_diff_se, linetype = condition), data = filter(combined_RT_VDT_4T, condition == "Different")) +
  geom_linerange(mapping = aes(ymin = medRT_same - medRT_same_se, ymax = medRT_same + medRT_same_se, linetype = condition), data = filter(combined_RT_VDT_4T, condition == "Same")) +
  labs(caption = "Error bars represent within-subject SEM") +
  xlab("Contrast Level") +
  ylab("Reaction Time (S)") +
  scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
  scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 

```


#### Handgrip manipulation with Median

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
VDT_4T_RT_ws <- VDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calcualte the grand mean
VDT_4T_RT_ws <- VDT_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_4T_RT_ws <- VDT_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 

# Calculate mean RT and standard error for  High 'Different'
RT_diff_high_grip_VDT_4T <- VDT_4T_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_diff=median(diff_sub), medRT_high_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Different'
RT_diff_low_grip_VDT_4T <- VDT_4T_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_diff=median(diff_sub), medRT_low_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Calculate mean RT and standard error for  High 'Same'
RT_same_high_grip_VDT_4T <- VDT_4T_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_same=median(diff_sub), medRT_high_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Same'
RT_same_low_grip_VDT_4T <- VDT_4T_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_same=median(diff_sub), medRT_low_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Combine both datasets for plotting
combined_medRT_grip_VDT_4T <- bind_rows(
  mutate(RT_diff_high_grip_VDT_4T, condition = "Different - High Grip"),
  mutate(RT_diff_low_grip_VDT_4T, condition = "Different - Low Grip"),
  mutate(RT_same_high_grip_VDT_4T, condition = "Same - High Grip"),
  mutate(RT_same_low_grip_VDT_4T, condition = "Same - Low Grip")
)

# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")

# Convert 'stimLev' to factor with the desired order
combined_medRT_grip_VDT_4T$stimLev <- factor(combined_medRT_grip_VDT_4T$stimLev, levels = desired_order)


# Plotting without jitter
ggplot(data = combined_medRT_grip_VDT_4T) +
  geom_point(aes(x = stimLev, y = medRT_high_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_diff - medRT_high_diff_se, 
                     ymax = medRT_high_diff + medRT_high_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_diff - medRT_low_diff_se, 
                     ymax = medRT_low_diff + medRT_low_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_high_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_same - medRT_high_same_se, 
                     ymax = medRT_high_same + medRT_high_same_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_same - medRT_low_same_se, 
                     ymax = medRT_low_same + medRT_low_same_se, color = condition), 
                 linetype = "solid") +
  
  ggtitle("Median of Reaction Time for Same and Different Responses - VDT") +
  xlab("Contrast Level") +
  ylab("Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                      name = "Condition") 



```

#### Handgrip manipulation with Median within and Mean between with WSSEM

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}


# calculate subject mean
VDT_4T_RT_ws <- VDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calcualte the grand mean
VDT_4T_RT_ws <- VDT_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_4T_RT_ws <- VDT_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 

# Calculate mean RT and standard error for  High 'Different'
RT_diff_high_grip_VDT_4T <- VDT_4T_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_diff=mean(diff_sub, na.rm = T), medRT_high_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Different'
RT_diff_low_grip_VDT_4T <- VDT_4T_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_diff=mean(diff_sub, na.rm = T), medRT_low_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Calculate mean RT and standard error for  High 'Same'
RT_same_high_grip_VDT_4T <- VDT_4T_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_same=mean(diff_sub, na.rm = T), medRT_high_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Same'
RT_same_low_grip_VDT_4T <- VDT_4T_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_same=mean(diff_sub, na.rm = T), medRT_low_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Combine both datasets for plotting
combined_RT_grip_VDT_4T <- bind_rows(
  mutate(RT_diff_high_grip_VDT_4T, condition = "Different - High Grip"),
  mutate(RT_diff_low_grip_VDT_4T, condition = "Different - Low Grip"),
  mutate(RT_same_high_grip_VDT_4T, condition = "Same - High Grip"),
  mutate(RT_same_low_grip_VDT_4T, condition = "Same - Low Grip")
)

# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")

# Convert 'stimLev' to factor with the desired order
combined_RT_grip_VDT_4T$stimLev <- factor(combined_RT_grip_VDT_4T$stimLev, levels = desired_order)


# Plotting without jitter
ggplot(data = combined_RT_grip_VDT_4T) +
  geom_point(aes(x = stimLev, y = medRT_high_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_diff - medRT_high_diff_se, 
                     ymax = medRT_high_diff + medRT_high_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_diff - medRT_low_diff_se, 
                     ymax = medRT_low_diff + medRT_low_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_high_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_same - medRT_high_same_se, 
                     ymax = medRT_high_same + medRT_high_same_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_same - medRT_low_same_se, 
                     ymax = medRT_low_same + medRT_low_same_se, color = condition), 
                 linetype = "solid") +
  
  ggtitle("Median of Reaction Time Within and Mean Between - VDT") +
  xlab("Contrast Level") +
  ylab("Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                      name = "Condition") 



```


### Confidence

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}


# calculate subject mean
VDT_4T_conf_ws <- VDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
VDT_4T_conf_ws <- VDT_4T_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_4T_conf_ws <- VDT_4T_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean) 

diff_average_confidence_VDT_4T <- VDT_4T_conf_ws %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_conf = mean(diff_prop, na.rm = T), 
                  diff_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_confidence_VDT_4T <- VDT_4T_conf_ws %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_conf = mean(same_prop), 
                  same_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

  combined_prop_VDT_4T <- bind_rows(
        mutate(diff_average_confidence_VDT_4T, condition = "Different"),
        mutate(same_average_confidence_VDT_4T, condition = "Same")
    )
  
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")
    
    # Convert 'stimLev' to factor with the desired order
    combined_prop_VDT_4T$stimLev <- factor(combined_prop_VDT_4T$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_prop_VDT_4T <- combined_prop_VDT_4T %>%
        arrange(condition, stimLev)
    
    # Plotting
    ggplot(combined_prop_VDT_4T, aes(x = stimLev, group = condition, color = condition)) +
        geom_point(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 1.2) +
        ylim(2, 4) +
        ggtitle("Average of Confidence Response - VDT") +
        geom_linerange(mapping = aes(ymin = diff_conf - diff_conf_se, ymax = diff_conf + diff_conf_se, linetype = condition), data = filter(combined_prop_VDT_4T, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = same_conf - same_conf_se, ymax = same_conf + same_conf_se, linetype = condition), data = filter(combined_prop_VDT_4T, condition == "Same")) +
        labs(caption = "Error bars represent within-subject SEM") +
        xlab("Contrast Level") +
        ylab("Confidence Rating") +
        scale_color_manual(values = c("Different" = "#BC3C29FF",
                                      "Same" = "#0072B5FF"
                                      ),
                           labels = c("Different",
                                      "Same"
                                      )) +
        scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid"))
    
```


#### Handgrip manipulation

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
VDT_4T_conf_ws <- VDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
VDT_4T_conf_ws <- VDT_4T_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

VDT_4T_conf_ws <- VDT_4T_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean) 

diff_average_high_confidence_VDT_4T <- VDT_4T_conf_ws %>%
        filter(isStrength == 1) %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_high_conf = mean(diff_prop, na.rm = T), 
                  diff_high_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

diff_average_low_confidence_VDT_4T <- VDT_4T_conf_ws %>%
        filter(isStrength == 0) %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_low_conf = mean(diff_prop, na.rm = T), 
                  diff_low_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()


same_average_high_confidence_VDT_4T <- VDT_4T_conf_ws %>%
        filter(isStrength == 1) %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_high_conf = mean(same_prop, na.rm = T), 
                  same_high_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_low_confidence_VDT_4T <- VDT_4T_conf_ws %>%
        filter(isStrength == 0) %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_low_conf = mean(same_prop, na.rm = T), 
                  same_low_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()


combined_conf_grip_VDT_4T <- bind_rows(
        mutate(diff_average_high_confidence_VDT_4T, condition = "Different - High Grip"),
        mutate(diff_average_low_confidence_VDT_4T, condition = "Different - Low Grip" ),
        mutate(same_average_high_confidence_VDT_4T, condition = "Same - High Grip"),
        mutate(same_average_low_confidence_VDT_4T, condition = "Same - Low Grip")
)
  
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "0.04", "0.08", "0.16", "0.32")
    
    # Convert 'stimLev' to factor with the desired order
    combined_conf_grip_VDT_4T$stimLev <- factor(combined_conf_grip_VDT_4T$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_conf_grip_VDT_4T <- combined_conf_grip_VDT_4T %>%
        arrange(condition, stimLev)
    


ggplot(combined_conf_grip_VDT_4T, aes(x = stimLev, color = condition)) +
  geom_point(aes(y = diff_high_conf), size = 3) +
  geom_line(aes(y = diff_high_conf, group = condition), size = 1.2) +
  geom_linerange(aes(ymin = diff_high_conf - diff_high_conf_se, 
                     ymax = diff_high_conf + diff_high_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  geom_point(aes(y = diff_low_conf), size = 3) +
  geom_line(aes(y = diff_low_conf, group = condition), size = 1.2, linetype = "solid") +
  geom_linerange(aes(ymin = diff_low_conf - diff_low_conf_se, 
                     ymax = diff_low_conf + diff_low_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  geom_point(aes(y = same_high_conf), size = 3) +
  geom_line(aes(y = same_high_conf, group = condition), size = 1.2) +
  geom_linerange(aes(ymin = same_high_conf - same_high_conf_se, 
                     ymax = same_high_conf + same_high_conf_se, group = condition), 
                  linetype = "solid") +
  geom_point(aes(y = same_low_conf), size = 3) +
  geom_line(aes(y = same_low_conf, group = condition), size = 1.2, linetype = "solid") +
  geom_linerange(aes(ymin = same_low_conf - same_low_conf_se, 
                     ymax = same_low_conf + same_low_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  ggtitle("Average of Confidence Response - VDT") +
  ylim(2,4)+
  labs(caption = "Error bars represent within-subject SEM", x = "Oddball Level", y = "Confidence Rating") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                     name = "Response Type") +
  scale_linetype_manual(values = c("solid", "solid"), name = "Condition",
                        labels = c("High Grip", "Low Grip")) 



```


## Statistical Analysis

### Effect of Grip on responses

#### The Effect of Grip on 'Different' Responses across Stimulus Levels

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

VDT_anova_grip_diff <- VDT_4T %>%
  filter(stimLev!= 0) %>% group_by(stimLev, isStrength, sub) %>% mutate(diff_sub = mean(resp1_diff, na.rm = TRUE)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(diff = mean(diff_sub), stimLev, isStrength) %>%
  distinct()
  
head(VDT_anova_grip_diff)
aov(diff ~ (stimLev * isStrength), VDT_anova_grip_diff) %>% report()
```

#### The Effect of Grip on 'Same' Responses across Stimulus Levels

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

VDT_anova_grip_same <- VDT_4T %>%
  filter(stimLev!= 0) %>% group_by(stimLev, isStrength, sub) %>% mutate(diff_sub = 1-mean(resp1_diff, na.rm = TRUE)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(diff = mean(diff_sub, na.rm = T), stimLev, isStrength) %>%
  distinct()
  
head(VDT_anova_grip_same)
aov(diff ~ (stimLev * isStrength), VDT_anova_grip_same) %>% report()
```

### Effect of Grip on Reaction Time


#### The Effect of Grip on Median Reaction Time for 'Different' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

VDT_anova_grip_RT_diff <- VDT_4T %>%
  filter(stimLev!= 0) %>% filter(resp1_diff ==1) %>% group_by(stimLev, isStrength, sub) %>% mutate(RT_sub = median(resp1RT)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(RT = median(RT_sub), stimLev, isStrength) %>%
  distinct()
  
head(VDT_anova_grip_RT_diff)
aov(RT ~ (stimLev * isStrength), VDT_anova_grip_RT_diff) %>% report()
```

#### The Effect of Grip on Median Reaction Time for 'Same' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

VDT_anova_grip_RT_same <- VDT_4T %>%
  filter(stimLev!= 0) %>% filter(resp1_diff ==0) %>% group_by(stimLev, isStrength, sub) %>% mutate(RT_sub = median(resp1RT)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(RT = median(RT_sub), stimLev, isStrength) %>%
  distinct()
  
head(VDT_anova_grip_RT_same)
aov(RT ~ (stimLev * isStrength), VDT_anova_grip_RT_same) %>% report()
```

### Effect of Grip on Confidence


#### The Effect of Grip on Confidence Reports for 'Different' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

VDT_anova_grip_conf_diff <- VDT_4T %>%
  filter(stimLev!= 0) %>% filter(resp1_diff ==1) %>% group_by(stimLev, isStrength, sub) %>% mutate(conf_sub = mean(resp2, na.rm = T)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(conf = mean(conf_sub, na.rm = T), stimLev, isStrength) %>%
  distinct()
  
head(VDT_anova_grip_conf_diff)
aov(conf ~ (stimLev * isStrength), VDT_anova_grip_conf_diff) %>% report()
```

#### The Effect of Grip on Confidence Reports for 'Same' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

VDT_anova_grip_conf_same <- VDT_4T %>%
  filter(stimLev!= 0) %>% filter(resp1_diff ==0) %>% group_by(stimLev, isStrength, sub) %>% mutate(conf_sub = mean(resp2, na.rm = T)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(conf = median(conf_sub, na.rm=T), stimLev, isStrength) %>%
  distinct()
  
head(VDT_anova_grip_conf_same)
aov(conf ~ (stimLev * isStrength), VDT_anova_grip_conf_same) %>% report()
```



## CDT

### Specific dataframe

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

CDT_4T <- lcya_behdata_trial_cdt %>%
  filter(task == 'cdt') %>%
  filter(!is.na(resp1)) %>%
  filter(sub %in% c('13','16','17','18','19','23','24','25','26','27','29','31','33','34','35','36','37','42','43','46','48','54','56','58','61','64','65','68','69','71','72','74','82','83','85','87','88'))

```

### Proportion of Responding 'Different'

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
CDT_4T_acc_ws <- CDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
CDT_4T_acc_ws <- CDT_4T_acc_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_4T_acc_ws <- CDT_4T_acc_ws %>%
  mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_CDT_4T <- CDT_4T_acc_ws %>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_CDT_4T <- CDT_4T_acc_ws %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_CDT_4T <- bind_rows(
  mutate(Diff_prop_CDT_4T, condition = "Different", prop = diff),
  mutate(Same_prop_CDT_4T, condition = "Same", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "5", "20", "45", "90")

# Convert 'stimLev' to factor with the desired order
combined_CDT_4T$stimLev <- factor(combined_CDT_4T$stimLev, levels = desired_order)

# Plotting with the modified 'stimLev'
ggplot(combined_CDT_4T, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point(size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different", diff_se, not_diff_se), 
                                ymax = prop + ifelse(condition == "Different", diff_se, not_diff_se))) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - CDT") +
  xlab("Degree") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#0072B5FF")) +
  guides(color = guide_legend(title = "condition"))


```


#### Handgrip manipulation

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
CDT_4T_acc_ws <- CDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
CDT_4T_acc_ws <- CDT_4T_acc_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_4T_acc_ws <- CDT_4T_acc_ws %>%
  mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean accuracy and standard error for 'Different'
Diff_prop_high_grip_CDT_4T <- CDT_4T_acc_ws %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

Diff_prop_low_grip_CDT_4T <- CDT_4T_acc_ws %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(diff=mean(diff_sub), diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate the proportion of 'Same'
Same_prop_high_grip_CDT_4T <- CDT_4T_acc_ws %>%
    filter(isStrength==1) %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

Same_prop_low_grip_CDT_4T <- CDT_4T_acc_ws %>%
    filter(isStrength==0) %>%
    group_by(sub, stimLev) %>%
    summarise(same_sub = 1-mean(resp1_diff, na.rm = TRUE),acc_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(not_diff=mean(same_sub), not_diff_se = sd(acc_diff)/sqrt(n_distinct(sub))) %>%
    distinct()

# Combine both datasets for plotting
combined_grip_CDT_4T <- bind_rows(
  mutate(Diff_prop_high_grip_CDT_4T, condition = "Different - High Grip", prop = diff),
  mutate(Diff_prop_low_grip_CDT_4T, condition = "Different - Low Grip", prop = diff),
  mutate(Same_prop_high_grip_CDT_4T, condition = "Same - High Grip", prop = not_diff),
  mutate(Same_prop_low_grip_CDT_4T, condition = "Same - Low Grip", prop = not_diff)
)

# Specify the desired order of levels for 'stimLev'
desired_order <- c("0", "5", "20", "45", "90")

# Convert 'stimLev' to factor with the desired order
combined_grip_CDT_4T$stimLev <- factor(combined_grip_CDT_4T$stimLev, levels = desired_order)

# Plotting
ggplot(combined_grip_CDT_4T, aes(x = stimLev, y = prop, group = condition, color = condition)) +
  geom_point( size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(condition == "Different - High Grip" | condition == "Different - Low Grip", diff_se, not_diff_se), 
                               ymax = prop + ifelse(condition == "Different - High Grip" | condition == "Different - Low Grip", diff_se, not_diff_se)), show.legend = FALSE) +
  ylim(0, 1) +
  ggtitle("Proportion of Responding 'Different' and 'Same' - CDT") +
  xlab("Degree") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("Different - High Grip" = "#BC3C29FF", "Different - Low Grip" = "#ea9999", "Same - High Grip" = "#0072B5FF", "Same - Low Grip" = "#CCE6FF")) +
  scale_linetype_manual(values = c("Different - High Grip" = "solid", "Different - Low Grip" = "solid", "Same - High Grip" = "solid", "Same - Low Grip" = "solid")) +
  guides(color = guide_legend(title = "Response Type", ncol = 1), linetype = "none")



```


### Reaction Time

#### Using Median with within-subject SEM

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
CDT_4T_RT_ws <- CDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
CDT_4T_RT_ws <- CDT_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_4T_RT_ws <- CDT_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 


# Calculate median RT for different responses
CDT_4T_diff_RT_ws <- CDT_4T_RT_ws %>%
  filter(resp1_diff == 1) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_diff = median(diff_sub),
            medRT_diff_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Calculate median RT for same responses
CDT_4T_same_RT_ws <- CDT_4T_RT_ws %>%
  filter(resp1_diff == 0) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_same = median(diff_sub),
            medRT_same_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Combine both datasets for plotting
combined_medRT_CDT_4T <- bind_rows(
  mutate(CDT_4T_diff_RT_ws, condition = "Different"),
  mutate(CDT_4T_same_RT_ws, condition = "Same")
)


# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")

# Convert 'stimLev' to factor with the desired order
combined_medRT_CDT_4T$stimLev <- factor(combined_medRT_CDT_4T$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
combined_medRT_CDT_4T <- combined_medRT_CDT_4T %>%
  arrange(condition, stimLev)

# Plotting
ggplot(combined_medRT_CDT_4T, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
  geom_point(aes(y = ifelse(condition == "Different", medRT_diff , medRT_same)), size = 2) +
  geom_line(aes(y = ifelse(condition == "Different", medRT_diff, medRT_same)), size = 1.2) +
  ylim(min(c(combined_medRT_CDT_4T$medRT_diff, combined_medRT_CDT_4T$medRT_same)), max(c(combined_medRT_CDT_4T$medRT_diff, combined_medRT_CDT_4T$medRT_same))) +
  ggtitle("Median of Reaction Time for Same and Different Responses - CDT") +
  geom_linerange(mapping = aes(ymin = medRT_diff - medRT_diff_se, ymax = medRT_diff + medRT_diff_se, linetype = condition), data = filter(combined_medRT_CDT_4T, condition == "Different")) +
  geom_linerange(mapping = aes(ymin = medRT_same - medRT_same_se, ymax = medRT_same + medRT_same_se, linetype = condition), data = filter(combined_medRT_CDT_4T, condition == "Same")) +
  labs(caption = "Error bars represent within-subject SEM") +
  xlab("Degree") +
  ylab("Reaction Time (S)") +
  scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
  scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 

```

#### Using Median within and Mean between subjects with WSSEM

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
CDT_4T_RT_ws <- CDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
CDT_4T_RT_ws <- CDT_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_4T_RT_ws <- CDT_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 


# Calculate median RT for different responses
CDT_4T_diff_RT_ws <- CDT_4T_RT_ws %>%
  filter(resp1_diff == 1) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_diff = mean(diff_sub, na.rm = T),
            medRT_diff_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Calculate median RT for same responses
CDT_4T_same_RT_ws <- CDT_4T_RT_ws %>%
  filter(resp1_diff == 0) %>%
  group_by(stimLev,sub) %>%
  summarise(diff_sub= median(resp1RT), RT_diff) %>%
  ungroup() %>%
  group_by(stimLev) %>%
  summarise(medRT_same = mean(diff_sub, na.rm = T),
            medRT_same_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
  distinct()

# Combine both datasets for plotting
combined_RT_CDT_4T <- bind_rows(
  mutate(CDT_4T_diff_RT_ws, condition = "Different"),
  mutate(CDT_4T_same_RT_ws, condition = "Same")
)


# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")

# Convert 'stimLev' to factor with the desired order
combined_RT_CDT_4T$stimLev <- factor(combined_RT_CDT_4T$stimLev, levels = desired_order)

#Sort the combined dataset by stimLev within each condition
combined_RT_CDT_4T <- combined_RT_CDT_4T %>%
  arrange(condition, stimLev)

# Plotting
ggplot(combined_RT_CDT_4T, aes(x = stimLev, group = condition, color = condition, linetype= condition)) +
  geom_point(aes(y = ifelse(condition == "Different", medRT_diff , medRT_same)), size = 2) +
  geom_line(aes(y = ifelse(condition == "Different", medRT_diff, medRT_same)), size = 1.2) +
  ylim(min(c(combined_RT_CDT_4T$medRT_diff, combined_RT_CDT_4T$medRT_same)), max(c(combined_RT_CDT_4T$medRT_diff, combined_RT_CDT_4T$medRT_same))) +
  ggtitle("Median of Within ane Mean Within Reaction Time - CDT") +
  geom_linerange(mapping = aes(ymin = medRT_diff - medRT_diff_se, ymax = medRT_diff + medRT_diff_se, linetype = condition), data = filter(combined_RT_CDT_4T, condition == "Different")) +
  geom_linerange(mapping = aes(ymin = medRT_same - medRT_same_se, ymax = medRT_same + medRT_same_se, linetype = condition), data = filter(combined_RT_CDT_4T, condition == "Same")) +
  labs(caption = "Error bars represent within-subject SEM") +
  xlab("Degree") +
  ylab("Reaction Time (S)") +
  scale_color_manual(values = c( "#BC3C29FF", "#0072B5FF")) +
  scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid")) 


```


#### Handgrip manipulation with Median

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
CDT_4T_RT_ws <- CDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calcualte the grand mean
CDT_4T_RT_ws <- CDT_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_4T_RT_ws <- CDT_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 

# Calculate mean RT and standard error for  High 'Different'
RT_diff_high_grip_CDT_4T <- CDT_4T_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_diff=median(diff_sub), medRT_high_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Different'
RT_diff_low_grip_CDT_4T <- CDT_4T_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_diff=median(diff_sub), medRT_low_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Calculate mean RT and standard error for  High 'Same'
RT_same_high_grip_CDT_4T <- CDT_4T_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_same=median(diff_sub), medRT_high_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Same'
RT_same_low_grip_CDT_4T <- CDT_4T_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_same=median(diff_sub), medRT_low_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Combine both datasets for plotting
combined_medRT_grip_CDT_4T <- bind_rows(
  mutate(RT_diff_high_grip_CDT_4T, condition = "Different - High Grip"),
  mutate(RT_diff_low_grip_CDT_4T, condition = "Different - Low Grip"),
  mutate(RT_same_high_grip_CDT_4T, condition = "Same - High Grip"),
  mutate(RT_same_low_grip_CDT_4T, condition = "Same - Low Grip")
)

# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")

# Convert 'stimLev' to factor with the desired order
combined_medRT_grip_CDT_4T$stimLev <- factor(combined_medRT_grip_CDT_4T$stimLev, levels = desired_order)


# Plotting without jitter
ggplot(data = combined_medRT_grip_CDT_4T) +
  geom_point(aes(x = stimLev, y = medRT_high_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_diff - medRT_high_diff_se, 
                     ymax = medRT_high_diff + medRT_high_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_diff - medRT_low_diff_se, 
                     ymax = medRT_low_diff + medRT_low_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_high_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_same - medRT_high_same_se, 
                     ymax = medRT_high_same + medRT_high_same_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_same - medRT_low_same_se, 
                     ymax = medRT_low_same + medRT_low_same_se, color = condition), 
                 linetype = "solid") +
  
  ggtitle("Median of Reaction Time for Same and Different Responses - CDT") +
  xlab("Degree") +
  ylab("Median Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                      name = "Condition") 



```

#### Handgrip manipulation with Median within and Mean between with WSSEM

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}


# calculate subject mean
CDT_4T_RT_ws <- CDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calcualte the grand mean
CDT_4T_RT_ws <- CDT_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_4T_RT_ws <- CDT_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 

# Calculate mean RT and standard error for  High 'Different'
RT_diff_high_grip_CDT_4T <- CDT_4T_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_diff=mean(diff_sub, na.rm = T), medRT_high_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Different'
RT_diff_low_grip_CDT_4T <- CDT_4T_RT_ws %>%
    filter(resp1_diff == 1) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_diff=mean(diff_sub, na.rm = T), medRT_low_diff_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Calculate mean RT and standard error for  High 'Same'
RT_same_high_grip_CDT_4T <- CDT_4T_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==1)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_high_same=mean(diff_sub, na.rm = T), medRT_high_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()

# Calculate mean RT and standard error for  Low 'Same'
RT_same_low_grip_CDT_4T <- CDT_4T_RT_ws %>%
    filter(resp1_diff == 0) %>%
    filter(isStrength==0)%>%
    group_by(sub, stimLev) %>%
    summarise(diff_sub = median(resp1RT),RT_diff) %>%
    ungroup() %>% 
    group_by(stimLev) %>%
    summarise(medRT_low_same=mean(diff_sub, na.rm = T), medRT_low_same_se = sd(RT_diff, na.rm=T)/sqrt(n_distinct(sub))) %>%
    distinct()


# Combine both datasets for plotting
combined_RT_grip_CDT_4T <- bind_rows(
  mutate(RT_diff_high_grip_CDT_4T, condition = "Different - High Grip"),
  mutate(RT_diff_low_grip_CDT_4T, condition = "Different - Low Grip"),
  mutate(RT_same_high_grip_CDT_4T, condition = "Same - High Grip"),
  mutate(RT_same_low_grip_CDT_4T, condition = "Same - Low Grip")
)

# Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")

# Convert 'stimLev' to factor with the desired order
combined_RT_grip_CDT_4T$stimLev <- factor(combined_RT_grip_CDT_4T$stimLev, levels = desired_order)


# Plotting without jitter
ggplot(data = combined_RT_grip_CDT_4T) +
  geom_point(aes(x = stimLev, y = medRT_high_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_diff - medRT_high_diff_se, 
                     ymax = medRT_high_diff + medRT_high_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_diff, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_diff, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_diff - medRT_low_diff_se, 
                     ymax = medRT_low_diff + medRT_low_diff_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_high_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_high_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_high_same - medRT_high_same_se, 
                     ymax = medRT_high_same + medRT_high_same_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimLev, y = medRT_low_same, color = condition), size = 2) +
  geom_line(aes(x = stimLev, y = medRT_low_same, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimLev, ymin = medRT_low_same - medRT_low_same_se, 
                     ymax = medRT_low_same + medRT_low_same_se, color = condition), 
                 linetype = "solid") +
  
  ggtitle("Median of Reaction Time Within and Mean Between - CDT") +
  xlab("Degree") +
  ylab("Median Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                      name = "Condition") 





```


### Confidence

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
CDT_4T_conf_ws <- CDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
CDT_4T_conf_ws <- CDT_4T_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_4T_conf_ws <- CDT_4T_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean) 

diff_average_confidence_CDT_4T <- CDT_4T_conf_ws %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_conf = mean(diff_prop, na.rm = T), 
                  diff_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_confidence_CDT_4T <- CDT_4T_conf_ws %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_conf = mean(same_prop), 
                  same_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

  combined_prop_CDT_4T <- bind_rows(
        mutate(diff_average_confidence_CDT_4T, condition = "Different"),
        mutate(same_average_confidence_CDT_4T, condition = "Same")
    )
  
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")
    
    # Convert 'stimLev' to factor with the desired order
    combined_prop_CDT_4T$stimLev <- factor(combined_prop_CDT_4T$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_prop_CDT_4T <- combined_prop_CDT_4T %>%
        arrange(condition, stimLev)
    
    # Plotting
    ggplot(combined_prop_CDT_4T, aes(x = stimLev, group = condition, color = condition)) +
        geom_point(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 2) +
    geom_line(aes(y = ifelse(condition == "Different", diff_conf, same_conf)), size = 1.2) +
        ylim(2, 4) +
        ggtitle("Average of Confidence Response - CDT") +
        geom_linerange(mapping = aes(ymin = diff_conf - diff_conf_se, ymax = diff_conf + diff_conf_se, linetype = condition), data = filter(combined_prop_CDT_4T, condition == "Different")) +
    geom_linerange(mapping = aes(ymin = same_conf - same_conf_se, ymax = same_conf + same_conf_se, linetype = condition), data = filter(combined_prop_CDT_4T, condition == "Same")) +
        labs(caption = "Error bars represent within-subject SEM") +
        xlab("Degree") +
        ylab("Confidence Rating") +
        scale_color_manual(values = c("Different" = "#BC3C29FF",
                                      "Same" = "#0072B5FF"
                                      ),
                           labels = c("Different",
                                      "Same"
                                      )) +
        scale_linetype_manual(values = c("Different" = "solid", "Same" = "solid"))
    


```


#### Handgrip manipulation

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}


# calculate subject mean
CDT_4T_conf_ws <- CDT_4T %>%
  group_by(sub, stimLev, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
CDT_4T_conf_ws <- CDT_4T_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

CDT_4T_conf_ws <- CDT_4T_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean) 

diff_average_high_confidence_CDT_4T <- CDT_4T_conf_ws %>%
        filter(isStrength == 1) %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_high_conf = mean(diff_prop, na.rm = T), 
                  diff_high_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

diff_average_low_confidence_CDT_4T <- CDT_4T_conf_ws %>%
        filter(isStrength == 0) %>%
        filter(resp1_diff== 1) %>%
        group_by(stimLev, sub) %>%
        summarise(diff_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(diff_low_conf = mean(diff_prop, na.rm = T), 
                  diff_low_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()


same_average_high_confidence_CDT_4T <- CDT_4T_conf_ws %>%
        filter(isStrength == 1) %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_high_conf = mean(same_prop, na.rm = T), 
                  same_high_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()

same_average_low_confidence_CDT_4T <- CDT_4T_conf_ws %>%
        filter(isStrength == 0) %>%
        filter(resp1_diff== 0) %>%
        group_by(stimLev, sub) %>%
        summarise(same_prop = mean(resp2, na.rm = TRUE),conf_diff) %>%
        ungroup() %>%
        group_by(stimLev) %>%
        summarise(same_low_conf = mean(same_prop, na.rm = T), 
                  same_low_conf_se = sd(conf_diff, na.rm=T) / sqrt(n_distinct(sub))) %>%
        distinct()


combined_conf_grip_CDT_4T <- bind_rows(
        mutate(diff_average_high_confidence_CDT_4T, condition = "Different - High Grip"),
        mutate(diff_average_low_confidence_CDT_4T, condition = "Different - Low Grip" ),
        mutate(same_average_high_confidence_CDT_4T, condition = "Same - High Grip"),
        mutate(same_average_low_confidence_CDT_4T, condition = "Same - Low Grip")
)
  
    # Specify the desired order of levels for 'stimLev'
    desired_order <- c("0", "5", "20", "45", "90")
    
    # Convert 'stimLev' to factor with the desired order
    combined_conf_grip_CDT_4T$stimLev <- factor(combined_conf_grip_CDT_4T$stimLev, levels = desired_order)
    
    # Sort the combined dataset by stimLev within each condition
    combined_conf_grip_CDT_4T <- combined_conf_grip_CDT_4T %>%
        arrange(condition, stimLev)
    


ggplot(combined_conf_grip_CDT_4T, aes(x = stimLev, color = condition)) +
  geom_point(aes(y = diff_high_conf), size = 3) +
  geom_line(aes(y = diff_high_conf, group = condition), size = 1.2) +
  geom_linerange(aes(ymin = diff_high_conf - diff_high_conf_se, 
                     ymax = diff_high_conf + diff_high_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  geom_point(aes(y = diff_low_conf), size = 3) +
  geom_line(aes(y = diff_low_conf, group = condition), size = 1.2, linetype = "solid") +
  geom_linerange(aes(ymin = diff_low_conf - diff_low_conf_se, 
                     ymax = diff_low_conf + diff_low_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  geom_point(aes(y = same_high_conf), size = 3) +
  geom_line(aes(y = same_high_conf, group = condition), size = 1.2) +
  geom_linerange(aes(ymin = same_high_conf - same_high_conf_se, 
                     ymax = same_high_conf + same_high_conf_se, group = condition), 
                  linetype = "solid") +
  geom_point(aes(y = same_low_conf), size = 3) +
  geom_line(aes(y = same_low_conf, group = condition), size = 1.2, linetype = "solid") +
  geom_linerange(aes(ymin = same_low_conf - same_low_conf_se, 
                     ymax = same_low_conf + same_low_conf_se, group = condition), 
                 width = 0.2, linetype = "solid") +
  ggtitle("Average of Confidence Response - CDT") +
  labs(caption = "Error bars represent within-subject SEM", x = "Degree", y = "Confidence Rating") +
  scale_color_manual(values = c("#BC3C29FF", "#ea9999", "#0072B5FF", "#CCE6FF"),
                     name = "Response Type") +
  ylim(2,4)+
  scale_linetype_manual(values = c("solid", "solid"), name = "Condition",
                        labels = c("High Grip", "Low Grip")) 




```

## Statistical Analysis

### Effect of Grip on responses

#### The Effect of Grip on 'Different' Responses across Stimulus Levels

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

CDT_anova_grip_diff <- CDT_4T %>%
  filter(stimLev!= 0) %>% group_by(stimLev, isStrength, sub) %>% mutate(diff_sub = mean(resp1_diff, na.rm = TRUE)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(diff = mean(diff_sub), stimLev, isStrength) %>%
  distinct()
  
head(CDT_anova_grip_diff)
aov(diff ~ (stimLev * isStrength), CDT_anova_grip_diff) %>% report()
```

#### The Effect of Grip on 'Same' Responses across Stimulus Levels

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

CDT_anova_grip_same <- CDT_4T %>%
  filter(stimLev!= 0) %>% group_by(stimLev, isStrength, sub) %>% mutate(diff_sub = 1-mean(resp1_diff, na.rm = TRUE)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(diff = mean(diff_sub, na.rm = T), stimLev, isStrength) %>%
  distinct()
  
head(CDT_anova_grip_same)
aov(diff ~ (stimLev * isStrength), CDT_anova_grip_same) %>% report()
```

### Effect of Grip on Reaction Time


#### The Effect of Grip on Median Reaction Time for 'Different' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

CDT_anova_grip_RT_diff <- CDT_4T %>%
  filter(stimLev!= 0) %>% filter(resp1_diff ==1) %>% group_by(stimLev, isStrength, sub) %>% mutate(RT_sub = median(resp1RT)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(RT = median(RT_sub), stimLev, isStrength) %>%
  distinct()
  
head(CDT_anova_grip_RT_diff)
aov(RT ~ (stimLev * isStrength), CDT_anova_grip_RT_diff) %>% report()
```

#### The Effect of Grip on Median Reaction Time for 'Same' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

CDT_anova_grip_RT_same <- CDT_4T %>%
  filter(stimLev!= 0) %>% filter(resp1_diff ==0) %>% group_by(stimLev, isStrength, sub) %>% mutate(RT_sub = median(resp1RT)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(RT = median(RT_sub), stimLev, isStrength) %>%
  distinct()
  
head(CDT_anova_grip_RT_same)
aov(RT ~ (stimLev * isStrength), CDT_anova_grip_RT_same) %>% report()
```

### Effect of Grip on Confidence


#### The Effect of Grip on Confidence Reports for 'Different' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

CDT_anova_grip_conf_diff <- CDT_4T %>%
  filter(stimLev!= 0) %>% filter(resp1_diff ==1) %>% group_by(stimLev, isStrength, sub) %>% mutate(conf_sub = mean(resp2, na.rm = T)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(conf = mean(conf_sub, na.rm = T), stimLev, isStrength) %>%
  distinct()
  
head(CDT_anova_grip_conf_diff)
aov(conf ~ (stimLev * isStrength), CDT_anova_grip_conf_diff) %>% report()
```

#### The Effect of Grip on Confidence Reports for 'Same' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

CDT_anova_grip_conf_same <- CDT_4T %>%
  filter(stimLev!= 0) %>% filter(resp1_diff ==0) %>% group_by(stimLev, isStrength, sub) %>% mutate(conf_sub = mean(resp2, na.rm = T)) %>%
  ungroup() %>% group_by(stimLev, isStrength) %>% summarise(conf = median(conf_sub, na.rm=T), stimLev, isStrength) %>%
  distinct()
  
head(CDT_anova_grip_conf_same)
aov(conf ~ (stimLev * isStrength), CDT_anova_grip_conf_same) %>% report()
```



## MST

### Specific Dataframes

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}
MST_4T <- lcya_behdata_trial_mst %>%
    filter(task == 'MSTtest') %>%
    filter(!is.na(resp1)) %>%
    filter(sub %in% c('13','16','17','18','19','23','24','25','26','27','29','31','33','34','35','36','37','42','43','46','48','54','56','58','61','64','65','68','69','71','72','74','82','83','85','87','88'))


# Read the text file with im_num and lure_bin values
SetC_4 <- read.table("SetC_4.txt", header=F)

colnames(SetC_4)[1] <- "im_num"
colnames(SetC_4)[2] <- "new_lure_bin"
MST_4T <- left_join(MST_4T, SetC_4, by="im_num")

MST_4T$lure_bin <- ifelse(!is.na(MST_4T$new_lure_bin), MST_4T$new_lure_bin, MST_4T$lure_bin)

# Drop the new_lure_bin column if you don't need it anymore
MST_4T <- subset(MST_4T, select = -c(new_lure_bin))

MST_4T <- MST_4T %>%
  mutate(lure_bin = ifelse(trial_type != "lure", NA, lure_bin))


# Update stimlev_mst values based on the specified rules
MST_4T <- MST_4T %>%
  mutate(stimlev_mst = case_when(
    trial_type == "foil" ~ "5foil",
    trial_type == "targ" ~ "0targ",
    lure_bin == '1' ~ "1lure",
    lure_bin == '2' ~ "2lure",
    lure_bin == '3' ~ "3lure",
    lure_bin == '4' ~ "4lure",
    TRUE ~ as.character(stimlev_mst)  # Keep the original value if none of the conditions are met
  ))


```


### Proportion of Responding 'Old', 'Similar', 'New'

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
    MST_4T_acc_ws <- MST_4T %>%
      group_by(sub, stimlev_mst, resp1_diff) %>%
      mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
      distinct() %>%
      ungroup()

# calculate the grand mean
    MST_4T_acc_ws <- MST_4T_acc_ws %>%
      group_by(sub) %>%
      mutate(grand_mean = mean(sub_mean)) %>%
      ungroup()

# subtract the subject mean and add grand mean for each cell

    MST_4T_acc_ws <- MST_4T_acc_ws %>%
      mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean proportion for old responses
    Old_prop_MST_4T <- MST_4T_acc_ws %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_old = case_when(resp1 == 'old' ~ 1, TRUE ~ 0)) %>%  # Corrected the syntax for case_when
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_old = mean(resp1_old, na.rm = T),
                prop_old_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
        
# Calculate mean proportion for sim responses
    Sim_prop_MST_4T <- MST_4T_acc_ws %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_sim = case_when(resp1 == 'sim' ~ 1, TRUE ~ 0)) %>%  # Corrected the syntax for case_when
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_sim = mean(resp1_sim, na.rm = T),
                prop_sim_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
# Calculate mean proportion for new responses
    New_prop_MST_4T <- MST_4T_acc_ws %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_new = case_when(resp1 == 'new' ~ 1, TRUE ~ 0)) %>%  # Corrected the syntax for case_when
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_new = mean(resp1_new, na.rm = T),
                prop_new_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
# Combine both datasets for plotting
     combined_prop_MST_4T <- bind_rows(
        mutate(Old_prop_MST_4T, condition = "Old"),
        mutate(Sim_prop_MST_4T, condition = "Similar"),
        mutate(New_prop_MST_4T, condition = "New")
    )
    combined_prop_MST_4T$stimlev_mst <- factor(combined_prop_MST_4T$stimlev_mst, levels = desired_order)

# Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")

# Convert 'stimlev_mst' to factor with the desired order
  combined_prop_MST_4T$stimlev_mst <- factor(combined_prop_MST_4T$stimlev_mst, levels = desired_order)



# Plotting
ggplot(combined_prop_MST_4T, aes(x = stimlev_mst)) +
  geom_line(aes(y = prop_old, group = condition, color = "Old"), size = 1.2) +
  geom_line(aes(y = prop_sim, group = condition, color = "Similar"), size = 1.2) +
  geom_line(aes(y = prop_new, group = condition, color = "New"), size = 1.2) +
  geom_point(aes(y = prop_old, color = "Old"), size = 2) +
  geom_point(aes(y = prop_sim, color = "Similar"), size = 2) +
  geom_point(aes(y = prop_new, color = "New"), size = 2) +
  geom_linerange(aes(ymin = prop_old - prop_old_se, ymax = prop_old + prop_old_se), color = "#0072B5FF", size = 0.5) +
  geom_linerange(aes(ymin = prop_sim - prop_sim_se, ymax = prop_sim + prop_sim_se), color = "#20854EFF", size = 0.5) +
  geom_linerange(aes(ymin = prop_new - prop_new_se, ymax = prop_new + prop_new_se), color = "#BC3C29FF", size = 0.5) +
  ggtitle("Proportions of Old, Similar, and New Responses - MST") +
  xlab("Stimulus Level") +
  ylab("Proportion") +
  ylim(0,1) +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values=c("Old"="#0072B5FF", "New"="#BC3C29FF", "Similar"="#20854EFF")) +
  guides(color = guide_legend(title = "Response Type"))

      


```


#### Handgrip manipulation

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
    MST_4T_acc_ws <- MST_4T %>%
      group_by(sub, stimlev_mst, resp1_diff) %>%
      mutate(sub_mean = mean(resp1_diff, na.rm=T)) %>%
      distinct() %>%
      ungroup()

# calculate the grand mean
    MST_4T_acc_ws <- MST_4T_acc_ws %>%
      group_by(sub) %>%
      mutate(grand_mean = mean(sub_mean)) %>%
      ungroup()

# subtract the subject mean and add grand mean for each cell

    MST_4T_acc_ws <- MST_4T_acc_ws %>%
      mutate(acc_diff = sub_mean- grand_mean) 

# Calculate mean proportion for high - old responses
    Old_prop_high_grip_MST_4T <- MST_4T_acc_ws %>%
      filter(isStrength==1) %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_old = case_when(resp1 == 'old' ~ 1, TRUE ~ 0)) %>% 
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_old_high = mean(resp1_old, na.rm = T),
                prop_old_high_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()

# Calculate mean proportion for low - old responses
    Old_prop_low_grip_MST_4T <- MST_4T_acc_ws %>%
      filter(isStrength==0) %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_old = case_when(resp1 == 'old' ~ 1, TRUE ~ 0)) %>% 
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_old_low = mean(resp1_old, na.rm = T),
                prop_old_low_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()    
    
# Calculate mean proportion for high-sim responses
    Sim_prop_high_grip_MST_4T <- MST_4T_acc_ws %>%
      filter(isStrength==1) %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_sim = case_when(resp1 == 'sim' ~ 1, TRUE ~ 0)) %>%  
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_sim_high = mean(resp1_sim, na.rm = T),
                prop_sim_high_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
# Calculate mean proportion for low-sim responses
    Sim_prop_low_grip_MST_4T <- MST_4T_acc_ws %>%
      filter(isStrength==0) %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_sim = case_when(resp1 == 'sim' ~ 1, TRUE ~ 0)) %>%  
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_sim_low = mean(resp1_sim, na.rm = T),
                prop_sim_low_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
        
# Calculate mean proportion for high-new responses
    New_prop_high_grip_MST_4T <- MST_4T_acc_ws %>%
      filter(isStrength==1) %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_new = case_when(resp1 == 'new' ~ 1, TRUE ~ 0)) %>%  
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_new_high = mean(resp1_new, na.rm = T),
                prop_new_high_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
   
# Calculate mean proportion for low-new responses
    New_prop_low_grip_MST_4T <- MST_4T_acc_ws %>%
      filter(isStrength==0) %>%
      group_by(stimlev_mst, sub) %>%
      mutate(resp1_new = case_when(resp1 == 'new' ~ 1, TRUE ~ 0)) %>%  
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(prop_new_low = mean(resp1_new, na.rm = T),
                prop_new_low_se = sd(acc_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
    
# Combine both datasets for plotting
combined_grip_MST_4T <- bind_rows(
  mutate(Old_prop_high_grip_MST_4T, condition = "Old - High Grip", prop = prop_old_high),
  mutate(Old_prop_low_grip_MST_4T, condition = "Old - Low Grip", prop = prop_old_low),
  mutate(Sim_prop_high_grip_MST_4T, condition = "Similar - High Grip", prop = prop_sim_high),
  mutate(Sim_prop_low_grip_MST_4T, condition = "Similar - Low Grip", prop = prop_sim_low),
  mutate(New_prop_high_grip_MST_4T, condition = "New - High Grip", prop = prop_new_high),
  mutate(New_prop_low_grip_MST_4T, condition = "New - Low Grip", prop = prop_new_low)
)

  combined_prop_MST_4T$stimlev_mst <- factor(combined_prop_MST_4T$stimlev_mst, levels = desired_order)

# Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")

# Convert 'stimlev_mst' to factor with the desired order
  combined_prop_MST_4T$stimlev_mst <- factor(combined_prop_MST_4T$stimlev_mst, levels = desired_order)



# Plotting
ggplot(combined_grip_MST_4T, aes(x = stimlev_mst, y = prop, group = condition, color = condition)) +
  geom_point(size = 2) +
  geom_line(size = 1.2) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(grepl("Old", condition), prop_old_high_se, ifelse(grepl("Similar", condition), prop_sim_high_se, prop_new_high_se)),
                                  ymax = prop + ifelse(grepl("Old", condition), prop_old_high_se, ifelse(grepl("Similar", condition), prop_sim_high_se, prop_new_high_se)),
                                  color = condition),
                    show.legend = FALSE) +
  geom_linerange(mapping = aes(ymin = prop - ifelse(grepl("Old", condition), prop_old_low_se, ifelse(grepl("Similar", condition), prop_sim_low_se, prop_new_low_se)),
                                  ymax = prop + ifelse(grepl("Old", condition), prop_old_low_se, ifelse(grepl("Similar", condition), prop_sim_low_se, prop_new_low_se)),
                                  color = condition),
                    show.legend = FALSE) +
  ylim(0, 1) +
  ggtitle("Proportions of Old, Similar, and New Responses - MST_4T") +
  xlab("Similarity level") +
  ylab("Proportion") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("New - High Grip" = "#BC3C29FF", "New - Low Grip" = "#ea9999", "Old - High Grip" = "#0072B5FF", "Old - Low Grip" = "#CCE6FF", "Similar - High Grip" = "#20854EFF", "Similar - Low Grip" = "#a7eac6")) +
  scale_linetype_manual(values = c("New - High Grip" = "solid", "New - Low Grip" = "solid", "Old - High Grip" = "solid", "Old - Low Grip" = "solid", "Similar - High Grip" = "solid", "Similar - Low Grip" = "solid")) +
  guides(color = guide_legend(title = "Response Type", ncol = 1), linetype = "none")



```


### Reaction Time

#### Using Median with within-subject SEM

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
MST_4T_RT_ws <- MST_4T %>%
  group_by(sub, stimlev_mst, resp1) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
MST_4T_RT_ws <- MST_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

MST_4T_RT_ws <- MST_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 


# Calculate mean RT for old responses
    Old_medRT_MST_4T <- MST_4T_RT_ws %>%
        filter(resp1 == 'old') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= median(resp1RT),RT_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_old = median(RT),
                  RT_old_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean RT for sim responses
    Sim_medRT_MST_4T <- MST_4T_RT_ws %>%
        filter(resp1 == 'sim') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= median(resp1RT),RT_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_sim = median(RT),
                  RT_sim_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
        distinct()
 
# Calculate mean RT for old responses
    New_medRT_MST_4T <- MST_4T_RT_ws %>%
        filter(resp1 == 'new') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= median(resp1RT), RT_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_new = median(RT),
                  RT_new_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_medRT_MST_4T <- bind_rows(
        mutate(Old_medRT_MST_4T, condition = "Old"),
        mutate(Sim_medRT_MST_4T, condition = "Similar"),
        mutate(New_medRT_MST_4T, condition = "New")
    )
    
# Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")
    
 # Convert 'stimlev_mst' to factor with the desired order
combined_medRT_MST_4T$stimlev_mst <- factor(combined_medRT_MST_4T$stimlev_mst, levels = desired_order)

#Sort the combined dataset by stimlev_mst within each condition
    combined_medRT_MST_4T <- combined_medRT_MST_4T %>%
        arrange(condition, stimlev_mst)
    
# Plotting
ggplot(combined_medRT_MST_4T, aes(x = stimlev_mst)) +
  geom_line(aes(y = RT_old, group = condition, color = "Old"), size = 1.2) +
  geom_line(aes(y = RT_sim, group = condition, color = "Similar"), size = 1.2) +
  geom_line(aes(y = RT_new, group = condition, color = "New"), size = 1.2) +
  geom_point(aes(y = RT_old, color = "Old"), size = 2) +
  geom_point(aes(y = RT_sim, color = "Similar"), size = 2) +
  geom_point(aes(y = RT_new, color = "New"), size = 2) +
  geom_linerange(aes(ymin = RT_old - RT_old_se, ymax = RT_old + RT_old_se), color = "#0072B5FF", size = 0.5) +
  geom_linerange(aes(ymin = RT_sim - RT_sim_se, ymax = RT_sim + RT_sim_se), color = "#20854EFF", size = 0.5) +
  geom_linerange(aes(ymin = RT_new - RT_new_se, ymax = RT_new + RT_new_se), color = "#BC3C29FF", size = 0.5) +
  ggtitle("Median of Median Reaction Time for Old, Similar, and New Responses - MST") +
  xlab("Stimulus Level") +
  ylab("Median Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values=c("Old"="#0072B5FF", "New"="#BC3C29FF", "Similar"="#20854EFF")) +
  guides(color = guide_legend(title = "Response Type"))


```

#### Using Median within and Mean between subjects with WSSEM

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}


# calculate subject mean
MST_4T_RT_ws <- MST_4T %>%
  group_by(sub, stimlev_mst, resp1) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
MST_4T_RT_ws <- MST_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

MST_4T_RT_ws <- MST_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 


# Calculate mean RT for old responses
    Old_medRT_MST_4T <- MST_4T_RT_ws %>%
        filter(resp1 == 'old') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= median(resp1RT),RT_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_old = mean(RT, na.rm = T),
                  RT_old_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean RT for sim responses
    Sim_medRT_MST_4T <- MST_4T_RT_ws %>%
        filter(resp1 == 'sim') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= median(resp1RT),RT_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_sim = mean(RT, na.rm = T),
                  RT_sim_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
        distinct()
 
# Calculate mean RT for old responses
    New_medRT_MST_4T <- MST_4T_RT_ws %>%
        filter(resp1 == 'new') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(RT= median(resp1RT), RT_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(RT_new = mean(RT, na.rm = T),
                  RT_new_se = sd(RT_diff, na.rm=T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_RT_MST_4T <- bind_rows(
        mutate(Old_medRT_MST_4T, condition = "Old"),
        mutate(Sim_medRT_MST_4T, condition = "Similar"),
        mutate(New_medRT_MST_4T, condition = "New")
    )
    
# Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")
    
 # Convert 'stimlev_mst' to factor with the desired order
combined_RT_MST_4T$stimlev_mst <- factor(combined_RT_MST_4T$stimlev_mst, levels = desired_order)

#Sort the combined dataset by stimlev_mst within each condition
    combined_RT_MST_4T <- combined_RT_MST_4T %>%
        arrange(condition, stimlev_mst)
    
# Plotting
ggplot(combined_RT_MST_4T, aes(x = stimlev_mst)) +
  geom_line(aes(y = RT_old, group = condition, color = "Old"), size = 1.2) +
  geom_line(aes(y = RT_sim, group = condition, color = "Similar"), size = 1.2) +
  geom_line(aes(y = RT_new, group = condition, color = "New"), size = 1.2) +
  geom_point(aes(y = RT_old, color = "Old"), size = 2) +
  geom_point(aes(y = RT_sim, color = "Similar"), size = 2) +
  geom_point(aes(y = RT_new, color = "New"), size = 2) +
  geom_linerange(aes(ymin = RT_old - RT_old_se, ymax = RT_old + RT_old_se), color = "#0072B5FF", size = 0.5) +
  geom_linerange(aes(ymin = RT_sim - RT_sim_se, ymax = RT_sim + RT_sim_se), color = "#20854EFF", size = 0.5) +
  geom_linerange(aes(ymin = RT_new - RT_new_se, ymax = RT_new + RT_new_se), color = "#BC3C29FF", size = 0.5) +
  ggtitle("Median of Within and Mean Between Reaction Time - MST") +
  xlab("Stimulus Level") +
  ylab("Median Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values=c("Old"="#0072B5FF", "New"="#BC3C29FF", "Similar"="#20854EFF")) +
  guides(color = guide_legend(title = "Response Type"))


```


#### Handgrip manipulation with Median

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
MST_4T_RT_ws <- MST_4T %>%
  group_by(sub, stimlev_mst, resp1) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
MST_4T_RT_ws <- MST_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

MST_4T_RT_ws <- MST_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 

# Calculate median RT for high - old responses
    Old_RT_high_grip_MST_4T <- MST_4T_RT_ws %>%
      filter(isStrength==1) %>%
      filter(resp1=='old') %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_old_high = median(RT),
                RT_old_high_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()

# Calculate median RT for low - old responses
    Old_RT_low_grip_MST_4T <- MST_4T_RT_ws %>%
      filter(isStrength==0) %>%
      filter(resp1=='old') %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_old_low = median(RT),
                RT_old_low_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()    
    
# Calculate median RT for high-sim responses
    Sim_RT_high_grip_MST_4T <- MST_4T_RT_ws %>%
      filter(isStrength==1) %>%
      filter(resp1=='sim') %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_sim_high = median(RT),
                RT_sim_high_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
# Calculate median RT  for low-sim responses
    Sim_RT_low_grip_MST_4T <- MST_4T_RT_ws %>%
      filter(isStrength==0) %>%
      filter(resp1=='sim') %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_sim_low = median(RT),
                RT_sim_low_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
        
# Calculate median RT  for high-new responses
    New_RT_high_grip_MST_4T <- MST_4T_RT_ws %>%
      filter(resp1=='new') %>%
      filter(isStrength==1) %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_new_high = median(RT),
                RT_new_high_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
   
# Calculate median RT for low-new responses
    New_RT_low_grip_MST_4T <- MST_4T_RT_ws %>%
      filter(resp1=='new') %>%
      filter(isStrength==0) %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_new_low = median(RT),
                RT_new_low_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
    
# Combine both datasets for plotting
combined_medRT_grip_MST_4T <- bind_rows(
  mutate(Old_RT_high_grip_MST_4T, condition = "Old - High Grip", RT = RT_old_high),
  mutate(Old_RT_low_grip_MST_4T, condition = "Old - Low Grip", RT = RT_old_low),
  mutate(Sim_RT_high_grip_MST_4T, condition = "Similar - High Grip", RT = RT_sim_high),
  mutate(Sim_RT_low_grip_MST_4T, condition = "Similar - Low Grip", RT = RT_sim_low),
  mutate(New_RT_high_grip_MST_4T, condition = "New - High Grip", RT = RT_new_high),
  mutate(New_RT_low_grip_MST_4T, condition = "New - Low Grip", RT = RT_new_low)
)

  combined_medRT_grip_MST_4T$stimlev_mst <- factor(combined_medRT_grip_MST_4T$stimlev_mst, levels = desired_order)

# Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")

# Convert 'stimlev_mst' to factor with the desired order
  combined_medRT_grip_MST_4T$stimlev_mst <- factor(combined_medRT_grip_MST_4T$stimlev_mst, levels = desired_order)

# Plotting without jitter
ggplot(data = combined_medRT_grip_MST_4T) +
  geom_point(aes(x = stimlev_mst, y = RT_old_high, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_old_high, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_old_high - RT_old_high_se, 
                     ymax = RT_old_high + RT_old_high_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_old_low, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_old_low, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_old_low - RT_old_low_se, 
                     ymax = RT_old_low + RT_old_low_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_sim_high, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_sim_high, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_sim_high - RT_sim_high_se, 
                     ymax = RT_sim_high + RT_sim_high_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_sim_low, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_sim_low, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_sim_low - RT_sim_low_se, 
                     ymax = RT_sim_low + RT_sim_low_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_new_high, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_new_high, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_new_high - RT_new_high_se, 
                     ymax = RT_new_high + RT_new_high_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_new_low, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_new_low, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_new_low - RT_new_low_se, 
                     ymax = RT_new_low + RT_new_low_se, color = condition), 
                 linetype = "solid") +
  
  
  ggtitle("Median of Reaction Time for Same and Different Responses - MST") +
  xlab("Similarity level") +
  ylab("Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("New - High Grip" = "#BC3C29FF", "New - Low Grip" = "#ea9999", "Old - High Grip" = "#0072B5FF", "Old - Low Grip" = "#CCE6FF", "Similar - High Grip" = "#20854EFF", "Similar - Low Grip" = "#a7eac6")) +
  scale_linetype_manual(values = c("New - High Grip" = "solid", "New - Low Grip" = "solid", "Old - High Grip" = "solid", "Old - Low Grip" = "solid", "Similar - High Grip" = "solid", "Similar - Low Grip" = "solid")) +
  guides(color = guide_legend(title = "Response Type", ncol = 1), linetype = "none")



```

#### Handgrip manipulation with Median within and Mean between with WSSEM

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
MST_4T_RT_ws <- MST_4T %>%
  group_by(sub, stimlev_mst, resp1) %>%
  mutate(sub_mean = mean(resp1RT, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
MST_4T_RT_ws <- MST_4T_RT_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

MST_4T_RT_ws <- MST_4T_RT_ws %>%
  mutate(RT_diff = sub_mean- grand_mean) 

# Calculate median RT for high - old responses
    Old_RT_high_grip_MST_4T <- MST_4T_RT_ws %>%
      filter(isStrength==1) %>%
      filter(resp1=='old') %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_old_high = mean(RT, na.rm = T),
                RT_old_high_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()

# Calculate median RT for low - old responses
    Old_RT_low_grip_MST_4T <- MST_4T_RT_ws %>%
      filter(isStrength==0) %>%
      filter(resp1=='old') %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_old_low = mean(RT, na.rm = T),
                RT_old_low_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()    
    
# Calculate median RT for high-sim responses
    Sim_RT_high_grip_MST_4T <- MST_4T_RT_ws %>%
      filter(isStrength==1) %>%
      filter(resp1=='sim') %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_sim_high = mean(RT, na.rm = T),
                RT_sim_high_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
# Calculate median RT  for low-sim responses
    Sim_RT_low_grip_MST_4T <- MST_4T_RT_ws %>%
      filter(isStrength==0) %>%
      filter(resp1=='sim') %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_sim_low = mean(RT, na.rm = T),
                RT_sim_low_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
        
# Calculate median RT  for high-new responses
    New_RT_high_grip_MST_4T <- MST_4T_RT_ws %>%
      filter(resp1=='new') %>%
      filter(isStrength==1) %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_new_high = mean(RT, na.rm = T),
                RT_new_high_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
   
# Calculate median RT for low-new responses
    New_RT_low_grip_MST_4T <- MST_4T_RT_ws %>%
      filter(resp1=='new') %>%
      filter(isStrength==0) %>%
      group_by(stimlev_mst, sub) %>%
      summarise(RT= median(resp1RT),RT_diff) %>%
      ungroup() %>%
      group_by(stimlev_mst) %>%
      summarise(RT_new_low = mean(RT, na.rm = T),
                RT_new_low_se = sd(RT_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
      distinct()
    
    
# Combine both datasets for plotting
combined_RT_grip_MST_4T <- bind_rows(
  mutate(Old_RT_high_grip_MST_4T, condition = "Old - High Grip", RT = RT_old_high),
  mutate(Old_RT_low_grip_MST_4T, condition = "Old - Low Grip", RT = RT_old_low),
  mutate(Sim_RT_high_grip_MST_4T, condition = "Similar - High Grip", RT = RT_sim_high),
  mutate(Sim_RT_low_grip_MST_4T, condition = "Similar - Low Grip", RT = RT_sim_low),
  mutate(New_RT_high_grip_MST_4T, condition = "New - High Grip", RT = RT_new_high),
  mutate(New_RT_low_grip_MST_4T, condition = "New - Low Grip", RT = RT_new_low)
)

  combined_RT_grip_MST_4T$stimlev_mst <- factor(combined_RT_grip_MST_4T$stimlev_mst, levels = desired_order)

# Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")

# Convert 'stimlev_mst' to factor with the desired order
  combined_RT_grip_MST_4T$stimlev_mst <- factor(combined_RT_grip_MST_4T$stimlev_mst, levels = desired_order)

# Plotting without jitter
ggplot(data = combined_RT_grip_MST_4T) +
  geom_point(aes(x = stimlev_mst, y = RT_old_high, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_old_high, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_old_high - RT_old_high_se, 
                     ymax = RT_old_high + RT_old_high_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_old_low, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_old_low, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_old_low - RT_old_low_se, 
                     ymax = RT_old_low + RT_old_low_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_sim_high, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_sim_high, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_sim_high - RT_sim_high_se, 
                     ymax = RT_sim_high + RT_sim_high_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_sim_low, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_sim_low, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_sim_low - RT_sim_low_se, 
                     ymax = RT_sim_low + RT_sim_low_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_new_high, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_new_high, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_new_high - RT_new_high_se, 
                     ymax = RT_new_high + RT_new_high_se, color = condition), 
                 linetype = "solid") +
  
  geom_point(aes(x = stimlev_mst, y = RT_new_low, color = condition), size = 2) +
  geom_line(aes(x = stimlev_mst, y = RT_new_low, color = condition, group = condition), size = 1.2) +
  geom_linerange(aes(x = stimlev_mst, ymin = RT_new_low - RT_new_low_se, 
                     ymax = RT_new_low + RT_new_low_se, color = condition), 
                 linetype = "solid") +
  
  
  ggtitle("Median of Reaction Time Within and Mean Between - MST") +
  xlab("Similarity level") +
  ylab("Reaction Time") +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("New - High Grip" = "#BC3C29FF", "New - Low Grip" = "#ea9999", "Old - High Grip" = "#0072B5FF", "Old - Low Grip" = "#CCE6FF", "Similar - High Grip" = "#20854EFF", "Similar - Low Grip" = "#a7eac6")) +
  scale_linetype_manual(values = c("New - High Grip" = "solid", "New - Low Grip" = "solid", "Old - High Grip" = "solid", "Old - Low Grip" = "solid", "Similar - High Grip" = "solid", "Similar - Low Grip" = "solid")) +
  guides(color = guide_legend(title = "Response Type", ncol = 1), linetype = "none")



```


### Confidence

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# calculate subject mean
MST_4T_conf_ws <- MST_4T %>%
  group_by(sub, stimlev_mst, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
MST_4T_conf_ws <- MST_4T_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

MST_4T_conf_ws <- MST_4T_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean)

# Calculate mean confidence for old responses
    Old_conf_MST_4T <- MST_4T_conf_ws %>%
        filter(resp1 == 'old') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_old = mean(conf_prop, na.rm = T),
                  conf_old_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
# Calculate mean confidence for sim responses
    Sim_conf_MST_4T <- MST_4T_conf_ws %>%
        filter(resp1 == 'sim') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_sim = mean(conf_prop, na.rm = T),
                  conf_sim_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
# Calculate mean confidence for new responses
    New_conf_MST_4T <- MST_4T_conf_ws %>%
        filter(resp1 == 'new') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_new = mean(conf_prop, na.rm = T),
                  conf_new_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Combine both datasets for plotting
    combined_conf_MST_4T <- bind_rows(
        mutate(Old_conf_MST_4T, condition = "Old"),
        mutate(Sim_conf_MST_4T, condition = "Similar"),
        mutate(New_conf_MST_4T, condition = "New")
    )
    
    # Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")
    
    # Convert 'stimlev_mst' to factor with the desired order
    combined_conf_MST_4T$stimlev_mst <- factor(combined_conf_MST_4T$stimlev_mst, levels = desired_order)
    
    # Sort the combined dataset by stimlev_mst within each condition
    combined_conf_MST_4T <- combined_conf_MST_4T %>%
        arrange(condition, stimlev_mst)
    
    # Plotting
    ggplot(combined_conf_MST_4T, aes(x = stimlev_mst)) +
  geom_line(aes(y = conf_old, group = condition, color = "Old"), size = 1.2) +
  geom_line(aes(y = conf_sim, group = condition, color = "Similar"), size = 1.2) +
  geom_line(aes(y = conf_new, group = condition, color = "New"), size = 1.2) +
  geom_point(aes(y = conf_old, color = "Old"), size = 2) +
  geom_point(aes(y = conf_sim, color = "Similar"), size = 2) +
  geom_point(aes(y = conf_new, color = "New"), size = 2) +
  geom_linerange(aes(ymin = conf_old - conf_old_se, ymax = conf_old + conf_old_se), color = "#0072B5FF", size = 0.5) +
  geom_linerange(aes(ymin = conf_sim - conf_sim_se, ymax = conf_sim + conf_sim_se), color = "#20854EFF", size = 0.5) +
  geom_linerange(aes(ymin = conf_new - conf_new_se, ymax = conf_new + conf_new_se), color = "#BC3C29FF", size = 0.5) +
  ggtitle("Average of Confidence for Old, Similar, and New Responses - MST") +
  xlab("Stimulus Level") +
  ylab("Confidence Rating") +
  ylim(2,4)+
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values=c("Old"="#0072B5FF", "New"="#BC3C29FF", "Similar"="#20854EFF")) +
  guides(color = guide_legend(title = "Response Type"))

    

```


#### Handgrip manipulation

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}


# calculate subject mean
MST_4T_conf_ws <- MST_4T %>%
  group_by(sub, stimlev_mst, resp1_diff) %>%
  mutate(sub_mean = mean(resp2, na.rm=T)) %>%
  distinct() %>%
  ungroup()

# calculate the grand mean
MST_4T_conf_ws <- MST_4T_conf_ws %>%
  group_by(sub) %>%
  mutate(grand_mean = mean(sub_mean)) %>%
  ungroup()

# subtract the subject mean and add grand mean for each cell

MST_4T_conf_ws <- MST_4T_conf_ws %>%
  mutate(conf_diff = sub_mean- grand_mean)

# Calculate mean confidence for High old responses
    Old_conf_high_grip_MST_4T <- MST_4T_conf_ws %>%
        filter(isStrength==1) %>%
        filter(resp1 == 'old') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_high_old = mean(conf_prop, na.rm = T),
                  conf_high_old_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean confidence for low old responses
    Old_conf_low_grip_MST_4T <- MST_4T_conf_ws %>%
        filter(isStrength==0) %>%
        filter(resp1 == 'old') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_low_old = mean(conf_prop, na.rm = T),
                  conf_low_old_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean confidence for High sim responses
    Sim_conf_high_grip_MST_4T <- MST_4T_conf_ws %>%
        filter(isStrength==1) %>%
        filter(resp1 == 'sim') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_high_sim = mean(conf_prop, na.rm = T),
                  conf_high_sim_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean confidence for Low sim responses
    Sim_conf_low_grip_MST_4T <- MST_4T_conf_ws %>%
        filter(isStrength==0) %>%
        filter(resp1 == 'sim') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_low_sim = mean(conf_prop, na.rm = T),
                  conf_low_sim_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
    
# Calculate mean confidence for High new responses
    New_conf_high_grip_MST_4T <- MST_4T_conf_ws %>%
        filter(isStrength ==1) %>%
        filter(resp1 == 'new') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_high_new = mean(conf_prop, na.rm = T),
                  conf_high_new_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()
# Calculate mean confidence for Low new responses
    New_conf_low_grip_MST_4T <- MST_4T_conf_ws %>%
        filter(isStrength ==0) %>%
        filter(resp1 == 'new') %>%
        group_by(stimlev_mst,sub) %>%
        summarise(conf_prop= mean(resp2, na.rm = T),conf_diff) %>%
        ungroup() %>%
        group_by(stimlev_mst) %>%
        summarise(conf_low_new = mean(conf_prop, na.rm = T),
                  conf_low_new_se = sd(conf_diff, na.rm = T) /sqrt(n_distinct(sub))) %>%
        distinct()    
    
# Combine both datasets for plotting
    combined_conf_grip_MST_4T <- bind_rows(
        mutate(Old_conf_high_grip_MST_4T, condition = "Old - High Grip"),
        mutate(Sim_conf_high_grip_MST_4T, condition = "Similar - High Grip"),
        mutate(New_conf_high_grip_MST_4T, condition = "New - High Grip"),
        mutate(Old_conf_low_grip_MST_4T, condition = "Old - Low Grip"),
        mutate(Sim_conf_low_grip_MST_4T, condition = "Similar - Low Grip"),
        mutate(New_conf_low_grip_MST_4T, condition = "New - Low Grip")
    )

    
    # Specify the desired order of levels for 'stimlev_mst'
    desired_order <- c("0targ", "1lure", "2lure", "3lure", "4lure", "5foil")
    
    # Convert 'stimlev_mst' to factor with the desired order
    combined_conf_grip_MST_4T$stimlev_mst <- factor(combined_conf_grip_MST_4T$stimlev_mst, levels = desired_order)
    
    # Sort the combined dataset by stimlev_mst within each condition
    combined_conf_grip_MST_4T <- combined_conf_grip_MST_4T %>%
        arrange(condition, stimlev_mst)
    
ggplot(combined_conf_grip_MST_4T, aes(x = stimlev_mst)) +
  geom_line(aes(y = conf_high_old, group = condition, color = condition), size = 1.2) +
  geom_point(aes(y = conf_high_old, color = condition), size = 2) +
  geom_linerange(aes(ymin = conf_high_old - conf_high_old_se, ymax = conf_high_old + conf_high_old_se, color = condition), size = 0.5) +
  geom_line(aes(y = conf_high_sim, group = condition, color = condition), size = 1.2, linetype = "solid") +
  geom_point(aes(y = conf_high_sim, color = condition), size = 2) +
  geom_linerange(aes(ymin = conf_high_sim - conf_high_sim_se, ymax = conf_high_sim + conf_high_sim_se, color = condition), size = 0.5) +
  geom_line(aes(y = conf_high_new, group = condition, color = condition), size = 1.2, linetype = "solid") +
  geom_point(aes(y = conf_high_new, color = condition), size = 2) +
  geom_linerange(aes(ymin = conf_high_new - conf_high_new_se, ymax = conf_high_new + conf_high_new_se, color = condition), size = 0.5) +
  geom_line(aes(y = conf_low_old, group = condition, color = condition), size = 1.2) +
  geom_point(aes(y = conf_low_old, color = condition), size = 2) +
  geom_linerange(aes(ymin = conf_low_old - conf_low_old_se, ymax = conf_low_old + conf_low_old_se, color = condition), size = 0.5) +
  geom_line(aes(y = conf_low_sim, group = condition, color = condition), size = 1.2, linetype = "solid") +
  geom_point(aes(y = conf_low_sim, color = condition), size = 2) +
  geom_linerange(aes(ymin = conf_low_sim - conf_low_sim_se, ymax = conf_low_sim + conf_low_sim_se, color = condition), size = 0.5) +
  geom_line(aes(y = conf_low_new, group = condition, color = condition), size = 1.2, linetype = "solid") +
  geom_point(aes(y = conf_low_new, color = condition), size = 2) +
  geom_linerange(aes(ymin = conf_low_new - conf_low_new_se, ymax = conf_low_new + conf_low_new_se, color = condition), size = 0.5) +
  ggtitle("Average of Confidence for Old, Similar, and New Responses - MST") +
  xlab("Stimulus Level") +
  ylab("Confidence Rating") +
  ylim(2, 4) +
  labs(caption = "Error bars represent within-subject SEM") +
  scale_color_manual(values = c("#0072B5FF", "#CCE6FF", "#20854EFF", "#a7eac6", "#BC3C29FF", "#ea9999"),
                     name = "Condition",
                     labels = c("Old - High Grip", "Old - Low Grip", "Similar - High Grip", "Similar - Low Grip", "New - High Grip", "New - Low Grip")) +
  scale_linetype_manual(values = c("solid", "solid", "solid", "solid", "solid", "solid"), 
                        name = "Condition",
                        labels = c("Old - High Grip", "Old - Low Grip", "Similar - High Grip", "Similar - Low Grip", "New - High Grip", "New - Low Grip")) +
  guides(color = guide_legend(title = "Response Type"))



```


### Other MST_4T-related metrics

#### REC 

Corrected Recognition Memory
$$
REC=P(Old|Target) - P(Old|Foil)
$$

```{r  message=FALSE, warning=FALSE, cache=TRUE, include=TRUE}

# Calculate the probability of responding "old" given the trial type is "target"
prob_old_target <- MST_4T %>%
  group_by(sub) %>%
  filter(trial_type == 'targ') %>%
  summarise(prob_old_given_target = sum(resp1 == 'old') / n()) %>%
  ungroup()

# Calculate the probability of responding "old" given the trial type is "foil"
prob_old_foil <- MST_4T %>%
    group_by(sub) %>%
  filter(trial_type == 'foil') %>%
  summarise(prob_old_given_foil = sum(resp1 == 'old') / n()) %>%
  ungroup()


# Merge prob_old_target and prob_old_foil data frames
MST_4T_REC <- merge(prob_old_target, prob_old_foil, by = "sub", suffixes = c("_target", "_foil"))

# Calculate REC (Remembered Old - Forgotten Old)
MST_4T_REC$REC <- MST_4T_REC$prob_old_given_target - MST_4T_REC$prob_old_given_foil

```



#### LDI

Lure Discrimination Index
$$
LDI=P(Similar|Lure) - P(Similar|Foil)
$$


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Calculate the probability of responding "sim" given the trial type is "lure"
prob_sim_lure <- MST_4T %>%
  group_by(sub) %>%
  filter(trial_type == 'lure') %>%
  summarise(prob_sim_given_lure = sum(resp1 == 'sim') / n()) %>%
  ungroup()

# Calculate the probability of responding "sim" given the trial type is "foil"
prob_sim_foil <- MST_4T %>%
  group_by(sub) %>%
  filter(trial_type == 'foil') %>%
  summarise(prob_sim_given_foil = sum(resp1 == 'sim') / n()) %>%
  ungroup()

# Merge prob_sim_lure and prob_sim_foil data frames
MST_4T_LDI <- merge(prob_sim_lure, prob_sim_foil, by = "sub", suffixes = c("_lure", "_foil"))

# Calculate LDI (List Discrimination Index)
MST_4T_LDI$LDI <- MST_4T_LDI$prob_sim_given_lure - MST_4T_LDI$prob_sim_given_foil


# Merge MST_4T_REC and MST_4T_LDI data frames
MST_4T_combined <- merge(MST_4T_REC, MST_4T_LDI, by = "sub")

# Plotting
ggplot(MST_4T_combined, aes(x = REC, y = LDI)) +
  geom_point() +
  ggtitle("LDI vs REC for Each Subject") +
  xlab("Correct Recognition Memory") +
  ylab("Lure Discrimination Index")

```



## Statistical Analysis

### Effect of Grip on responses

#### The Effect of Grip on 'Old' Responses across Stimulus Levels

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

MST_anova_grip_old <- MST_4T %>%
  filter(stimlev_mst!= '5foil') %>%  group_by(stimlev_mst, isStrength, sub) %>%
  mutate(resp1_old = case_when(resp1 == 'old' ~ 1, TRUE ~ 0)) %>%  
  ungroup() %>% group_by(stimlev_mst, isStrength) %>% summarise(old = mean(resp1_old, na.rm = T), stimlev_mst, isStrength) %>%
  distinct()

aov(old ~ (stimlev_mst * isStrength), MST_anova_grip_old) 
```

#### The Effect of Grip on 'Similar' Responses across Stimulus Levels

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

MST_anova_grip_sim <- MST_4T %>%
  filter(stimlev_mst!= '5foil') %>%  group_by(stimlev_mst, isStrength, sub) %>%
  mutate(resp1_sim = case_when(resp1 == 'sim' ~ 1, TRUE ~ 0)) %>%  
  ungroup() %>% group_by(stimlev_mst, isStrength) %>% summarise(sim = mean(resp1_sim, na.rm = T), stimlev_mst, isStrength) %>%
  distinct()

aov(sim ~ (stimlev_mst * isStrength), MST_anova_grip_sim) 
```

#### The Effect of Grip on 'New' Responses across Stimulus Levels

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

MST_anova_grip_new <- MST_4T %>%
  filter(stimlev_mst!= '5foil') %>%  group_by(stimlev_mst, isStrength, sub) %>%
  mutate(resp1_new = case_when(resp1 == 'new' ~ 1, TRUE ~ 0)) %>%  
  ungroup() %>% group_by(stimlev_mst, isStrength) %>% summarise(new = mean(resp1_new, na.rm = T), stimlev_mst, isStrength) %>%
  distinct()

aov(new ~ (stimlev_mst * isStrength), MST_anova_grip_new) 
```

### Effect of Grip on Reaction Time


#### The Effect of Grip on Median Reaction Time for 'Old' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

MST_anova_grip_RT_old <- MST_4T %>%
  filter(stimlev_mst!= '5foil') %>% filter(resp1 =='old') %>% group_by(stimlev_mst, isStrength, sub) %>% mutate(RT_sub = median(resp1RT)) %>%
  ungroup() %>% group_by(stimlev_mst, isStrength) %>% summarise(RT = median(RT_sub), stimlev_mst, isStrength) %>%
  distinct()
  

aov(RT ~ (stimlev_mst * isStrength), MST_anova_grip_RT_old) 
```

#### The Effect of Grip on Median Reaction Time for 'Similar' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

MST_anova_grip_RT_sim <- MST_4T %>%
  filter(stimlev_mst!= '5foil') %>% filter(resp1 =='sim') %>% group_by(stimlev_mst, isStrength, sub) %>% mutate(RT_sub = median(resp1RT)) %>%
  ungroup() %>% group_by(stimlev_mst, isStrength) %>% summarise(RT = median(RT_sub), stimlev_mst, isStrength) %>%
  distinct()
  

aov(RT ~ (stimlev_mst * isStrength), MST_anova_grip_RT_sim) 
```


#### The Effect of Grip on Median Reaction Time for 'New' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

MST_anova_grip_RT_new <- MST_4T %>%
  filter(stimlev_mst!= '5foil') %>% filter(resp1 =='new') %>% group_by(stimlev_mst, isStrength, sub) %>% mutate(RT_sub = median(resp1RT)) %>%
  ungroup() %>% group_by(stimlev_mst, isStrength) %>% summarise(RT = median(RT_sub), stimlev_mst, isStrength) %>%
  distinct()
  

aov(RT ~ (stimlev_mst * isStrength), MST_anova_grip_RT_new) 

```

### Effect of Grip on Confidence Ratings


#### The Effect of Grip on Confidence Reports for 'Old' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

MST_anova_grip_conf_diff <- MST_4T %>%
  filter(stimlev_mst!= '5foil') %>% filter(stimlev_mst!= '0targ') %>% filter(resp1 =='old') %>% group_by(stimlev_mst, isStrength, sub) %>% mutate(conf_sub = mean(resp2, na.rm = T)) %>%
  ungroup() %>% group_by(stimlev_mst, isStrength) %>% summarise(conf = mean(conf_sub, na.rm = T), stimlev_mst, isStrength) %>%
  distinct()
  

aov(conf ~ (stimlev_mst * isStrength), MST_anova_grip_conf_diff)
```

#### The Effect of Grip on Confidence Reports for 'Similar' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

MST_anova_grip_conf_same <- MST_4T %>%
  filter(stimlev_mst!= '5foil') %>% filter(stimlev_mst!= '0targ') %>% filter(resp1 =='sim') %>% group_by(stimlev_mst, isStrength, sub) %>% mutate(conf_sub = mean(resp2, na.rm = T)) %>%
  ungroup() %>% group_by(stimlev_mst, isStrength) %>% summarise(conf = median(conf_sub, na.rm=T), stimlev_mst, isStrength) %>%
  distinct()
  

aov(conf ~ (stimlev_mst * isStrength), MST_anova_grip_conf_same) 
```


#### The Effect of Grip on Confidence Reports for 'New' responses 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

MST_anova_grip_conf_same <- MST_4T %>%
  filter(stimlev_mst!= '5foil') %>% filter(stimlev_mst!= '0targ') %>% filter(resp1 =='new') %>% group_by(stimlev_mst, isStrength, sub) %>% mutate(conf_sub = mean(resp2, na.rm = T)) %>%
  ungroup() %>% group_by(stimlev_mst, isStrength) %>% summarise(conf = median(conf_sub, na.rm=T), stimlev_mst, isStrength) %>%
  distinct()
  

aov(conf ~ (stimlev_mst * isStrength), MST_anova_grip_conf_same) 
```

## Statistical analysis for all tasks

### Effect of Grip on responding 'Different' across tasks and stimulus levels


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

MST_anova_grip_old_combined <- MST_4T %>% group_by(stimlev_mst, isStrength, sub) %>%
  mutate(resp1_old = case_when(resp1 == 'old' ~ 1, TRUE ~ 0)) %>%
  summarise(old = mean(resp1_old, na.rm = TRUE), stimlev_mst, isStrength, sub) %>%
  distinct()
MST_anova_grip_old_combined$stimlev_mst <- as.factor(MST_anova_grip_old_combined$stimlev_mst)
MST_anova_grip_old_combined$stimlev_mst <- recode_factor(MST_anova_grip_old_combined$stimlev_mst,'0targ'="0", '1lure'="1", '2lure'="2", '3lure'="3", '4lure'="4")
MST_anova_grip_old_combined <- MST_anova_grip_old_combined %>% filter(stimlev_mst!='5foil')
MST_anova_grip_old_combined <- rename(MST_anova_grip_old_combined, stimLev = stimlev_mst)
MST_anova_grip_old_combined <- MST_anova_grip_old_combined %>% mutate(old= 1-old)
MST_anova_grip_old_combined <- rename(MST_anova_grip_old_combined, diff = old)
MST_anova_grip_old_combined$task <- "MST"


ADT_anova_grip_diff_combined <- ADT_4T %>% group_by(stimLev, isStrength, sub) %>%
  summarise(diff = mean(resp1_diff, na.rm = TRUE), stimLev, isStrength, sub) %>%
  distinct()
ADT_anova_grip_diff_combined$stimLev <- as.factor(ADT_anova_grip_diff_combined$stimLev)
ADT_anova_grip_diff_combined$stimLev <- recode_factor(ADT_anova_grip_diff_combined$stimLev, '0'="0", '4'="1", '8'="2", '32'="3", '128'="4")
ADT_anova_grip_diff_combined$task <- "ADT"

VDT_anova_grip_diff_combined <- VDT_4T %>% group_by(stimLev, isStrength, sub) %>%
  summarise(diff = mean(resp1_diff, na.rm = TRUE), stimLev, isStrength, sub) %>%
  distinct()
VDT_anova_grip_diff_combined$stimLev <- as.factor(VDT_anova_grip_diff_combined$stimLev)
VDT_anova_grip_diff_combined$stimLev <- recode_factor(VDT_anova_grip_diff_combined$stimLev,'0'="0",'0.04'="1", '0.08'="2", '0.16'="3", '0.32'="4")
VDT_anova_grip_diff_combined$task <- "VDT"

CDT_anova_grip_diff_combined <- CDT_4T %>% group_by(stimLev, isStrength, sub) %>%
  summarise(diff = mean(resp1_diff, na.rm = TRUE), stimLev, isStrength, sub) %>%
  distinct()
CDT_anova_grip_diff_combined$stimLev <- as.factor(CDT_anova_grip_diff_combined$stimLev)
CDT_anova_grip_diff_combined$stimLev <- recode_factor(CDT_anova_grip_diff_combined$stimLev,'0'="0",'5'="1", '20'="2", '45'="3", '90'="4")
CDT_anova_grip_diff_combined$task <- "CDT"

alltask_anova_grip_diff <- rbind(ADT_anova_grip_diff_combined,VDT_anova_grip_diff_combined,CDT_anova_grip_diff_combined,MST_anova_grip_old_combined)
alltask_anova_grip_diff$isStrength <- as.factor(alltask_anova_grip_diff$isStrength)
alltask_anova_grip_diff$task <- as.factor(alltask_anova_grip_diff$task)


library(lme4)
model_ADT <- lmer(diff ~  isStrength + stimLev + (1 | sub), data = ADT_anova_grip_diff_combined)

summary(model_ADT)
report(model_ADT)

model_VDT <- lmer(diff ~  isStrength + stimLev + (1 | sub), data = VDT_anova_grip_diff_combined)

summary(model_VDT)
report(model_VDT)


model_CDT <- lmer(diff ~  isStrength + stimLev + (1 | sub), data = CDT_anova_grip_diff_combined)

summary(model_CDT)
report(model_CDT)


model_MST <- lmer(diff ~  isStrength + stimLev + (1 | sub), data = MST_anova_grip_old_combined)

summary(model_MST)
report(model_MST)


```



### Effect of Grip on RT across tasks and stimulus levels


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

#MST_anova_grip_old_RT_combined <- MST_4T %>% group_by(stimlev_mst, isStrength, sub) %>%
#    #filter(resp1 == 'old') %>%
#    summarise(RT_sub = median(resp1RT), stimlev_mst, isStrength, sub) %>%
#    ungroup() %>% group_by(stimlev_mst) %>%
#    summarise(RT_old = median(RT_sub), stimlev_mst, isStrength, sub) %>%
#  distinct()
#MST_anova_grip_old_RT_combined$stimlev_mst <- as.factor(MST_anova_grip_old_RT_combined$stimlev_mst)
#MST_anova_grip_old_RT_combined$stimlev_mst <- recode_factor(MST_anova_grip_old_RT_combined$stimlev_mst,'1lure'="1", '2lure'="2", '3lure'="3", '4lure'="4")
#MST_anova_grip_old_RT_combined <- MST_anova_grip_old_RT_combined %>% filter(stimlev_mst!='0targ') %>% filter(stimlev_mst!='5foil')
#MST_anova_grip_old_RT_combined <- rename(MST_anova_grip_old_RT_combined, stimLev = stimlev_mst)
#MST_anova_grip_old_RT_combined <- rename(MST_anova_grip_old_RT_combined, RT = RT_old)
#MST_anova_grip_old_RT_combined$task <- "MST"


ADT_anova_grip_diff_RT_combined <- ADT_4T %>% group_by(stimLev, isStrength, sub) %>%
  filter(iscorr == 1) %>%
  summarise(RT_sub = median(resp1RT), stimLev, isStrength, sub) %>%
  ungroup() %>% group_by(stimLev) %>%
  summarise(RT = median(RT_sub), stimLev, isStrength, sub) %>%
  distinct()
ADT_anova_grip_diff_RT_combined$stimLev <- as.factor(ADT_anova_grip_diff_RT_combined$stimLev)
ADT_anova_grip_diff_RT_combined$stimLev <- recode_factor(ADT_anova_grip_diff_RT_combined$stimLev, '0'="0",'4'="1", '8'="2", '32'="3", '128'="4")
ADT_anova_grip_diff_RT_combined$task <- "ADT"

VDT_anova_grip_diff_RT_combined <- VDT_4T %>% group_by(stimLev, isStrength, sub) %>%
    filter(iscorr == 1) %>%
  summarise(RT_sub = median(resp1RT), stimLev, isStrength, sub) %>%
  ungroup() %>% group_by(stimLev) %>%
  summarise(RT = median(RT_sub), stimLev, isStrength, sub) %>%
  distinct()
VDT_anova_grip_diff_RT_combined$stimLev <- as.factor(VDT_anova_grip_diff_RT_combined$stimLev)
VDT_anova_grip_diff_RT_combined$stimLev <- recode_factor(VDT_anova_grip_diff_RT_combined$stimLev, '0'="0", '0.04'="1", '0.08'="2", '0.16'="3", '0.32'="4")
VDT_anova_grip_diff_RT_combined$task <- "VDT"

CDT_anova_grip_diff_RT_combined <- CDT_4T %>% group_by(stimLev, isStrength, sub) %>%
    filter(iscorr == 1) %>%
  summarise(RT_sub = median(resp1RT), stimLev, isStrength, sub) %>%
  ungroup() %>% group_by(stimLev) %>%
  summarise(RT = median(RT_sub), stimLev, isStrength, sub) %>%
  distinct()
CDT_anova_grip_diff_RT_combined$stimLev <- as.factor(CDT_anova_grip_diff_RT_combined$stimLev)
CDT_anova_grip_diff_RT_combined$stimLev <- recode_factor(CDT_anova_grip_diff_RT_combined$stimLev,'0'="0",'5'="1", '20'="2", '45'="3", '90'="4")
CDT_anova_grip_diff_RT_combined$task <- "CDT"

alltask_anova_grip_diff_RT <- rbind(ADT_anova_grip_diff_RT_combined,VDT_anova_grip_diff_RT_combined,CDT_anova_grip_diff_RT_combined)
alltask_anova_grip_diff_RT$isStrength <- as.factor(alltask_anova_grip_diff_RT$isStrength)
alltask_anova_grip_diff_RT$task <- as.factor(alltask_anova_grip_diff_RT$task)


library(lme4)
model_RT_ADT <- lmer(RT ~ isStrength + stimLev + (1 | sub), data = ADT_anova_grip_diff_RT_combined)

summary(model_RT_ADT)
report(model_RT_ADT)

model_RT_VDT <- lmer(RT ~  isStrength + stimLev + (1 | sub), data = VDT_anova_grip_diff_RT_combined)

summary(model_RT_VDT)
report(model_RT_VDT)

model_RT_CDT <- lmer(RT ~ isStrength + stimLev + (1 | sub), data = CDT_anova_grip_diff_RT_combined)

summary(model_RT_CDT)
report(model_RT_CDT)

```
```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}
# Install and load the emmeans package
#install.packages("emmeans")
library(emmeans)

# Perform post-hoc comparisons for the isStrength variable
isStrength_emm <- emmeans(model_RT_CDT, ~ isStrength)

# Summarize the pairwise comparisons
summary(isStrength_emm)

# Plot the pairwise comparisons
plot(isStrength_emm)

```


### Effect of Grip on Targets across tasks


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

alltask_anova_grip_diff_stim0 <- alltask_anova_grip_diff %>%
  filter(stimLev == '0')

model_stim0 <- lmer(diff ~ task + isStrength + (1 | sub), data = alltask_anova_grip_diff_stim0)

# Print the summary of the model
summary(model_stim0)
report(model_stim0)

```


### Effect of Grip on RT and stimulus levels using MLM

#### ADT 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

ADT_anova_grip_diff_RT_MLM <- ADT_4T %>% group_by(stimLev, auc_rel_mvc, sub, resp1_diff) %>%
  filter(stimLev != '0') %>%
  summarise(RT_sub = resp1RT, stimLev, auc_rel_mvc, sub, resp1_diff) %>%
  ungroup() %>% group_by(stimLev) %>%
  summarise(RT = RT_sub, stimLev, auc_rel_mvc, sub, resp1_diff) %>%
  distinct()
ADT_anova_grip_diff_RT_MLM$stimLev <- as.factor(ADT_anova_grip_diff_RT_MLM$stimLev)
ADT_anova_grip_diff_RT_MLM$stimLev <- recode_factor(ADT_anova_grip_diff_RT_MLM$stimLev,'4'="1", '8'="2", '32'="3", '128'="4")
ADT_anova_grip_diff_RT_MLM$task <- "ADT"


model5 <- lmer(RT ~ auc_rel_mvc * stimLev + (1 | sub), data = ADT_anova_grip_diff_RT_MLM)
summary(model5)
report(model5)


# Interaction plot
interaction_plot5 <- ggplot(ADT_anova_grip_diff_RT_MLM, aes(x = auc_rel_mvc, y = RT, color = factor(stimLev))) +
  geom_line(aes(group = factor(stimLev)), size = 1) +
  geom_point(size = 3) +
  labs(x = "auc_rel_mvc", y = "RT", color = "stimLev") +
  theme_minimal()

# Display the plot
interaction_plot5

# Load necessary libraries
library(sjPlot)

# Marginal effects plot
marginal_plot5 <- plot_model(model5, type = "eff", terms = c("auc_rel_mvc", "stimLev"))

# Display the plot
print(marginal_plot5)


```


##### Cluster analysis

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}
# Assuming your dataset is named 'my_data' and contains the relevant variables for clustering
# Replace 'RT' and 'auc_rel_mvc' with the actual column names from your dataset

# Compute the within-cluster sum of squares (WSS) for different values of k
wss <- numeric(10)  # assuming a maximum of 10 clusters
for (i in 1:10) {
  kmeans_model <- kmeans(ADT_anova_grip_diff_RT_MLM[, c("RT", "auc_rel_mvc")], centers = i)
  wss[i] <- sum(kmeans_model$withinss)
}

# Plot the elbow curve
plot(1:10, wss, type = "b", pch = 19, frame = FALSE, 
     xlab = "Number of clusters",
     ylab = "Within-cluster sum of squares",
     main = "Elbow Method for Optimal Number of Clusters")

```




```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}
# Perform k-means clustering with 2 clusters
k <- 4
kmeans_model <- kmeans(ADT_anova_grip_diff_RT_MLM[, c("RT", "auc_rel_mvc", "stimLev")], centers = k)
clusters <- kmeans_model$cluster


# Visualize the clusters
library(ggplot2)
ADT_cluster <- ggplot(ADT_anova_grip_diff_RT_MLM, aes(x = RT, y = auc_rel_mvc, color = factor(kmeans_model$cluster))) +
  geom_point() +
  labs(x = "RT", y = "auc_rel_mvc", color = "Cluster") +
  ggtitle("K-means Clustering (k = 4)") +
  geom_jitter()

ggplotly(ADT_cluster)
```



```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Add cluster assignments to the original dataset
ADT_anova_grip_diff_RT_MLM$cluster <- as.factor(clusters)

# Calculate cluster centroids
cluster_centroids <- aggregate(cbind(RT, auc_rel_mvc) ~ cluster, data = ADT_anova_grip_diff_RT_MLM, FUN = mean)

# Visualize cluster centroids
ADT_cluster_centroids <- ggplot(ADT_anova_grip_diff_RT_MLM, aes(x = RT, y = auc_rel_mvc, color = factor(cluster))) +
  geom_point(alpha = 0.5) +
  geom_point(data = cluster_centroids, aes(x = RT, y = auc_rel_mvc, color = factor(cluster)), size = 4, shape = 18) +
  labs(x = "RT", y = "auc_rel_mvc", color = "Cluster") +
  ggtitle("Cluster Centroids â€” ADT") +
  geom_jitter()

ggplotly(ADT_cluster_centroids)



```





```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Calculate within-cluster sum of squares
wss <- sum(kmeans_model$withinss)

# Print the total within-cluster sum of squares
print(paste("Total within-cluster sum of squares:", wss))


```


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Explore the relationship between clusters and stimulus levels
cluster_stimulus <- table(ADT_anova_grip_diff_RT_MLM$cluster, ADT_anova_grip_diff_RT_MLM$stimLev)
print(cluster_stimulus)


```


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Perform association rule mining
library(arules)
data <- ADT_anova_grip_diff_RT_MLM[, c("RT", "auc_rel_mvc")]
transactions <- as(data, "transactions")
rules <- apriori(transactions, parameter = list(supp = 0.1, conf = 0.8))

# Print the discovered rules
inspect(rules)

```


##### Time series analysis


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Descriptive statistics
summary(ADT_anova_grip_diff_RT_MLM$RT)
sd(ADT_anova_grip_diff_RT_MLM$RT)

# Time series plot
plot(ADT_anova_grip_diff_RT_MLM$stimLev, ADT_anova_grip_diff_RT_MLM$RT, type = "l", xlab = "Stimulus Level", ylab = "RT", main = "RT vs Stimulus Level")


```


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# STL decomposition
#decomposed <- stl(ADT_anova_grip_diff_RT_MLM$RT, s.window = "periodic")
#plot(decomposed)


```


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Pearson correlation
correlation_matrix <- cor(ADT_anova_grip_diff_RT_MLM$RT, ADT_anova_grip_diff_RT_MLM$auc_rel_mvc, method = "pearson")

print(correlation_matrix)

```


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}
# ARIMA model
arima_model <- forecast::auto.arima(ADT_anova_grip_diff_RT_MLM$RT)
forecast_values <- forecast::forecast(arima_model)
plot(forecast_values)


```


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Change point detection (example using changepoint package)
library(changepoint)
cpt <- cpt.mean(ADT_anova_grip_diff_RT_MLM$RT)
plot(cpt)


```


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Example code for Fourier transform
fourier_transform <- fft(ADT_anova_grip_diff_RT_MLM$RT)
plot(abs(fourier_transform))


```



#### VDT 

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

VDT_anova_grip_diff_RT_MLM <- VDT_4T %>% group_by(stimLev, auc_rel_mvc, sub) %>%
  filter(stimLev != '0') %>%
  summarise(RT_sub = resp1RT, stimLev, auc_rel_mvc, sub) %>%
  ungroup() %>% group_by(stimLev) %>%
  summarise(RT = RT_sub, stimLev, auc_rel_mvc, sub) %>%
  distinct()
VDT_anova_grip_diff_RT_MLM$stimLev <- as.factor(VDT_anova_grip_diff_RT_MLM$stimLev)
VDT_anova_grip_diff_RT_MLM$stimLev <- recode_factor(VDT_anova_grip_diff_RT_MLM$stimLev,'0.04'="1", '0.08'="2", '0.16'="3", '0.32'="4")
VDT_anova_grip_diff_RT_MLM$task <- "VDT"


model6 <- lmer(RT ~ auc_rel_mvc * stimLev + (1 | sub), data = VDT_anova_grip_diff_RT_MLM)
summary(model6)
report(model6)

# Interaction plot
interaction_plot6 <- ggplot(ADT_anova_grip_diff_RT_MLM, aes(x = auc_rel_mvc, y = RT, color = factor(stimLev))) +
  geom_line(aes(group = factor(stimLev)), size = 1) +
  geom_point(size = 3) +
  labs(x = "auc_rel_mvc", y = "RT", color = "stimLev") +
  theme_minimal()

# Display the plot
interaction_plot6

# Load necessary libraries
library(sjPlot)

# Marginal effects plot
marginal_plot6 <- plot_model(model6, type = "eff", terms = c("auc_rel_mvc", "stimLev"))

# Display the plot
print(marginal_plot6)


```


##### Cluster analysis

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}
# Assuming your dataset is named 'my_data' and contains the relevant variables for clustering
# Replace 'RT' and 'auc_rel_mvc' with the actual column names from your dataset

# Compute the within-cluster sum of squares (WSS) for different values of k
wss <- numeric(10)  # assuming a maximum of 10 clusters
for (i in 1:10) {
  kmeans_model <- kmeans(VDT_anova_grip_diff_RT_MLM[, c("RT", "auc_rel_mvc")], centers = i)
  wss[i] <- sum(kmeans_model$withinss)
}

# Plot the elbow curve
plot(1:10, wss, type = "b", pch = 19, frame = FALSE, 
     xlab = "Number of clusters",
     ylab = "Within-cluster sum of squares",
     main = "Elbow Method for Optimal Number of Clusters")

```




```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}
# Perform k-means clustering with 2 clusters
k <- 4
kmeans_model <- kmeans(VDT_anova_grip_diff_RT_MLM[, c("RT", "auc_rel_mvc", "stimLev")], centers = k)
clusters <- kmeans_model$cluster


# Visualize the clusters
library(ggplot2)
VDT_cluster <- ggplot(VDT_anova_grip_diff_RT_MLM, aes(x = RT, y = auc_rel_mvc, color = factor(kmeans_model$cluster))) +
  geom_point() +
  labs(x = "RT", y = "auc_rel_mvc", color = "Cluster") +
  ggtitle("K-means Clustering (k = 4)") +
  geom_jitter()

ggplotly(VDT_cluster)
```



```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Add cluster assignments to the original dataset
VDT_anova_grip_diff_RT_MLM$cluster <- as.factor(clusters)

# Calculate cluster centroids
cluster_centroids <- aggregate(cbind(RT, auc_rel_mvc) ~ cluster, data = VDT_anova_grip_diff_RT_MLM, FUN = mean)

# Visualize cluster centroids
VDT_cluster_centroids <- ggplot(VDT_anova_grip_diff_RT_MLM, aes(x = RT, y = auc_rel_mvc, color = factor(cluster))) +
  geom_point(alpha = 0.5) +
  geom_point(data = cluster_centroids, aes(x = RT, y = auc_rel_mvc, color = factor(cluster)), size = 4, shape = 18) +
  labs(x = "RT", y = "auc_rel_mvc", color = "Cluster") +
  ggtitle("Cluster Centroids â€” VDT") +
  geom_jitter()

ggplotly(VDT_cluster_centroids)



```





```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Calculate within-cluster sum of squares
wss <- sum(kmeans_model$withinss)

# Print the total within-cluster sum of squares
print(paste("Total within-cluster sum of squares:", wss))


```


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Explore the relationship between clusters and stimulus levels
cluster_stimulus <- table(VDT_anova_grip_diff_RT_MLM$cluster, VDT_anova_grip_diff_RT_MLM$stimLev)
print(cluster_stimulus)


```


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

# Perform association rule mining
library(arules)
data <- VDT_anova_grip_diff_RT_MLM[, c("RT", "auc_rel_mvc")]
transactions <- as(data, "transactions")
rules <- apriori(transactions, parameter = list(supp = 0.1, conf = 0.8))

# Print the discovered rules
inspect(rules)

```


#### CDT 


```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

CDT_anova_grip_diff_RT_MLM <- CDT_4T %>% group_by(stimLev, auc_rel_mvc, sub) %>%
  filter(stimLev != '0') %>% filter(!is.na(resp1RT)) %>%
  summarise(RT_sub = resp1RT, stimLev, auc_rel_mvc, sub) %>%
  ungroup() %>% group_by(stimLev) %>%
  summarise(RT = RT_sub, stimLev, auc_rel_mvc, sub) %>%
  distinct()
CDT_anova_grip_diff_RT_MLM$stimLev <- as.factor(CDT_anova_grip_diff_RT_MLM$stimLev)
CDT_anova_grip_diff_RT_MLM$stimLev <- recode_factor(CDT_anova_grip_diff_RT_MLM$stimLev,'5'="1", '20'="2", '45'="3", '90'="4")
CDT_anova_grip_diff_RT_MLM$task <- "CDT"


model7 <- lmer(RT ~ auc_rel_mvc * stimLev + (1 | sub), data = CDT_anova_grip_diff_RT_MLM)
summary(model7)
report(model7)


# Interaction plot
interaction_plot7 <- ggplot(CDT_anova_grip_diff_RT_MLM, aes(x = auc_rel_mvc, y = RT, color = factor(stimLev))) +
  geom_line(aes(group = factor(stimLev)), size = 1) +
  geom_point(size = 3) +
  labs(x = "auc_rel_mvc", y = "RT", color = "stimLev") +
  theme_minimal()

# Display the plot
interaction_plot7

# Load necessary libraries
library(sjPlot)

# Marginal effects plot
marginal_plot7 <- plot_model(model7, type = "eff", terms = c("auc_rel_mvc", "stimLev"))

# Display the plot
print(marginal_plot7)


#alltask_anova_grip_diff_RT_MLM <- rbind(ADT_anova_grip_diff_RT_MLM,VDT_anova_grip_diff_RT_MLM,CDT_anova_grip_diff_RT_MLM)
#alltask_anova_grip_diff_RT_MLM$auc_rel_mvc <- as.factor(alltask_anova_grip_diff_RT_MLM$auc_rel_mvc)
#alltask_anova_grip_diff_RT_MLM$task <- as.factor(alltask_anova_grip_diff_RT_MLM$task)

```

## Misc Plots

### Distribution of Proportion of 'Diff' and RT

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}

library(plyr)
library(facefuns)
desired_order <- c("0", "1", "2", "3", "4")

## ADT 

ADT_anova_grip_diff_combined$stimLev <- factor(ADT_anova_grip_diff_combined$stimLev, levels = desired_order)

ggplot(ADT_anova_grip_diff_combined, aes(x = stimLev, y = diff, fill = factor(isStrength))) +
  geom_split_violin(alpha = .5, trim = FALSE) +
  geom_boxplot(width = .2, alpha = .8, fatten = NULL, show.legend = FALSE) +
  scale_fill_manual(values = c("#0072B5FF", "#BC3C29FF"), labels = c("0", "1")) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", show.legend = FALSE, 
               position = position_dodge(.175)) +
  scale_x_discrete(name = "Oddball level (Hz)") +
  scale_y_continuous(name = "diff", limits = c(0, 1)) +
  ggtitle("Distribution of 'Different' responses â€” ADT ") +
  labs(fill = "Grip Level")



detach("package:plyr", unload = TRUE, force = T)


ADT_anova_grip_diff_RT_combinedd <- ADT_4T %>% group_by(stimLev, isStrength, sub) %>%
  filter(iscorr == '1') %>% summarise(RT = median(resp1RT), stimLev, isStrength, sub) %>% distinct() 
ADT_anova_grip_diff_RT_combinedd$stimLev <- as.factor(ADT_anova_grip_diff_RT_combinedd$stimLev)
ADT_anova_grip_diff_RT_combinedd$stimLev <- recode_factor(ADT_anova_grip_diff_RT_combinedd$stimLev, '0'="0",'4'="1", '8'="2", '32'="3", '128'="4")
ADT_anova_grip_diff_RT_combinedd$task <- "ADT"


ggplot(ADT_anova_grip_diff_RT_combinedd, aes(x = stimLev, y = RT, fill = factor(isStrength))) +
  geom_split_violin(alpha = .5, trim = FALSE) +
  geom_boxplot(width = .2, alpha = .8, fatten = NULL, show.legend = FALSE) +
  scale_fill_manual(values = c("#0072B5FF", "#BC3C29FF"), labels = c("0", "1")) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", show.legend = FALSE, 
               position = position_dodge(.175)) +
  scale_x_discrete(name = "Oddball level") +
  scale_y_continuous(name = "RT", limits = c(0, 3)) +
  ggtitle("Distribution of Correct Median Reaction times â€” ADT ") +
  labs(fill = "Grip Level")




## VDT 

VDT_anova_grip_diff_combined$stimLev <- factor(VDT_anova_grip_diff_combined$stimLev, levels = desired_order)

ggplot(VDT_anova_grip_diff_combined, aes(x = stimLev, y = diff, fill = factor(isStrength))) +
  geom_split_violin(alpha = .5, trim = FALSE) +
  geom_boxplot(width = .2, alpha = .8, fatten = NULL, show.legend = FALSE) +
  scale_fill_manual(values = c("#0072B5FF", "#BC3C29FF"), labels = c("0", "1")) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", show.legend = FALSE, 
               position = position_dodge(.175)) +
  scale_x_discrete(name = "Oddball level") +
  scale_y_continuous(name = "diff", limits = c(0, 1)) +
  ggtitle("Distribution of 'Different' responses â€” VDT ") +
  labs(fill = "Grip Level")


#detach("package:plyr", unload = TRUE, force = T)


VDT_anova_grip_diff_RT_combinedd <- VDT_4T %>% group_by(stimLev, isStrength, sub) %>%
  filter(iscorr == '1') %>%
  summarise(RT = median(resp1RT), stimLev, isStrength, sub) %>% distinct() 
VDT_anova_grip_diff_RT_combinedd$stimLev <- as.factor(VDT_anova_grip_diff_RT_combinedd$stimLev)
VDT_anova_grip_diff_RT_combinedd$stimLev <- recode_factor(VDT_anova_grip_diff_RT_combinedd$stimLev, '0'="0",'0.04'="1", '0.08'="2", '0.16'="3", '0.32'="4")
VDT_anova_grip_diff_RT_combinedd$task <- "VDT"


ggplot(VDT_anova_grip_diff_RT_combinedd, aes(x = stimLev, y = RT, fill = factor(isStrength))) +
  geom_split_violin(alpha = .5, trim = FALSE) +
  geom_boxplot(width = .2, alpha = .8, fatten = NULL, show.legend = FALSE) +
  scale_fill_manual(values = c("#0072B5FF", "#BC3C29FF"), labels = c("0", "1")) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", show.legend = FALSE, 
               position = position_dodge(.175)) +
  scale_x_discrete(name = "Oddball level") +
  scale_y_continuous(name = "RT", limits = c(0, 3)) +
  ggtitle("Distribution of Correct Median Reaction times â€” VDT ") +
  labs(fill = "Grip Level")



## CDT 

CDT_anova_grip_diff_combined$stimLev <- factor(CDT_anova_grip_diff_combined$stimLev, levels = desired_order)

ggplot(CDT_anova_grip_diff_combined, aes(x = stimLev, y = diff, fill = factor(isStrength))) +
  geom_split_violin(alpha = .5, trim = FALSE) +
  geom_boxplot(width = .2, alpha = .8, fatten = NULL, show.legend = FALSE) +
  scale_fill_manual(values = c("#0072B5FF", "#BC3C29FF"), labels = c("0", "1")) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", show.legend = FALSE, 
               position = position_dodge(.175)) +
  scale_x_discrete(name = "Oddball level") +
  scale_y_continuous(name = "diff", limits = c(0, 1)) +
  ggtitle("Distribution of 'Different' responses â€” CDT ") +
  labs(fill = "Grip Level")


#detach("package:plyr", unload = TRUE, force = T)


CDT_anova_grip_diff_RT_combinedd <- CDT_4T %>% group_by(stimLev, isStrength, sub) %>%
  filter(iscorr == '1') %>% summarise(RT = median(resp1RT), stimLev, isStrength, sub) %>% distinct() 
CDT_anova_grip_diff_RT_combinedd$stimLev <- as.factor(CDT_anova_grip_diff_RT_combinedd$stimLev)
CDT_anova_grip_diff_RT_combinedd$stimLev <- recode_factor(CDT_anova_grip_diff_RT_combinedd$stimLev, '0'="0",'5'="1", '20'="2", '45'="3", '90'="4")
CDT_anova_grip_diff_RT_combinedd$task <- "CDT"


ggplot(CDT_anova_grip_diff_RT_combinedd, aes(x = stimLev, y = RT, fill = factor(isStrength))) +
  geom_split_violin(alpha = .5, trim = FALSE) +
  geom_boxplot(width = .2, alpha = .8, fatten = NULL, show.legend = FALSE) +
  scale_fill_manual(values = c("#0072B5FF", "#BC3C29FF"), labels = c("0", "1")) +
  stat_summary(fun.data = "mean_se", geom = "pointrange", show.legend = FALSE, 
               position = position_dodge(.175)) +
  scale_x_discrete(name = "Oddball level") +
  scale_y_continuous(name = "RT", limits = c(0, 3)) +
  ggtitle("Distribution of Correct Median Reaction times â€” CDT ") +
  labs(fill = "Grip Level")



```


### Bias-corrected proportion correct

This is based on the d-prime calculated using log-linear edge correction. Hence, the range of d-prime is smaller than usual

```{r  message=FALSE, warning=FALSE, cache=T, include=TRUE}


ADT_bcpc<-ADT_4T %>% 
  select(sub, stimLev, isStrength,hit,fa,miss,cr)%>% 
  group_by(isStrength, stimLev, sub)%>% 
  summarize(n_hit=sum(hit, na.rm = T),
            n_fa = sum(fa, na.rm = T),
            n_miss= sum(miss, na.rm = T),
            n_cr = sum(cr, na.rm = T))


## adding n_fa and n_cr from standard to oddball trials
ADT_bcpc <- ADT_bcpc %>% 
  group_by(sub, stimLev, isStrength) %>%
  mutate(n_fa = na_if(n_fa, 0)) %>%
  fill(n_fa) %>% mutate(n_fa = ifelse(is.na(n_fa), 0, n_fa))

ADT_bcpc <- ADT_bcpc %>% 
  group_by(isStrength, stimLev, sub) %>%
  mutate(n_cr = na_if(n_cr, 0)) %>%
  fill(n_cr) %>% mutate(n_cr = ifelse(is.na(n_cr), 0, n_cr))

## using the adjusted formula based on loglinear approach
ADT_bcpc <- ADT_bcpc %>% 
  mutate(
    hit_r = (n_hit+0.5)/(n_hit+ n_miss+1)
  )

ADT_bcpc <- ADT_bcpc %>% 
  mutate(
    fa_r = (n_fa+0.5)/(n_fa + n_cr+1)
  ) 

## calculating the d-prime and the formula
ADT_bcpc$dprime <- qnorm(ADT_bcpc$hit_r) - qnorm(ADT_bcpc$fa_r)

# remove d-prime for stimLev 0 as it is meaningless

ADT_bcpc <- ADT_bcpc %>%
  filter(stimLev != 0)

# proportion correct in an ideal situation
ADT_bcpc <- ADT_bcpc %>%
  group_by(stimLev, isStrength) %>%
  mutate(bc_pc = pnorm(dprime / 2)) %>%
  ungroup() 
 # mutate(dprime_hat = mean(dprime)))

# Load the dplyr package if not already loaded
library(dplyr)

# Group by 'sub', 'isStrength', and 'stimLev' and calculate the mean of 'pc'
ADT_bcpc_mean <- ADT_bcpc %>%
  group_by(sub, isStrength, stimLev) %>%
  summarise(mean_bc_pc = mean(bc_pc, na.rm = TRUE))

ADT_bcpc_mean$isStrength <- factor(ADT_bcpc_mean$isStrength)

# Plotting the boxplot
ggplot(ADT_bcpc_mean, aes(x = factor(stimLev), y = mean_bc_pc, color = isStrength)) +
  geom_boxplot(position=position_dodge(1)) +
  labs(x = "Stimus Level", y = "Proportion Correct", fill = "Grip Level") +
  scale_color_manual(values = c("#0072B5FF", "#BC3C29FF")) +
  ylim(0,1) +
  ggtitle("Overall distribution of accuracy across stimulus levels - ADT") +
  guides(color = guide_legend(title = "Grip level")) +
  theme_classic()# Specify colors for each boxplot

# Create the raincloud plot
ggplot(data = ADT_bcpc_mean, aes(x = factor(stimLev), y = mean_bc_pc, fill = factor(isStrength))) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0), alpha = .8) +
  geom_point(aes(y = mean_bc_pc, color = factor(isStrength)), 
             position = position_jitter(width = .1), size = 2, alpha = 0.6) +
  geom_boxplot(aes(group = interaction(factor(stimLev), factor(isStrength)), color = factor(isStrength)),  # Separate boxplots by both stimLev and isStrength
               width = 0.2, size = 1 ,outlier.shape = NA, fill = NA) +
  scale_color_manual(values = c("#0072B5FF", "#BC3C29FF")) +
  scale_fill_manual(values = c("#0072B5FF", "#BC3C29FF"))  +
  theme_classic() +
  ylim(0,1) +
  theme(legend.position = "none") +  # Remove the legend
  labs(
    x = "Stimulus Level",
    y = "Proportion Correct",
    title = "Overall distribution of accuracy across stimulus levels - ADT"
  ) 


VDT_bcpc<-VDT_4T %>% 
  select(sub, stimLev, isStrength,hit,fa,miss,cr)%>% 
  group_by(isStrength, stimLev, sub)%>% 
  summarize(n_hit=sum(hit, na.rm = T),
            n_fa = sum(fa, na.rm = T),
            n_miss= sum(miss, na.rm = T),
            n_cr = sum(cr, na.rm = T))


## adding n_fa and n_cr from standard to oddball trials
VDT_bcpc <- VDT_bcpc %>% 
  group_by(sub, stimLev, isStrength) %>%
  mutate(n_fa = na_if(n_fa, 0)) %>%
  fill(n_fa) %>% mutate(n_fa = ifelse(is.na(n_fa), 0, n_fa))

VDT_bcpc <- VDT_bcpc %>% 
  group_by(isStrength, stimLev, sub) %>%
  mutate(n_cr = na_if(n_cr, 0)) %>%
  fill(n_cr) %>% mutate(n_cr = ifelse(is.na(n_cr), 0, n_cr))

## using the adjusted formula based on loglinear approach
VDT_bcpc <- VDT_bcpc %>% 
  mutate(
    hit_r = (n_hit+0.5)/(n_hit+ n_miss+1)
  )

VDT_bcpc <- VDT_bcpc %>% 
  mutate(
    fa_r = (n_fa+0.5)/(n_fa + n_cr+1)
  ) 

## calculating the d-prime and the formula
VDT_bcpc$dprime <- qnorm(VDT_bcpc$hit_r) - qnorm(VDT_bcpc$fa_r)

# remove d-prime for stimLev 0 as it is meaningless

VDT_bcpc <- VDT_bcpc %>%
  filter(stimLev != 0)

# proportion correct in an ideal situation
VDT_bcpc <- VDT_bcpc %>%
  group_by(stimLev, isStrength) %>%
  mutate(bc_pc = pnorm(dprime / 2)) %>%
  ungroup() 
# mutate(dprime_hat = mean(dprime)))


# Group by 'sub', 'isStrength', and 'stimLev' and calculate the mean of 'pc'
VDT_bcpc_mean <- VDT_bcpc %>%
  group_by(sub, isStrength, stimLev) %>%
  summarise(mean_bc_pc = mean(bc_pc, na.rm = TRUE))

VDT_bcpc_mean$isStrength <- factor(VDT_bcpc_mean$isStrength)

# Plotting the boxplot
ggplot(VDT_bcpc_mean, aes(x = factor(stimLev), y = mean_bc_pc, color = isStrength)) +
  geom_boxplot(position=position_dodge(1)) +
  labs(x = "Stimus Level", y = "Proportion Correct", fill = "Grip Level") +
  scale_color_manual(values = c("#0072B5FF", "#BC3C29FF")) +
  ylim(0,1) +
  ggtitle("Overall distribution of accuracy across stimulus levels - VDT") +
  guides(color = guide_legend(title = "Grip level")) +
  theme_classic()# Specify colors for each boxplot

# Create the raincloud plot
ggplot(data = VDT_bcpc_mean, aes(x = factor(stimLev), y = mean_bc_pc, fill = factor(isStrength))) +
  geom_flat_violin(position = position_nudge(x = .1, y = 0), alpha = .8) +
  geom_point(aes(y = mean_bc_pc, color = factor(isStrength)), 
             position = position_jitter(width = .1), size = 2, alpha = 0.6) +
  geom_boxplot(aes(group = interaction(factor(stimLev), factor(isStrength)), color = factor(isStrength)),  # Separate boxplots by both stimLev and isStrength
               width = 0.2, size = 1 ,outlier.shape = NA, fill = NA) +
  scale_color_manual(values = c("#0072B5FF", "#BC3C29FF")) +
  scale_fill_manual(values = c("#0072B5FF", "#BC3C29FF"))  +
  theme_classic() +
  ylim(0,1) +
  theme(legend.position = "none") +  # Remove the legend
  labs(
    x = "Stimulus Level",
    y = "Proportion Correct",
    title = "Overall distribution of accuracy across stimulus levels - VDT"
  ) 

```

